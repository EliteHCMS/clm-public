import{Q as he}from"./QImg.e4106f40.js";import{_ as le,a3 as G,r as v,c as oe,w as B,y as t,z as _,d as y,bq as g,aq as r,aw as ee,ab as F,cU as V,bN as ue,bM as re,ap as R,cV as se,a7 as f,b as ae,bV as ie,B as D,b0 as ge,a_ as be,bT as ye,bS as _e,cT as qe,D as Ne,bP as xe,cW as we}from"./index.b35eeed3.js";import{Q as ne}from"./QForm.6c8993a8.js";import{Q as $e}from"./QPage.6f4063c4.js";import{u as de}from"./use-quasar.6afddd70.js";import{u as W,a as ke}from"./vee-validate.esm.0c700e69.js";import{u as Ce}from"./i18n.a721d321.js";import{u as ce,q as Q,i as me,b as Se}from"./app.31ce29fc.js";import{_ as Ie}from"./languageSelector.dd7972c5.js";import{p as Ee}from"./VueTelInput.708968f3.js";import{c as E,a as H}from"./array.164cfe36.js";import{dayjs as L}from"./dayjs.c324749c.js";import{c as Re}from"./carousel.e06a35c4.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.504e0e11.js";import"./index.04bc0a32.js";import"./QSelect.2ba35ed2.js";import"./QChip.86c715a9.js";import"./QMenu.fc0510b6.js";import"./position-engine.301e00c6.js";import"./selection.423f1a2d.js";import"./rtl.b51694b1.js";import"./use-panel.87525cc8.js";import"./touch.3df10340.js";import"./use-fullscreen.36eb3617.js";const ve=j=>(ge("data-v-6bed7e94"),j=j(),be(),j),De={key:0,class:"text-dark"},Me={key:1,class:"text-dark"},Ue={key:2,class:"text-dark"},Ve={key:3,class:"text-dark"},Pe={key:4,class:"text-dark"},Qe=ve(()=>D("br",null,null,-1)),je={key:5,class:"text-dark"},Ae=ve(()=>D("br",null,null,-1)),Te={key:2,class:"text-grey-6 text-right"},Oe={key:3,class:"text-grey-6 text-right"},Le={__name:"codeComponent",props:{phoneNumber:String,email:String,type:String,rid:String},emits:["verified"],setup(j,{emit:k}){const M=j,U=de(),q=ce(),C=G(M,"phoneNumber"),e=G(M,"email"),a=G(M,"type"),l=v("code-confirmation"),b=v(Math.floor(1e5+Math.random()*9e5)),s=v(null),h=v(!1),i=v(!1),n=v(!1),p=v(0),c=G(M,"rid"),{value:S}=W("codeConfirmation",E().matches(/^[0-9]{6}/g,{excludeEmptyString:!0,message:"Code Not Valid!"}).required().oneOf([b.value],"Code Not Valid!")),te=oe(()=>S.value===b.value),K=d=>{const o=Math.floor(d/6e4),m=(d%6e4/1e3).toFixed(0);return o+":"+(m<10?"0":"")+m};B(a,d=>{b.value=null,S.value=null,h.value=!1,b.value=null,s.value=null,l.value="code-confirmation"}),B(p,d=>{d===0?(h.value=!0,b.value=null,s.value=null):h.value=!1}),B(S,async d=>{Number(d)===b.value&&(U.notify({position:"top-right",type:"positive",message:"Code Verified!"}),a.value==="phone-number"?X():a.value==="email"&&z())});const w=async()=>{n.value=!0,l.value==="code-confirmation"?(b.value=Math.floor(1e5+Math.random()*9e5),S.value=null,s.value=L().add(5,"minute").toISOString(),a.value==="phone-number"?(await me.sendMessage({data:{body:`Your Brandsafway Verification Code is: ${b.value}`,to:C.value,messagingServiceSid:"MGd0e31773980318b7cdc5d2043117e27c",direction:"outbound-api",twilioMessage:!0}}),n.value=!1,U.notify({position:"top-right",type:"info",message:"Text message sent!"}),s.value=L().add(1,"minute")):a.value==="email"&&(await T(),n.value=!1,U.notify({position:"top-right",type:"info",message:"Email sent!"}),s.value=L().add(2,"minute")),n.value=!1,N(),l.value="code-sent"):n.value=!1},N=()=>{const d=setInterval(()=>{p.value=L(s.value).valueOf()-L().valueOf(),p.value<=0&&(p.value=0,clearInterval(d))},1e3)},T=async()=>{if(!c.value||c.value==="")return!1;const d=await Q.isUserLoggedIn(),o=new Date;b.value||(b.value=Math.floor(1e5+Math.random()*9e5));const m={3:{value:c.value},26:{value:o},87:{value:o},88:{value:b.value},47:{value:!0}};try{return d?await Q.updateUserData({fields:m}):await Q.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:[m],formatObject:76})}catch(O){U.notify({position:"top-right",type:"negative",message:O.message||"Error updating Verification!"})}},X=async()=>{if(i.value=!0,!c.value||c.value==="")return i.value=!1,!1;const d=new Date,o={3:{value:c.value},26:{value:d},50:{value:!0}};try{await Q.updateUserData({fields:o}),i.value=!1,k("verified")}catch(m){i.value=!1,U.notify({position:"top-right",type:"negative",message:m.message||"Error updating Verification!"})}},z=async()=>{if(i.value=!0,!c.value||c.value==="")return i.value=!1,!1;const d=new Date,o={3:{value:c.value},26:{value:d},49:{value:!0}};try{await Q.updateUserData({fields:o}),i.value=!1,k("verified")}catch(m){i.value=!1,U.notify({position:"top-right",type:"negative",message:m.message||"Error updating Verification!"})}},$=()=>C.value.replace(/(\d{3})(\d{3})(\d{4})/,"******$3"),Y=()=>(q.userLoggedIn?q.user[34]:e.value||"").replace(/(.{2})(.*)(?=@)/,function(o,m,O){for(let J=0;J<O.length;J++)m+="*";return m});return B(()=>M.phoneNumber,()=>{console.log(M)}),(d,o)=>(t(),_("div",null,[y(V,{class:"text-center auth-description"},{default:g(()=>[l.value==="code-sent"&&a.value==="phone-number"?(t(),_("p",De,"A text message with a verification code has been sent to your phone.")):r("",!0),l.value==="code-sent"&&a.value==="email"?(t(),_("p",Me,"A verification code has been sent to your email. ")):r("",!0),l.value==="code-confirmation"&&a.value==="phone-number"?(t(),_("p",Ue,"Your Phone Number needs to be verified click the button below to verify.")):r("",!0),l.value==="code-confirmation"&&a.value==="email"?(t(),_("p",Ve,"Your Email needs to be verified click the button below to verify.")):r("",!0),l.value==="code-confirmation"&&a.value==="phone-number"?(t(),_("p",Pe,[Qe,ee(F($()),1)])):r("",!0),l.value==="code-confirmation"&&a.value==="email"?(t(),_("p",je,[Ae,ee(F(Y()),1)])):r("",!0)]),_:1}),y(V,null,{default:g(()=>[y(ne,{class:"q-px-sm q-pt-sm",onSubmit:o[3]||(o[3]=ue(()=>{},["prevent"])),onKeyup:re(w,["enter"])},{default:g(()=>[l.value==="code-sent"?(t(),R(se,{key:0,class:"col-xs-12 col-sm-6 q-pb-md",clearable:!i.value,outlined:"",disable:h.value,loading:i.value,modelValue:f(S),"onUpdate:modelValue":o[0]||(o[0]=m=>ae(S)?S.value=m:null),type:"text",autocomplete:"one-time-code",inputmode:"numeric",pattern:"[0-9]*",label:"Code",tabindex:"1",maxlength:"6",minlength:"6",name:"codeConfirmation",error:!!te.value,"error-message":"Code does not match!"},{append:g(()=>[ee(F(K(p.value))+"\xA0 ",1)]),_:1},8,["clearable","disable","loading","modelValue","error"])):r("",!0),l.value==="code-confirmation"?(t(),R(ie,{key:1,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:"Send Code",tabindex:"1",loading:n.value,onClick:w},null,8,["loading"])):r("",!0),a.value==="phone-number"&&e.value!==""?(t(),_("p",Te,[D("a",{href:"javascript:void(0);",onClick:o[1]||(o[1]=m=>a.value="email")},"Use Email")])):r("",!0),a.value==="email"&&C.value!==""?(t(),_("p",Oe,[D("a",{href:"javascript:void(0);",onClick:o[2]||(o[2]=m=>a.value="phone-number")},"Use Phone Number")])):r("",!0),l.value==="code-sent"?(t(),R(V,{key:4,class:"q-py-none row justify-center"},{default:g(()=>[p.value===0?(t(),_("a",{key:0,onClick:w,class:"text-grey-6",href:"javascript:void(0);",tabindex:"2"},"Resend Code")):r("",!0)]),_:1})):r("",!0)]),_:1},8,["onKeyup"])]),_:1})]))}};var Be=le(Le,[["__scopeId","data-v-6bed7e94"]]);const Fe={key:0,class:"col-md-7 col-lg-8 col-lx-8"},Ke={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},ze={class:"text-dark"},Ye={key:0,class:"row q-col-gutter-xs"},Je={key:1,class:"row q-col-gutter-xs"},Ge={class:"text-grey-6"},He={class:"row justify-center"},We={__name:"updateInfo",setup(j){const k=de(),M=ce(),{currentUserType:U}=Se(),q=ye(),C=_e(),{t:e}=Ce(),a=v(!1),l=v("update-information"),b=v(10),s=v(!1),h=v(!1),i=v(null),n=v(null),p=v(!1),c=v(!1),S=oe(()=>{const u=new RegExp("^[0-9]{"+b.value+"}","g");return h.value&&s.value?H({email:E().email(`${e("validEmailIsRequired")}`).required().label(`${e("email")}`),phoneNumber:E().matches(u,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).required().label(`${e("phoneNumber")}`)}):h.value&&!s.value?H({email:E().email(`${e("validEmailIsRequired")}`).required().label(`${e("email")}`),phoneNumber:E().matches(u,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).label(`${e("phoneNumber")}`)}):!h.value&&s.value?H({email:E().email(`${e("validEmailIsRequired")}`).label(`${e("email")}`),phoneNumber:E().matches(u,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).required().label(`${e("phoneNumber")}`)}):H({email:E().email(`${e("validEmailIsRequired")}`).required().label(`${e("email")}`),phoneNumber:E().matches(u,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).required().label(`${e("phoneNumber")}`)})}),{errors:te,meta:K}=ke({validationSchema:S,initialValues:{phoneNumber:"",email:""}}),{value:w}=W("userRID"),{value:N,errorMessage:T,setErrors:X,meta:z}=W("phoneNumber"),{value:$,errorMessage:Y,setErrors:d,meta:o}=W("email");v(!0),q.query.rid?(w.value=q.query.rid,q.query.emailRequired&&(h.value=!0),q.query.phoneNumberRequired&&(s.value=!0),C.replace({query:{}})):C.push("/"),B(()=>q.query,()=>{q.query.rid&&(w.value=q.query.rid,q.query.emailRequired&&(h.value=!0),q.query.phoneNumberRequired&&(s.value=!0),C.replace({query:{}}))});const m=u=>{b.value=u},O=u=>{i.value=u},J=()=>{M.logout().then(()=>{C.replace({name:"login"})})},Z=async()=>{if(a.value=!0,!K.value.valid)return a.value=!1,!1;if(!w.value||w.value==="")return a.value=!0,!1;const u=new Date;let x={phoneNumber:"N/A",name:"United States",iso2:"US",dialCode:"1",iso2sm:"us",callerName:null,countryCode:"US",nationalFormat:"N/A",carrier:null,validPhoneNumber:!1};if(s.value){const A={data:{phoneNumber:N.value,type:"phoneNumber"}},I=await me.createContact(A);if(I.data&&(n.value=I.data.validation,I.data.valid===!0?(N.e164=I.data.phoneNumber,n.value.validPhoneNumber=!0,delete n.value.url,delete n.value.price,delete n.value.phoneNumber,delete n.value.addOns):n.value.validPhoneNumber=!1),n.value&&n.value.validPhoneNumber===!1)return X(`${e("validPhoneIsRequired")}`),k.notify({type:"negative",message:`${e("validPhoneIsRequired")}`,timeout:7e3,position:k.screen.lt.md?"top":"top-right"}),a.value=!1,null;x=Object.assign({phoneNumber:N.value},i.value,n.value||{})}if(h.value&&$.value===""&&n.value&&n.value.validPhoneNumber===!1)return d(`${e("validEmailIsRequired")}`),k.notify({type:"negative",message:`${e("validEmailIsRequired")}`,timeout:7e3,position:k.screen.lt.md?"top":"top-right"}),a.value=!1,null;const P={...s.value&&{8:{value:`+${i.value?i.value.dialCode:"1"}${N.value}`}},...s.value&&{9:{value:JSON.stringify(x)}},...s.value&&{111:{value:!1}},...h.value&&{6:{value:$.value}},...h.value&&{112:{value:!1}},26:{value:u}};try{await Q.updateUserData({fields:P}),a.value=!1,C.push({path:"/",query:{rid:w.value,...s.value&&{phoneNumber:`+${i.value?i.value.dialCode:"1"}${N.value}`},...h.value&&{email:$.value}}})}catch(A){c.value=!1,p.value=!1,A.lineErrors&&A.lineErrors.forEach(I=>{I.includes('is not unique for unique formula field with ID "27"')&&(c.value=!0),I.includes('The field named "uniqueEmail" with field id 27 requires a unique value.')&&(c.value=!0),I.includes('is not unique for unique formula field with ID "28"')&&(p.value=!0),I.includes('The field named "uniquePhoneNumber" with field id 28 requires a unique value.')&&(p.value=!0)}),p.value||c.value?l.value="code-confirmation":k.notify({position:"top-right",type:"negative",message:A.message||"Error updating Information!"})}},pe=async()=>{try{const u=new Date,x={phoneNumber:"N/A",name:"United States",iso2:"US",dialCode:"1",iso2sm:"us",callerName:null,countryCode:"US",nationalFormat:"N/A",carrier:null,validPhoneNumber:!1},P=[{...p.value&&{8:{value:""}},...p.value&&{9:{value:JSON.stringify(x)}},...p.value&&{50:{value:!1}},...p.value&&{111:{value:!0}},26:{value:u},...c.value&&{6:{value:""}},...c.value&&{49:{value:!1}},...c.value&&{112:{value:!0}}}];return await Q.findAndUpdateUser({...p.value&&{phoneNumber:`+${i.value?i.value.dialCode:"1"}${N.value}`},...c.value&&{email:$.value},userType:U,fields:P})}catch(u){console.log(u)}},fe=async()=>{l.value="update-information",await pe(),await Z()};return(u,x)=>(t(),R($e,{class:"window-height window-width row"},{default:g(()=>[f(k).screen.lt.md?r("",!0):(t(),_("div",Fe,[y(Re)])),D("div",Ke,[y(qe,{class:"auth-card",flat:""},{default:g(()=>[y(V,{style:{"padding-left":"30px","padding-right":"30px"}},{default:g(()=>[y(he,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),l.value==="update-information"?(t(),R(V,{key:0,class:"text-center auth-description"},{default:g(()=>[D("p",ze,F(u.$t("pleaseUpdateInformation")),1)]),_:1})):r("",!0),l.value==="update-information"?(t(),R(V,{key:1},{default:g(()=>[y(ne,{class:"q-px-sm q-pt-sm",onSubmit:x[2]||(x[2]=ue(()=>{},["prevent"])),onKeyup:re(Z,["enter"])},{default:g(()=>[s.value?(t(),_("div",Ye,[y(Ee,{name:"phoneNumber",class:Ne(["col-xs-12 col-sm-12",{"q-pb-lg":f(T)&&f(z).validated}]),outlined:"",modelValue:f(N),"onUpdate:modelValue":x[0]||(x[0]=P=>ae(N)?N.value=P:null),label:u.$t("phoneNumber"),tabindex:"3",onMaxLengthChanged:m,error:!!(f(T)&&f(z).validated),"error-message":f(T),onCountryChanged:O},null,8,["class","modelValue","label","error","error-message"])])):r("",!0),h.value?(t(),_("div",Je,[y(se,{class:"col-xs-12 col-sm-12 q-pb-lg",clearable:"",outlined:"",modelValue:f($),"onUpdate:modelValue":x[1]||(x[1]=P=>ae($)?$.value=P:null),type:"email",autocomplete:"email",label:u.$t("email"),tabindex:"4",name:"email",error:!!(f(Y)&&f(o).validated),"error-message":f(Y)},{prepend:g(()=>[y(xe,{name:"email"})]),_:1},8,["modelValue","label","error","error-message"])])):r("",!0)]),_:1},8,["onKeyup"])]),_:1})):r("",!0),l.value==="code-confirmation"?(t(),R(Be,{key:2,onVerified:fe,phoneNumber:f(N),email:f($),type:s.value?"phone-number":"email",rid:f(w)},null,8,["phoneNumber","email","type","rid"])):r("",!0),l.value==="update-information"?(t(),R(we,{key:3,class:"q-px-lg"},{default:g(()=>[l.value==="update-information"?(t(),R(ie,{key:0,ref:"confirm",loading:a.value,disable:!f(K).valid,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:u.$t("confirm"),tabindex:"3",onClick:Z},null,8,["loading","disable","label"])):r("",!0)]),_:1})):r("",!0),y(V,{class:"text-center q-pa-sm"},{default:g(()=>[D("p",Ge,[D("a",{onClick:J,class:"text-grey-6",href:"javascript:void(0);",tabindex:"4"},F(u.$t("logout")),1)])]),_:1}),y(V,{class:"q-pl-lg q-pa-sm"},{default:g(()=>[D("div",He,[y(Ie,{dense:"",borderless:""})])]),_:1})]),_:1})])]),_:1}))}};var xa=le(We,[["__scopeId","data-v-05f233d3"]]);export{xa as default};
