import{Q as B}from"./QSpace.0689194e.js";import{bU as Z,r as c,w as ee,aS as te,c as y,y as Q,z as S,d as e,bq as t,cU as ae,B as d,D as L,a7 as m,ab as p,cT as le,cV as oe,bP as x,bV as N,aw as v,bQ as j,bO as b}from"./index.b35eeed3.js";import{Q as E}from"./QTooltip.42ac2309.js";import{Q as U}from"./QTd.a7c86421.js";import{Q as A}from"./QSelect.2ba35ed2.js";import{Q as se}from"./QList.5b498127.js";import{Q as re}from"./QBtnDropdown.a2bda6e7.js";import{u as ie}from"./use-quasar.6afddd70.js";import{e as ne}from"./export-file.dc78ba05.js";import{u as ce,c as de,b as me,q as O}from"./app.31ce29fc.js";import{dayjs as ue}from"./dayjs.c324749c.js";import{_ as fe}from"./hiringTabs.4ca070fe.js";import{_ as pe}from"./officeSelector.301b3575.js";import{_ as ve}from"./aTable.893101e5.js";import{u as Y}from"./useQuerySaver.d29ff9ee.js";import"./position-engine.301e00c6.js";import"./selection.423f1a2d.js";import"./QChip.86c715a9.js";import"./QMenu.fc0510b6.js";import"./rtl.b51694b1.js";import"./QBtnGroup.18f95ebd.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.504e0e11.js";import"./index.04bc0a32.js";import"./i18n.a721d321.js";import"./QBadge.ec801063.js";import"./QRouteTab.ee2f0d9e.js";import"./QTabs.0e7a4c01.js";import"./QResizeObserver.e8b5d41e.js";import"./QTable.c08ed117.js";import"./QMarkupTable.39675ceb.js";import"./use-fullscreen.36eb3617.js";const be={class:"q-pa-md"},_e={class:"row items-center"},ge={class:"col-12 col-md-5 q-px-sm"},we={class:"col-12 col-md-3 q-px-sm"},he={class:"col-12 col-md-5 q-px-sm"},ye={key:0},Qe={key:1},ot={__name:"index",setup(Se){const u=ie(),{userOffices:z,getUser:xe}=ce(),k=de(),{openWindow:F}=me(),{fetchProfiles:H,fetchAllProfiles:M,setProfiles:C}=k,{getProfiles:_,getSelectedOffice:i,getLoadingState:P}=Z(k),r=c(i.value?i.value[8]:null),g=c("Profiles"),V=c("profiles"),w=c(""),D=c({sortBy:"1",descending:!1,rowsPerPage:150}),R=async l=>{const{data:o}=await O.fetchFromHiringApp({fields:[Y({type:"profiles",useQuery:{id:l}})]});return{id:l,data:o}},W=async l=>{if(l||_.value().length===0)if(r.value){const{data:o}=await O.fetchFromHiringApp({fields:[Y({type:"profiles",useQuery:{id:r.value}})]});C({selectedId:r.value,data:o})}else{const o=[];z().forEach(n=>{const X=R(n[8]);o.push(X)}),(await Promise.allSettled(o)).map(n=>n.value).forEach(n=>{C({selectedId:n.id,data:n.data})})}else return _.value(r.value)},q=l=>{r.value?H({selectedId:r.value,refresh:l}):M({can:"read",refresh:l})};q(),ee(i,()=>{r.value=i.value?i.value[8]:null,q()});const G=c(new Date),J=setInterval(()=>{G.value=new Date},1e3);te(()=>{clearInterval(J)});const K=y(()=>["index","submissionTime","name","phoneNumber","craft","latestScore","employmentStatus","action",...i.value?[]:["office"]]),h=y(()=>[{name:"index",align:"left",label:"#",sortable:!1},{name:"submissionTime",align:"left",label:"Time",field:"78",sortable:!1},{name:"name",align:"left",label:"Name",field:"24",sortable:!1},{name:"phoneNumber",align:"center",label:"Phone Number",field:"25",sortable:!1},{name:"craft",align:"center",label:"Craft",field:"52",sortable:!1},{name:"latestScore",align:"center",label:"Latest Score",field:"155",sortable:!1},{name:"employmentStatus",align:"center",label:"Employment Status",field:"56",sortable:!1},{name:"office",align:"center",label:"Office",field:"191",sortable:!1},{name:"action",align:"center",label:"",sortable:!1}]),f=y(()=>_.value(r.value).filter(l=>!0).sort((l,o)=>D.value.descending?l[1].isBefore(o[1]):l[1].isAfter(o[1]))),I=(l,o,a)=>{let s=o!==void 0?o(l,a):l;return s=s==null?"":String(s),s=s.split('"').join('""'),`"${s}"`},T=l=>{F(null,{url:`https://elitehcms.quickbase.com/db/bs7qsu6wh?a=dbpage&pageID=6&ee=${l[3]}`,name:"View Profile"})},$=()=>{const l=[h.value.map(a=>I(a.label))].concat(f.value.map(a=>h.value.map(s=>I(typeof s.field=="function"?s.field(a):a[s.field===void 0?s.name:s.field],s.format,a)).join(","))).join(`\r
`);ne(`${g.value} ${ue().format("MM.DD.YYYY")}.csv`,l,"text/csv")!==!0&&u.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})};return(l,o)=>(Q(),S("div",be,[e(fe),e(le,{flat:"",class:"q-pt-none"},{default:t(()=>[e(ae,null,{default:t(()=>[d("div",_e,[d("div",ge,[d("div",{class:L(["text-dark",m(u).screen.lt.md?"text-body1":"text-h5"])},p(g.value),3)]),e(B),d("div",we,[e(pe,{styleSelection:!0})])])]),_:1})]),_:1}),e(ve,{rows:f.value,columns:h.value,pagination:D.value,filter:w.value,title:g.value,separator:"vertical","row-key":"3",loading:m(P)(V.value),"visible-columns":K.value,downloadButton:!0,onDownload:$},{top:t(()=>[d("div",he,[e(oe,{dense:m(u).screen.lt.md,modelValue:w.value,"onUpdate:modelValue":o[0]||(o[0]=a=>w.value=a),label:"Search...",clearable:""},{prepend:t(()=>[e(x,{name:"search"})]),_:1},8,["dense","modelValue"])]),e(B),d("div",{class:L(["text-dark text-caption text-italic",m(u).screen.lt.md?"offset-xs-5":""])},"(Total: "+p(f.value.length)+")",3),e(N,{flat:"",round:"",color:"primary",icon:"download",disable:f.value.length<1,onClick:$},{default:t(()=>[e(E,{class:"bg-accent text-black shadow-4",offset:[10,10]},{default:t(()=>[v(" Download ")]),_:1})]),_:1},8,["disable"]),e(N,{flat:"",round:"",color:"primary",icon:"refresh",onClick:o[1]||(o[1]=a=>W(!0)),loading:m(P)(V.value)},{default:t(()=>[e(E,{class:"bg-accent text-black shadow-4",offset:[10,10]},{default:t(()=>[v(" Refresh ")]),_:1})]),_:1},8,["loading"])]),"body-cell-submissionTime":t(a=>[e(U,{props:a},{default:t(()=>[l.$dayjs(a.value).isValid()?(Q(),S("div",ye,p(a.value.format("L LT")),1)):(Q(),S("div",Qe,p(a.row[1].format("L LT")),1))]),_:2},1032,["props"])]),"body-cell-action":t(a=>[e(U,{props:a},{default:t(()=>[e(re,{split:"",color:"primary",label:"View Profile","menu-anchor":"bottom right",onClick:s=>T(a.row),size:".75rem"},{default:t(()=>[e(se,{class:"text-primary",separator:"",bordered:""},{default:t(()=>[e(j,{clickable:"",onClick:s=>T(a.row)},{default:t(()=>[e(b,{avatar:""},{default:t(()=>[e(x,{name:"person"})]),_:1}),e(b,null,{default:t(()=>[e(A,null,{default:t(()=>[v("CEM View Profile")]),_:1})]),_:1})]),_:2},1032,["onClick"]),e(j,{clickable:"",to:{name:"ee-hiring",params:{id:a.row[3]}}},{default:t(()=>[e(b,{avatar:""},{default:t(()=>[e(x,{name:"badge"})]),_:1}),e(b,null,{default:t(()=>[e(A,null,{default:t(()=>[v("Full Employee")]),_:1})]),_:1})]),_:2},1032,["to"])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination","filter","title","loading","visible-columns"])]))}};export{ot as default};
