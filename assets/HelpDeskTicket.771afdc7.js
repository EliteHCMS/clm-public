import{l as W,_ as G,bU as O,r as H,y as X,ap as J,bq as r,d as a,bN as K,cU as h,bR as Y,B as o,ab as m,cV as c,bP as Z,aw as x,cW as ee,bV as V,cT as oe,cz as te}from"./index.ffe008a3.js";import{a as F}from"./QSelect.ae55bb14.js";import{Q as se}from"./QTooltip.aa54978d.js";import{Q as ae}from"./QFile.1d69f4d5.js";import{Q as le}from"./QSpinnerGears.3d47a9c1.js";import{Q as re}from"./QForm.6fe618de.js";import{a as ie,u as i}from"./vee-validate.esm.d1883a78.js";import{a as E,c as d}from"./array.164cfe36.js";import{u as ne,b as de,q as ue}from"./app.5c870bdd.js";import{u as me}from"./use-quasar.8f886427.js";const pe=W({setup(){const e=me(),l=ne(),{userData:u,fullName:g}=O(l),{userType:y}=de(),q=u.value&&u.value[8]?u.value[8]:"",s=u.value&&u.value[6]?u.value[6]:"",P=[...s===""?["Personal Login Issues"]:[],"General Help","Data Updates & System Maintenance","Reporting","Security","Integration Maintenance/Failure","Bug",...s!==""?["Personal Login Issues"]:[]],w=["Worksite Management Portal","Craft Employee Management"],v=H(null),C=E({type:d().required().label("Type"),category:d().required().label("Category"),subject:d().required().label("Subject"),details:d().required().label("Details"),supportingFile:E().nullable().label("Supporting File"),requestedFor:d().required().label("Requested For"),contactPhone:d().matches(/^[+()0-9 .-]+$/,{excludeEmptyString:!0,message:"Valid Phone Number Only!"}).required().label("Contact Phone"),contactEmail:d().email().required().label("Contact Email"),additionalPeople:d().nullable().label("Additional People Affected")}),{meta:Q,errors:k,handleSubmit:T,handleReset:U,isSubmitting:_}=ie({validationSchema:C,initialValues:{type:"",category:y==="QuickBase User"?"Craft Employee Management":"Worksite Management Portal",requestedFor:g.value?g.value.includes("undefined")?"":g.value:"",contactPhone:q,contactEmail:s}}),{value:R}=i("type"),{value:j}=i("category"),{value:D}=i("subject"),{value:A}=i("details"),{value:M}=i("supportingFile"),{value:B}=i("requestedFor"),{value:$}=i("contactPhone"),{value:N}=i("contactEmail"),{value:I}=i("additionalPeople"),L=t=>new Promise((b,f)=>{const p=new FileReader;p.readAsDataURL(t),p.onload=()=>b(p.result.replace(/^data:.+;base64,/,"")),p.onerror=n=>f(n)}),z=T(async t=>{try{t.details=t.details?t.details.replace(/(\r\n|\n|\r)/gm," "):null,t.additionalPeople=t.additionalPeople?t.additionalPeople.replace(/(\r\n|\n|\r)/gm," "):null;const b=t.supportingFile&&t.supportingFile[0]?await L(t.supportingFile[0]):null,f=t.supportingFile&&t.supportingFile[0]?t.supportingFile[0].name:null;console.log(t);const p=[{7:{value:t.type},8:{value:t.category},6:{value:t.subject},10:{value:t.details},11:{value:b,filename:f},19:{value:t.requestedFor},21:{value:t.contactPhone},22:{value:t.contactEmail},23:{value:t.additionalPeople?t.additionalPeople:""}}],{data:n}=await ue.upsertRecordsXML({to:"btb8bh2ki",fieldsToReturn:[32],data:p,formatObject:32});if(console.log(n),n&&n[0]&&n[0][32]&&n[0][32][3])e.notify({position:"top-right",type:"positive",message:`Support Request ${n[0][32][3]} successfully added`});else throw"Error in adding support request";S()}catch(b){console.log(b),e.notify({position:"top-right",type:"negative",message:"There was a problem submitting request!"})}}),S=()=>{U(),v.value.hide()};return{types:P,categories:w,type:R,category:j,subject:D,details:A,supportingFile:M,requestedFor:B,contactPhone:$,contactEmail:N,additionalPeople:I,formMeta:Q,formErrors:k,submitTicket:z,closeAddTicket:S,addTicketDialog:v,isSubmitting:_}}}),ce=o("div",{class:"text-h6 text-weight-bold"},"Request Support",-1),be=o("div",{class:"text-primary text-h6 q-mb-sm"},"Support Details",-1),ge={class:"row"},fe={class:"col-12 col-md-6 q-pr-sm"},he={class:"text-caption"},ye={class:"col-12 col-md-6 q-pr-sm"},qe={class:"text-caption"},ve={class:"row"},Se={class:"col-12 q-pr-sm"},Ve={class:"text-caption q-pt-none"},Fe={class:"row"},Ee={class:"col-12 q-pr-sm"},Pe={class:"text-caption"},we={class:"row"},Ce={class:"col-12 col-md-8 q-pr-sm"},Qe=o("div",{class:"text-primary text-h6 q-mb-sm"},"Contact Information",-1),ke={class:"row"},Te={class:"col-12 col-md-8 q-pr-sm"},Ue={class:"text-caption"},_e={class:"row"},Re={class:"col-12 col-md-6 q-pr-sm"},je={class:"text-caption"},De={class:"col-12 col-md-6 q-pr-sm"},Ae={class:"text-caption"},Me={class:"row"},Be={class:"col-12 q-pr-sm"};function $e(e,l,u,g,y,q){return X(),J(te,{ref:"addTicketDialog"},{default:r(()=>[a(oe,{style:{width:"700px","max-width":"80vw"}},{default:r(()=>[a(re,{onSubmit:K(e.submitTicket,["prevent"])},{default:r(()=>[a(h,{class:"q-pb-xs"},{default:r(()=>[ce]),_:1}),a(Y,{color:"primary",class:"q-mb-sm"}),a(h,{class:"q-pt-none"},{default:r(()=>[be,o("div",ge,[o("div",fe,[a(F,{class:"q-mb-md",dense:"",outlined:"",label:"Type","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.type,"onUpdate:modelValue":l[0]||(l[0]=s=>e.type=s),options:e.types,"bottom-slots":"",error:!!e.formErrors.type,disable:e.isSubmitting},{error:r(()=>[o("div",he,m(e.formErrors.type),1)]),_:1},8,["modelValue","options","error","disable"])]),o("div",ye,[a(F,{class:"q-mb-md",dense:"",outlined:"",label:"App","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.category,"onUpdate:modelValue":l[1]||(l[1]=s=>e.category=s),options:e.categories,"bottom-slots":"",error:!!e.formErrors.category,disable:e.isSubmitting},{error:r(()=>[o("div",qe,m(e.formErrors.category),1)]),_:1},8,["modelValue","options","error","disable"])])]),o("div",ve,[o("div",Se,[a(c,{class:"q-mb-md",dense:"",outlined:"",maxlength:"100",label:"Subject",modelValue:e.subject,"onUpdate:modelValue":l[2]||(l[2]=s=>e.subject=s),"bottom-slots":"",error:!!e.formErrors.subject,disable:e.isSubmitting},{error:r(()=>[o("div",Ve,m(e.formErrors.subject),1)]),_:1},8,["modelValue","error","disable"])])]),o("div",Fe,[o("div",Ee,[a(c,{class:"q-mb-md",dense:"",outlined:"","input-style":"resize: none",maxlength:"2500",type:"textarea",modelValue:e.details,"onUpdate:modelValue":l[3]||(l[3]=s=>e.details=s),label:"Details","bottom-slots":"",error:!!e.formErrors.details,disable:e.isSubmitting},{error:r(()=>[o("div",Pe,m(e.formErrors.details),1)]),_:1},8,["modelValue","error","disable"])])]),o("div",we,[o("div",Ce,[a(ae,{dense:"",outlined:"","bottom-slots":"",modelValue:e.supportingFile,"onUpdate:modelValue":l[4]||(l[4]=s=>e.supportingFile=s),multiple:"",append:"","max-files":"1","use-chips":"",label:"Supporting File",disable:e.isSubmitting},{prepend:r(()=>[a(Z,{name:"attach_file"},{default:r(()=>[a(se,null,{default:r(()=>[x("Click in the box to add supporting file")]),_:1})]),_:1})]),_:1},8,["modelValue","disable"])])])]),_:1}),a(h,{class:"q-pt-none"},{default:r(()=>[Qe,o("div",ke,[o("div",Te,[a(c,{class:"q-mb-md",dense:"",outlined:"",maxlength:"100",label:"Requested For",modelValue:e.requestedFor,"onUpdate:modelValue":l[5]||(l[5]=s=>e.requestedFor=s),error:!!e.formErrors.requestedFor,"bottom-slots":"",disable:e.isSubmitting},{error:r(()=>[o("div",Ue,m(e.formErrors.requestedFor),1)]),_:1},8,["modelValue","error","disable"])])]),o("div",_e,[o("div",Re,[a(c,{class:"q-mb-md",dense:"",outlined:"",maxlength:"15",label:"Contact Phone",modelValue:e.contactPhone,"onUpdate:modelValue":l[6]||(l[6]=s=>e.contactPhone=s),error:!!e.formErrors.contactPhone,"bottom-slots":"",disable:e.isSubmitting},{error:r(()=>[o("div",je,m(e.formErrors.contactPhone),1)]),_:1},8,["modelValue","error","disable"])]),o("div",De,[a(c,{class:"q-mb-md",dense:"",outlined:"",maxlength:"100",label:"Contact Email",modelValue:e.contactEmail,"onUpdate:modelValue":l[7]||(l[7]=s=>e.contactEmail=s),error:!!e.formErrors.contactEmail,"bottom-slots":"",disable:e.isSubmitting},{error:r(()=>[o("div",Ae,m(e.formErrors.contactEmail),1)]),_:1},8,["modelValue","error","disable"])])]),o("div",Me,[o("div",Be,[a(c,{dense:"",outlined:"","input-style":"resize: none",maxlength:"2500",type:"textarea",modelValue:e.additionalPeople,"onUpdate:modelValue":l[8]||(l[8]=s=>e.additionalPeople=s),label:"Additional People Affected",disable:e.isSubmitting},null,8,["modelValue","disable"])])])]),_:1}),a(ee,{align:"right"},{default:r(()=>[a(V,{loading:e.isSubmitting,disable:e.isSubmitting,color:"primary",label:"Save & Close",type:"submit"},{loading:r(()=>[a(le)]),_:1},8,["loading","disable"]),a(V,{color:"secondary",label:"Cancel",onClick:e.closeAddTicket},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},512)}var Ke=G(pe,[["render",$e]]);export{Ke as h};
