import{l as Te,r as b,bW as we,bV as qe,bX as Le,c as h,w as C,_ as Pe,B as w,C as E,d as l,bt as n,cV as ne,cW as ie,E as s,ae as U,bT as W,bR as I,az as _,cX as le,bY as z,F as ye,b6 as We,bU as ge,at as De,dD as m,cY as _e,bQ as He,as as Ve}from"./index.8838c464.js";import{Q as Xe}from"./QPage.49220ad5.js";import{u as Se}from"./use-quasar.ed4be5d9.js";import{u as O}from"./useQuerySaver.d29ff9ee.js";import{c as Ke,q}from"./app.42c36b1f.js";import{u as Re}from"./dataStore.a53dbdfc.js";import{a as H,Q as ze}from"./QSelect.78b00ca7.js";import{Q as Ge}from"./QFile.e9e2ebe5.js";import{Q as Je}from"./QList.43880dff.js";import{Q as Ze}from"./QForm.fc17450c.js";import{a as xe,u as f}from"./vee-validate.esm.ac2c348d.js";import{a as G,b as he,c as se,e as J}from"./array.59f93f43.js";import{dayjs as A}from"./dayjs.106d80ab.js";import{b as et}from"./submitRelease.91018bd7.js";import{b as tt,a as at}from"./helpers.0499326f.js";import{u as ot}from"./dataStore.3ad5bd5e.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.ca6e9d39.js";import"./index.04bc0a32.js";import"./i18n.c69e89dd.js";import"./QChip.5ba75959.js";import"./QMenu.b8edc490.js";import"./position-engine.cba8bd09.js";import"./selection.26380b58.js";import"./rtl.b51694b1.js";const lt=Te({emits:["releaseSubmitted"],props:{record:Object,employee:Object},setup(e,{emit:a}){const Y=b(!1),F=b(!1),y=b(null),D=b(!1),t=b([]),g=b([]),j=b(A().add(1,"Month").format("YYYY-MM-DD")),N=Se(),V=we(),X=qe(),B=Ke(),{getTermReasons:Q,setTermReasons:K}=Re(),{getAssignments:p,fetchAssignments:$}=ot(),{fetchProjectUsers:Z}=B,{getProjectUsers:x}=Le(B),ee=h(()=>["Without Reservation","With Some Reservation","Would Not Recommend"]),i=h(()=>p(e.record[74]).length>0?p(e.record[74]).filter(o=>o[3]!==e.record[3]).sort((o,r)=>o[75]>r[75]?1:-1):[]),u=h(()=>[...i.value,...g.value]),v=h(()=>x.value(e.record[74])),k=b(u.value);C(v,o=>{o&&o.length>0&&fe()});const Ue=h(()=>G({selection:G().required().nullable().label("Reason"),lastDay:he().min(A().subtract(6,"months").format("YYYY-MM-DD")).max(A().add(2,"months").format("YYYY-MM-DD")).required().label("Last Day On Site"),effective:he().min(A().subtract(6,"months").format("YYYY-MM-DD")).max(A().add(2,"months").format("YYYY-MM-DD")).required().label("Effective Date"),category:se().nullable(),attendance:J().required().label("Attendance"),capability:J().required().label("Capability"),attitude:J().required().label("Attitude"),promotable:J().required().label("Promotability"),comments:se().nullable().label("Comments"),equipment:G().required().nullable().label("Equipment Returned"),supervisor:G().nullable().label("Supervisor").required(),recommendation:se().nullable().label("Recommendation").required()})),{errors:Ae,handleSubmit:Ee,handleReset:te}=xe({validationSchema:Ue,initialValues:{}}),{value:T}=f("selection"),{value:M}=f("lastDay"),{value:S}=f("effective"),{value:L}=f("category"),{value:ae}=f("attachments"),{value:re}=f("capability"),{value:de}=f("attendance"),{value:ue}=f("attitude"),{value:me}=f("promotable"),{value:Ce}=f("comments"),{value:pe}=f("equipment"),{value:Ye}=f("supervisor"),{value:Fe}=f("recommendation"),P=h(()=>{const o=Q();return L.value?o.filter(r=>r[6]===L.value).sort((r,d)=>r[12]>d[12]?1:-1):o.sort((r,d)=>r[12]>d[12]?1:-1)});V.query&&V.query.reason==="no-show"&&(L.value="Voluntary",P.value.length>0&&(D.value=!0,T.value=P.value.find(o=>o[3]===6)),M.value=A().format("YYYY-MM-DD"),S.value=A().format("YYYY-MM-DD"),pe.value={value:!0,label:"None Issued"},re.value="0",de.value="0",ue.value="0",me.value="0"),C(P,(o,r)=>{V.query&&V.query.reason==="no-show"&&D.value===!1&&(D.value=!0,T.value=P.value.find(d=>d[3]===6))}),C(L,(o,r)=>{T.value=null}),C(S,o=>{(!M.value||M.value==="")&&(M.value=o)}),C(M,o=>{(!S.value||S.value==="")&&(S.value=o)});const $e=Ee(async o=>{if(F.value&&t.value.length===0)N.dialog({title:"Alert",message:"Supporting documents are required for this reason!"});else{const r={capability:o.capability,attendance:o.attendance,attitude:o.attitude,promotable:o.promotable,comments:o.comments?o.comments.replace(/(\r\n|\n|\r)/gm," "):null};N.dialog({title:"Confirm",message:"Are you sure you want to release this employee?",cancel:!0,persistent:!0}).onOk(async()=>{try{Y.value=!0;const{release:d,employee:c,assignment:R}=await et({employee:e.employee,assignment:e.record,values:o,effectiveNow:!ce.value,attachments:t.value,ratings:r,supervisor:o.supervisor});a("releaseSubmitted",{release:d,employee:c,assignment:R,effectiveNow:!ce.value}),te()}catch{Y.value=!1,N.notify({type:"negative",message:"Cannot submit release."})}})}}),ke=()=>{N.dialog({title:"Confirm",message:"Are you sure you want to cancel?",cancel:!0,persistent:!0}).onOk(()=>{te(),X.go(-1)})};C(T,(o,r)=>{o&&o[19]?(F.value=!0,ae.value=!0):(ae.value=!1,F.value=!1)});const Ne=h(()=>{const o=Q();return[...new Map(o.map(r=>[r[6],r[6]])).values()]}),ce=h(()=>S.value&&S.value!==""?A().isBefore(A(S.value)):!1),Qe=o=>new Promise((r,d)=>{const c=new FileReader;c.readAsDataURL(o),c.onload=()=>r(c.result.replace(/^data:.+;base64,/,"")),c.onerror=R=>d(R)});C(y,o=>{o&&ve()});const ve=()=>{y.value&&y.value.forEach(async o=>{const r={6:{value:await Qe(o),filename:o.name},7:{value:o.name}};t.value.push(r),y.value=null})},Me=o=>{t.value.splice(o,1)},Ie=async()=>{if(Z({selectedId:e.record[74]}),Q().length===0){const{data:o}=await q.fetchFromHiringApp({fields:[O({type:"termReasons",query:"{'11'.EX.'true'}"})]});K({reasons:o})}$({projectId:e.record[74]})},Oe=async o=>{const r=await tt(o[6].value);at(r,o[6].filename)},fe=async()=>{v.value.forEach(async o=>{if(o[65]&&o[63]&&o[63]!=="")i.value.find(d=>d[18]===o[65])||g.value.push({18:o[65],3:null,75:o[66],104:o[63]});else if(o[63]&&o[63]!==""){const r=[{9:{value:o[63]},7:{value:"Table Query"},8:{value:`{378.EX.'${o[63]}'}OR{26.EX.'${o[10]}'}`},14:{value:549},6:{value:"bp3gb7ng2"}}],{data:d}=await q.fetchFromHiringApp({fields:r});if(d&&d.length===1){const c=d[0][378]!==""?d[0][378]:o[63];i.value.find(oe=>oe[18]===d[0][3])||g.value.push({18:d[0][3],3:null,75:o[66].trim(),104:c});const be={3:{value:o[6]},80:{value:d[0][3]},70:{value:c}};await q.upsertRecordsXML({to:"br4pxrbs6",data:[be],fieldsToReturn:[3]})}else if(d&&d.length>1){const c=d.find(R=>R[378]===o[63]);if(c){const R=c[378]!==""?c[378]:o[63];i.value.find(Be=>Be[18]===c[3])||g.value.push({18:c[3],3:null,75:o[66].trim(),104:R});const oe={3:{value:o[6]},80:{value:c[3]},70:{value:R}};await q.upsertRecordsXML({to:"br4pxrbs6",data:[oe],fieldsToReturn:[3]})}}}})};v.value&&v.value.length>0&&fe();const je=(o,r)=>{if(o===""){r(()=>{k.value=u.value});return}r(()=>{const d=o.toLowerCase();k.value=u.value.filter(c=>c[75].toLowerCase().indexOf(d)>-1||c[104].toLowerCase().indexOf(d)>-1)})};return Ie(),{props:e,options:P,primaryReasons:Ne,category:L,selection:T,effective:S,lastDay:M,attachments:ae,capability:re,attendance:de,attitude:ue,promotable:me,comments:Ce,equipment:pe,supervisor:Ye,attachmentsRequired:F,fileAttachment:y,attachedFiles:t,recommendation:Fe,recommendationOptions:ee,maxDate:j,submit:$e,formErrors:Ae,handleReset:te,cancelRelease:ke,showFiles:ve,deleteFile:Me,getAssignments:p,disableSubmit:Y,downloadFile:Oe,supervisorOptions:k,projectUsers:v,filterFn:je}}}),st={class:"row"},nt={class:"col-12 col-md-4 q-px-sm"},it=s("div",{class:"text-caption"},"Is this release voluntary or involuntary?",-1),rt={class:"text-caption"},dt={class:"col-12 col-md-4 q-pl-xs q-pr-sm"},ut=s("div",{class:"text-caption"},"What is the reason for this release?",-1),mt={class:"text-caption"},pt={class:"col-12 col-md-4 q-pl-xs q-pr-sm"},ct=s("div",{class:"text-caption"},"Effective Date",-1),vt={class:"text-caption"},ft={class:"row"},bt={class:"col-12 col-md-4 q-pl-xs q-pr-sm"},yt=s("div",{class:"text-caption"},"When is the employee's last day on site?",-1),gt={class:"text-caption"},Vt={class:"col-12 col-md-4 q-pl-xs q-pr-sm"},ht=s("div",{class:"text-caption"},"Has all Company Equipment been returned?",-1),wt={class:"text-caption"},qt={class:"row items-top justify-between q-mt-sm"},Dt={class:"col-4 q-pl-xs q-pr-sm"},St={key:0,class:"text-body2 text-negative text-italic"},Rt={key:0},Ut={key:1},At={key:1,class:"text-body2 text-dark text-italic"},Et=s("span",null,"**Supporting documents are optional for this reason.",-1),Ct=[Et],Yt={key:0,class:"col-6 q-pl-xs q-pr-sm"},Ft=s("div",{class:"text-body1 text-info q-mb-sm"},"Attached Documents",-1),$t=["onClick"],kt={class:"row q-my-md"},Nt={class:"col-12"},Qt=s("div",{class:"q-pa-sm"},[s("div",{class:"text-h6 text-bold"},"CAAP Rating"),s("div",{class:"text-body1 text-dark text-italic"},"Capability, Attendance, Attitude, and Promotability"),s("div",{class:"text-body2 text-accent q-mt-sm"},"Select how much you agree with each of the following statements.")],-1),Mt={class:"q-pb-sm"},It=s("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee is capable of performing their assigned job.",-1),Ot={class:"q-pb-sm"},jt=s("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee regularly shows up to work on time.",-1),Bt={class:"q-pb-sm"},Tt=s("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee has a good attitude.",-1),Lt={class:"q-pb-sm"},Pt=s("div",{class:"text-body2 text-info text-bold q-mb-sm"},"I am confident that this employee can be promoted in the future.",-1),Wt={class:"row q-mt-md"},_t={class:"col-12 col-md-5"},Ht=s("div",{class:"text-body2 text-weight-bold text-info"}," Who conducted this evaluation? ",-1),Xt={class:"text-caption"},Kt={class:"row q-mt-md"},zt={class:"col-12 col-md-5"},Gt=s("div",{class:"text-body2 text-weight-bold text-info"}," Supervisor Recommendation for Rehire ",-1),Jt={class:"text-caption"},Zt={class:"row q-py-sm"},xt={class:"col-12"};function ea(e,a,Y,F,y,D){return w(),E("div",null,[l(Ze,{onSubmit:He(e.submit,["prevent"])},{default:n(()=>[l(ne,null,{default:n(()=>[l(ie,null,{default:n(()=>[s("div",st,[s("div",nt,[it,l(H,{dense:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.category,"onUpdate:modelValue":a[0]||(a[0]=t=>e.category=t),options:e.primaryReasons},{error:n(()=>[s("div",rt,U(e.formErrors.selection),1)]),"no-option":n(()=>[l(W,null,{default:n(()=>[l(I,{class:"text-grey"},{default:n(()=>[_(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),s("div",dt,[ut,l(H,{dense:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.selection,"onUpdate:modelValue":a[1]||(a[1]=t=>e.selection=t),options:e.options,"option-label":"12","display-value":`${e.selection?e.selection[12]:""}`,"bottom-slots":"",error:!!e.formErrors.selection,disable:!e.category},{error:n(()=>[s("div",mt,U(e.formErrors.selection),1)]),"no-option":n(()=>[l(W,null,{default:n(()=>[l(I,{class:"text-grey"},{default:n(()=>[_(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","display-value","error","disable"])]),s("div",pt,[ct,l(le,{dense:"",type:"date",modelValue:e.effective,"onUpdate:modelValue":a[2]||(a[2]=t=>e.effective=t),error:!!e.formErrors.effective,"bottom-slots":""},{error:n(()=>[s("div",vt,U(e.formErrors.effective),1)]),_:1},8,["modelValue","error"])])]),s("div",ft,[s("div",bt,[yt,l(le,{dense:"",type:"date",max:e.maxDate,modelValue:e.lastDay,"onUpdate:modelValue":a[3]||(a[3]=t=>e.lastDay=t),error:!!e.formErrors.lastDay,"bottom-slots":""},{error:n(()=>[s("div",gt,U(e.formErrors.lastDay),1)]),_:1},8,["max","modelValue","error"])]),s("div",Vt,[ht,l(H,{dense:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.equipment,"onUpdate:modelValue":a[4]||(a[4]=t=>e.equipment=t),options:[{value:!0,label:"Yes"},{value:!1,label:"No"},{value:!0,label:"None Issued"}],"bottom-slots":"",error:!!e.formErrors.equipment},{error:n(()=>[s("div",wt,U(e.formErrors.equipment),1)]),_:1},8,["modelValue","error"])])]),s("div",qt,[s("div",Dt,[l(Ge,{dense:"","bottom-slots":"",modelValue:e.fileAttachment,"onUpdate:modelValue":a[5]||(a[5]=t=>e.fileAttachment=t),multiple:"",append:"",label:"Attach Supporting Documents"},{append:n(()=>[l(z,{dense:"",color:"info",round:"",flat:"",icon:"attach_file"})]),_:1},8,["modelValue"]),e.attachmentsRequired?(w(),E("div",St,[_("!! "),e.selection[12].toLowerCase().includes("attendance")?(w(),E("span",Rt,"Supporting attendance records must be attached.")):(w(),E("span",Ut,"Supporting documents are required for this reason."))])):(w(),E("div",At,Ct))]),e.attachedFiles.length>0?(w(),E("div",Yt,[Ft,l(Je,{dense:""},{default:n(()=>[(w(!0),E(ye,null,We(e.attachedFiles,(t,g)=>(w(),E(ye,{key:t},[l(W,null,{default:n(()=>[l(I,null,{default:n(()=>[l(ze,null,{default:n(()=>[s("a",{href:"javascript:void(0);",onClick:j=>e.downloadFile(t)},U(g+1)+". "+U(t[6].filename),9,$t)]),_:2},1024)]),_:2},1024),l(I,{side:""},{default:n(()=>[l(z,{color:"accent",round:"",flat:"",class:"cursor-pointer",icon:"delete",size:"md",onClick:j=>e.deleteFile(g)},null,8,["onClick"])]),_:2},1024)]),_:2},1024),l(ge)],64))),128))]),_:1})])):De("",!0)])]),_:1})]),_:1}),l(ge),s("div",kt,[s("div",Nt,[Qt,l(ne,null,{default:n(()=>[l(ie,null,{default:n(()=>[s("div",null,[s("div",Mt,[It,l(m,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[6]||(a[6]=t=>e.capability=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),l(m,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[7]||(a[7]=t=>e.capability=t),val:"2",label:"Disagree"},null,8,["modelValue"]),l(m,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[8]||(a[8]=t=>e.capability=t),val:"3",label:"Neutral"},null,8,["modelValue"]),l(m,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[9]||(a[9]=t=>e.capability=t),val:"4",label:"Agree"},null,8,["modelValue"]),l(m,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[10]||(a[10]=t=>e.capability=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),l(m,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[11]||(a[11]=t=>e.capability=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),s("div",Ot,[jt,l(m,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[12]||(a[12]=t=>e.attendance=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),l(m,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[13]||(a[13]=t=>e.attendance=t),val:"2",label:"Disagree"},null,8,["modelValue"]),l(m,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[14]||(a[14]=t=>e.attendance=t),val:"3",label:"Neutral"},null,8,["modelValue"]),l(m,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[15]||(a[15]=t=>e.attendance=t),val:"4",label:"Agree"},null,8,["modelValue"]),l(m,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[16]||(a[16]=t=>e.attendance=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),l(m,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[17]||(a[17]=t=>e.attendance=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),s("div",Bt,[Tt,l(m,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[18]||(a[18]=t=>e.attitude=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),l(m,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[19]||(a[19]=t=>e.attitude=t),val:"2",label:"Disagree"},null,8,["modelValue"]),l(m,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[20]||(a[20]=t=>e.attitude=t),val:"3",label:"Neutral"},null,8,["modelValue"]),l(m,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[21]||(a[21]=t=>e.attitude=t),val:"4",label:"Agree"},null,8,["modelValue"]),l(m,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[22]||(a[22]=t=>e.attitude=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),l(m,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[23]||(a[23]=t=>e.attitude=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),s("div",Lt,[Pt,l(m,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[24]||(a[24]=t=>e.promotable=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),l(m,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[25]||(a[25]=t=>e.promotable=t),val:"2",label:"Disagree"},null,8,["modelValue"]),l(m,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[26]||(a[26]=t=>e.promotable=t),val:"3",label:"Neutral"},null,8,["modelValue"]),l(m,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[27]||(a[27]=t=>e.promotable=t),val:"4",label:"Agree"},null,8,["modelValue"]),l(m,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[28]||(a[28]=t=>e.promotable=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),l(m,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[29]||(a[29]=t=>e.promotable=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])])]),s("div",Wt,[s("div",_t,[Ht,l(H,{"use-input":"",dense:"","input-debounce":"0",clearable:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.supervisor,"onUpdate:modelValue":a[30]||(a[30]=t=>e.supervisor=t),options:e.supervisorOptions,"option-label":t=>`${t[75]} - ${t[104]}`,"display-value":`${e.supervisor?e.supervisor[75]:""}`,onFilter:e.filterFn,"bottom-slots":"",error:!!e.formErrors.supervisor,hint:"Ex: Employee's Supervisor"},{error:n(()=>[s("div",Xt,U(e.formErrors.supervisor),1)]),"no-option":n(()=>[l(W,null,{default:n(()=>[l(I,{class:"text-grey"},{default:n(()=>[_(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","display-value","onFilter","error"])])]),s("div",Kt,[s("div",zt,[Gt,l(H,{dense:"",clearable:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.recommendation,"onUpdate:modelValue":a[31]||(a[31]=t=>e.recommendation=t),options:e.recommendationOptions,"bottom-slots":"",error:!!e.formErrors.recommendation},{error:n(()=>[s("div",Jt,U(e.formErrors.recommendation),1)]),"no-option":n(()=>[l(W,null,{default:n(()=>[l(I,{class:"text-grey"},{default:n(()=>[_(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","error"])])])]),_:1})]),_:1})])]),s("div",Zt,[s("div",xt,[l(le,{filled:"",type:"textarea",modelValue:e.comments,"onUpdate:modelValue":a[32]||(a[32]=t=>e.comments=t),label:"Comments"},null,8,["modelValue"])])]),l(_e,{align:"right"},{default:n(()=>[l(z,{disable:e.disableSubmit,color:"info",label:"Submit",type:"submit"},null,8,["disable"]),l(z,{color:"secondary",label:"Cancel",onClick:e.cancelRelease},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])])}var ta=Pe(lt,[["render",ea]]);const aa={class:"q-pa-sm"},oa={class:"row"},la={class:"col-12"},sa=s("div",{class:"text-h6 text-weight-bold q-mb-md"},"Please complete the following to submit this release.",-1),Fa={__name:"terminate",setup(e){b(0);const a=we(),Y=qe(),F=Se(),y=b("employee"),D=b(null),t=b(null),g=b(0);y.value=a.query.reason==="no-show"?"arrivals":"employee",y.value==="no-show"&&(D.value=a.query.aid,t.value=a.query.did);const{getEmployee:j,getAssignmentsByEmployee:N,setAssignmentsByEmployee:V,setEmployees:X,setReleases:B,setReleasesByAssignment:Q,setReleasesByEmployee:K}=Re(),p=h(()=>j(a.params.id)),$=h(()=>p.value?N(a.params.id):null),Z=async()=>{if(!$.value&&p.value[577]&&p.value[577]>0){const{data:i}=await q.fetchFromHiringApp({fields:[O({type:"assignments",query:"",id:p.value[577]})]});V({id:p.value[3],data:i})}else if(p.value[577]&&p.value[577]>0)await q.fetchFromHiringApp({fields:[O({type:"assignments",query:"",id:p.value[577]})]});else if(!$.value&&D.value&&D.value>0){const{data:i}=await q.fetchFromHiringApp({fields:[O({type:"assignments",query:"",id:D.value})]});V({id:p.value[3],data:i})}else if(!$.value&&p.value[608]&&p.value[608]>0){const{data:i}=await q.fetchFromHiringApp({fields:[O({type:"assignments",query:"",id:p.value[608]})]});V({id:p.value[3],data:i})}else{const i=O({type:"assignments",query:"",id:p.value[577]});i[8]={value:`{3.EX.${a.query.aid}}`};const{data:u}=await q.fetchFromHiringApp({fields:[i]});V({id:p.value[3],data:u})}};C(p,(i,u)=>{i&&g.value===0&&(Z(),g.value++)});const x=async({employee:i,release:u,assignment:v,effectiveNow:k})=>{y.value==="arrivals"&&a.query.did&&await ee(a.query.did,u),F.notify({type:"positive",message:"Release successfully submitted."}),k?(i[581]=u[3],B({id:u[3],data:u}),X({id:i[3],data:i}),V({id:i[3],assignment:v}),Q({id:v[3],data:u}),K({id:i[3],data:u})):(i[581]=u[3],X({id:i[3],data:i}),B({id:u[3],data:u}),Q({id:v[3],data:u}),K({id:i[3],data:u})),y.value==="arrivals"?Y.replace({name:"arrivals"}):Y.replace({name:"view-ee-release",params:{id:i[3],release:u[3]}})};async function ee(i,u){try{let v=7;u[33]==="Terminate_Employee_Voluntary_Never_Started_Working"?v=7:(u[33]==="Terminate_Employee_Involuntary_Lack_of_Work_End_of_Contract_Project"||u[33]==="Terminate_Employee_Involuntary_Project_Cancelled_Before_Employee_Started")&&(v=8);const{data:k}=await q.upsertRecordsXML({to:"bp3gaymc3",data:[{3:{value:i},20:{value:"DNC"},61:{value:v},63:{value:u[33]},74:{value:new Date}}],fieldsToReturn:[204],formatObject:204});return k[0][204]}catch(v){throw{message:"Cannot edit deployment",error:v}}}return(i,u)=>(w(),Ve(Xe,{style:{"max-width":"100vw"}},{default:n(()=>[s("div",aa,[s("div",oa,[s("div",la,[l(ne,{flat:""},{default:n(()=>[$.value?(w(),Ve(ie,{key:0},{default:n(()=>[sa,l(ta,{record:$.value,employee:p.value,onReleaseSubmitted:x},null,8,["record","employee"])]),_:1})):De("",!0)]),_:1})])])])]),_:1}))}};export{Fa as default};
