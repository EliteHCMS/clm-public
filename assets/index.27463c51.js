import{c as q,bW as Oe,i as Xe,cp as He,dA as Ee,h as W,bV as D,bP as de,cB as Te,g as Me,b$ as Ye,c2 as We,r as V,d9 as Ke,c7 as Ge,a$ as Ze,bX as xe,l as H,_ as I,b4 as E,y as u,z as N,d as l,bq as r,B as c,ab as A,aq as R,cV as ee,bN as ke,ap as $,cz as ve,D as Pe,cU as M,F as re,b3 as ce,cT as J,bS as ye,aw as Re,v as Ue,bU as Fe,au as ea,bR as aa,cW as ae,bs as ta,w as sa,E as oa,bT as la}from"./index.8e33b0c3.js";import{Q as $e,a as na,b as we}from"./QTabPanels.f4cc6ed4.js";import{Q as ra}from"./QTabs.a9fb45b3.js";import{Q as Qe}from"./QPage.d83c4250.js";import{u as x}from"./use-quasar.cb503685.js";import{q as Q,u as fe,b as ia}from"./app.b339b179.js";import{dayjs as K}from"./dayjs.5512aee7.js";import{a as X,c as ne,f as je}from"./array.164cfe36.js";import{a as Ce,b as ua}from"./useQuerySaver.d29ff9ee.js";import{u as ie}from"./dataStore.876ce2d7.js";import{a as me}from"./QSelect.8316c945.js";import{Q as _e}from"./QForm.43a2c7ab.js";import{a as Ae,u as z}from"./vee-validate.esm.f6f18325.js";import{A as da,a as ca}from"./addNewCustomer.234299f2.js";import{a as Ne,Q as De}from"./QTable.55a4462a.js";import{Q as ge}from"./QTr.4d1e8294.js";import{Q as he}from"./QTd.ad255b63.js";import{N as ma}from"./nameRequestData.6d4e281a.js";import{u as fa}from"./index.32531c7f.js";import{P as ba}from"./projectPipeline.b1661b85.js";import{C as pa}from"./ClosePopup.db552d34.js";import{u as Ie,P as va,c as ga}from"./pay-rate-v2.424b7c0b.js";import{p as ha}from"./VueTelInput.e663a97a.js";import"./jobs.f187100d.js";import"./use-panel.5b38453a.js";import"./touch.3df10340.js";import"./selection.4231ac67.js";import"./QResizeObserver.e268dbef.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.aedf7e5a.js";import"./index.04bc0a32.js";import"./i18n.3befcc18.js";import"./QChip.12e4a464.js";import"./QMenu.d82e9973.js";import"./position-engine.c86eec0a.js";import"./states.03e3d448.js";import"./QList.84cef65e.js";import"./QMarkupTable.bfddb59b.js";import"./use-fullscreen.95b8bb98.js";import"./QSpinnerGears.41b69879.js";import"./QTooltip.f2b16a34.js";import"./QInnerLoading.86997952.js";import"./export-file.dc78ba05.js";const ya=["top","right","bottom","left"],Be={type:{type:String,default:"a"},outline:Boolean,push:Boolean,flat:Boolean,unelevated:Boolean,color:String,textColor:String,glossy:Boolean,square:Boolean,padding:String,label:{type:[String,Number],default:""},labelPosition:{type:String,default:"right",validator:e=>ya.includes(e)},externalLabel:Boolean,hideLabel:{type:Boolean},labelClass:[Array,String,Object],labelStyle:[Array,String,Object],disable:Boolean,tabindex:[Number,String]};function ze(e,t){return{formClass:q(()=>`q-fab--form-${e.square===!0?"square":"rounded"}`),stacked:q(()=>e.externalLabel===!1&&["top","bottom"].includes(e.labelPosition)),labelProps:q(()=>{if(e.externalLabel===!0){const d=e.hideLabel===null?t.value===!1:e.hideLabel;return{action:"push",data:{class:[e.labelClass,`q-fab__label q-tooltip--style q-fab__label--external q-fab__label--external-${e.labelPosition}`+(d===!0?" q-fab__label--external-hidden":"")],style:e.labelStyle}}}return{action:["left","top"].includes(e.labelPosition)?"unshift":"push",data:{class:[e.labelClass,`q-fab__label q-fab__label--internal q-fab__label--internal-${e.labelPosition}`+(e.hideLabel===!0?" q-fab__label--internal-hidden":"")],style:e.labelStyle}}})}}const Je={start:"self-end",center:"self-center",end:"self-start"},qa=Object.keys(Je);var ue=Oe({name:"QFabAction",props:{...Be,icon:{type:String,default:""},anchor:{type:String,validator:e=>qa.includes(e)},to:[String,Object],replace:Boolean},emits:["click"],setup(e,{slots:t,emit:d}){const s=Xe(Ee,()=>({showing:{value:!0},onChildClick:He})),{formClass:m,labelProps:v}=ze(e,s.showing),a=q(()=>{const g=Je[e.anchor];return m.value+(g!==void 0?` ${g}`:"")}),o=q(()=>e.disable===!0||s.showing.value!==!0);function b(g){s.onChildClick(g),d("click",g)}function _(){const g=[];return t.icon!==void 0?g.push(t.icon()):e.icon!==""&&g.push(W(de,{name:e.icon})),(e.label!==""||t.label!==void 0)&&g[v.value.action](W("div",v.value.data,t.label!==void 0?t.label():[e.label])),Te(t.default,g)}const i=Me();return Object.assign(i.proxy,{click:b}),()=>W(D,{class:a.value,...e,noWrap:!0,stack:e.stacked,icon:void 0,label:void 0,noCaps:!0,fabMini:!0,disable:o.value,onClick:b},_)}});const $a=["up","right","down","left"],wa=["left","center","right"];var Le=Oe({name:"QFab",props:{...Be,...Ye,icon:String,activeIcon:String,hideIcon:Boolean,hideLabel:{default:null},direction:{type:String,default:"right",validator:e=>$a.includes(e)},persistent:Boolean,verticalActionsAlign:{type:String,default:"center",validator:e=>wa.includes(e)}},emits:We,setup(e,{slots:t}){const d=V(null),s=V(e.modelValue===!0),m=Ke(),{proxy:{$q:v}}=Me(),{formClass:a,labelProps:o}=ze(e,s),b=q(()=>e.persistent!==!0),{hide:_,toggle:i}=Ge({showing:s,hideOnRouteChange:b}),g=q(()=>({opened:s.value})),C=q(()=>`q-fab z-fab row inline justify-center q-fab--align-${e.verticalActionsAlign} ${a.value}`+(s.value===!0?" q-fab--opened":" q-fab--closed")),S=q(()=>`q-fab__actions flex no-wrap inline q-fab__actions--${e.direction} q-fab__actions--${s.value===!0?"opened":"closed"}`),p=q(()=>{const w={id:m.value,role:"menu"};return s.value!==!0&&(w["aria-hidden"]="true"),w}),n=q(()=>`q-fab__icon-holder  q-fab__icon-holder--${s.value===!0?"opened":"closed"}`);function k(w,P){const L=t[w],F=`q-fab__${w} absolute-full`;return L===void 0?W(de,{class:F,name:e[P]||v.iconSet.fab[P]}):W("div",{class:F},L(g.value))}function B(){const w=[];return e.hideIcon!==!0&&w.push(W("div",{class:n.value},[k("icon","icon"),k("active-icon","activeIcon")])),(e.label!==""||t.label!==void 0)&&w[o.value.action](W("div",o.value.data,t.label!==void 0?t.label(g.value):[e.label])),Te(t.tooltip,w)}return Ze(Ee,{showing:s,onChildClick(w){_(w),d.value!==null&&d.value.$el.focus()}}),()=>W("div",{class:C.value},[W(D,{ref:d,class:a.value,...e,noWrap:!0,stack:e.stacked,align:void 0,icon:void 0,label:void 0,noCaps:!0,fab:!0,"aria-expanded":s.value===!0?"true":"false","aria-haspopup":"true","aria-controls":m.value,onClick:i},B),W("div",{class:S.value,...p.value},xe(t.default))])}});const Ca=H({emits:["cancelEdit"],components:{AddProjectLocationForm:da,AddCustomerForm:ca},props:{config:Object},setup(e,{emit:t}){const d=V(null),s=V(null),m=V(!1),v=async()=>{const{type:p,initialValue:n}=e.config;if(p==="options"){const{getter:k}=e.config;s.value=await k(),d.value=s.value,i.value=n(d.value)}else i.value=n},a=q(()=>X({entry:e.config.formRules})),{meta:o,errors:b,handleSubmit:_}=Ae({validationSchema:a}),{value:i}=z("entry"),g=(p,n)=>{const{filter:k}=e.config;p===""&&n(()=>{d.value=s.value}),n(()=>{const B=p.toLowerCase();d.value=k(s.value,B)})},C=p=>{m.value=!1,s.value.push(p),d.value.push(p),i.value=p},S=_(async p=>{const{setter:n}=e.config;await n(p.entry),t("cancelEdit")});return v(),{rawOptions:s,options:d,entry:i,formErrors:b,formMeta:o,submit:S,filterOptions:g,addNew:m,newOptionAdded:C}}}),Ra={key:0,class:"q-pr-xl"},Na={class:"text-caption"},ka={key:0,class:"text-center bg-info"},_a={key:0,class:"text-center bg-info"},Aa={key:1,class:"q-pr-xl"},Va={class:"text-caption"};function Sa(e,t,d,s,m,v){const a=E("add-project-location-form"),o=E("add-customer-form");return u(),N("div",null,[l(_e,{onSubmit:ke(e.submit,["prevent"])},{default:r(()=>[e.config.type==="options"?(u(),N("div",Ra,[l(me,{class:"q-mb-sm",dense:"",label:`Select a ${e.config.fieldLabel}`,"transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.entry,"onUpdate:modelValue":t[3]||(t[3]=b=>e.entry=b),options:e.options,"option-label":e.config.optionLabel,"display-value":`${e.entry?e.entry[e.config.displayValue]:""}`,"bottom-slots":"",error:!!e.formErrors.entry,"stack-label":"","use-input":"",behavior:e.$q.platform.is.ios===!0?"dialog":"menu","input-debounce":"0",onFilter:e.filterOptions,clearable:"",loading:!e.rawOptions,disable:!e.rawOptions},{error:r(()=>[c("div",Na,A(e.formErrors.entry),1)]),after:r(()=>[l(D,{type:"submit",color:"info",icon:"done",dense:"",onClick:e.submit},null,8,["onClick"]),l(D,{color:"dark",icon:"close",dense:"",onClick:t[0]||(t[0]=b=>e.$emit("cancelEdit"))})]),"after-options":r(()=>[e.config.allowNew&&e.options&&e.options.length>0?(u(),N("div",ka,[l(D,{flat:"",color:"white",label:`Add a New ${e.config.fieldLabel}`,onClick:t[1]||(t[1]=b=>e.addNew=!0)},null,8,["label"])])):R("",!0)]),"no-option":r(()=>[e.config.allowNew?(u(),N("div",_a,[l(D,{flat:"",color:"white",label:`Add a New ${e.config.fieldLabel}`,onClick:t[2]||(t[2]=b=>e.addNew=!0)},null,8,["label"])])):R("",!0)]),_:1},8,["label","modelValue","options","option-label","display-value","error","behavior","onFilter","loading","disable"])])):R("",!0),e.config.type==="input"?(u(),N("div",Aa,[l(ee,{class:"q-mb-sm",dense:"",label:e.config.fieldLabel,modelValue:e.entry,"onUpdate:modelValue":t[5]||(t[5]=b=>e.entry=b),"bottom-slots":"",error:!!e.formErrors.entry,"stack-label":""},{error:r(()=>[c("div",Va,A(e.formErrors.entry),1)]),after:r(()=>[l(D,{type:"submit",color:"info",icon:"done",dense:"",onClick:e.submit},null,8,["onClick"]),l(D,{color:"dark",icon:"close",dense:"",onClick:t[4]||(t[4]=b=>e.$emit("cancelEdit"))})]),_:1},8,["label","modelValue","error"])])):R("",!0)]),_:1},8,["onSubmit"]),l(ve,{modelValue:e.addNew,"onUpdate:modelValue":t[8]||(t[8]=b=>e.addNew=b)},{default:r(()=>[e.config.newType==="location"?(u(),$(a,{key:0,onCancelAdd:t[6]||(t[6]=b=>e.addNew=!1),onAddComplete:e.newOptionAdded},null,8,["onAddComplete"])):R("",!0),e.config.newType==="customer"?(u(),$(o,{key:1,onCancelAdd:t[7]||(t[7]=b=>e.addNew=!1),onAddComplete:e.newOptionAdded},null,8,["onAddComplete"])):R("",!0)]),_:1},8,["modelValue"])])}var Da=I(Ca,[["render",Sa]]);const Pa=H({emits:[],props:{item:Object},components:{EditDetailsForm:Da},setup(e,{emit:t}){const d=V(!1),s=q(()=>{const{permission:m}=e.item.editable&&e.item.config?e.item.config:{action:null,subject:null};return m});return{edit:d,permission:s}}}),ja={key:0,class:"row"},La={class:"col-12 col-md-4"},Oa={class:"col-12 col-md-8"},Ea=["innerHTML"];function Ta(e,t,d,s,m,v){const a=E("edit-details-form");return u(),$(M,{class:"q-py-sm"},{default:r(()=>[e.edit?(u(),$(a,{key:1,type:e.item.label,config:e.item.config,onCancelEdit:t[1]||(t[1]=o=>e.edit=!1)},null,8,["type","config"])):(u(),N("div",ja,[c("div",La,[c("div",null,[c("span",{class:Pe(e.$q.screen.gt.lg?"text-body2":"text-caption")},A(e.item.label),3)])]),c("div",Oa,[c("div",null,[c("span",{class:Pe(["text-weight-light",e.$q.screen.gt.lg?"text-body2":"text-caption"]),innerHTML:e.item.value},null,10,Ea),e.item.editable&&e.$can(e.permission.action,e.permission.subject)?(u(),$(D,{key:0,color:"accent",flat:"",dense:"",round:"",icon:"edit",size:"sm",onClick:t[0]||(t[0]=o=>e.edit=!0)})):R("",!0)])])]))]),_:1})}var Ma=I(Pa,[["render",Ta]]);const Ua=H({props:{title:String,details:Array},components:{DetailsSection:Ma}}),Fa={class:"text-body1 text-white"};function Qa(e,t,d,s,m,v){const a=E("details-section");return u(),N("div",null,[l(J,{class:"text-dark q-pb-sm"},{default:r(()=>[e.title&&e.title!==""?(u(),$(M,{key:0,class:"bg-info q-py-sm"},{default:r(()=>[c("div",Fa,A(e.title.toUpperCase()),1)]),_:1})):R("",!0),(u(!0),N(re,null,ce(e.details,o=>(u(),N(re,{key:o},[o.hide?R("",!0):(u(),$(a,{key:0,item:o},null,8,["item"]))],64))),128))]),_:1})])}var Ia=I(Ua,[["render",Qa]]);const Ba=H({props:{rows:Array},setup(e,t){const d=x();ye();const s=q(()=>d.screen.gt.sm?[{name:1,label:"Created",align:"left",field:a=>a[1].$d,format:a=>`${K(a).format("L LT")}`,sortable:!0},{name:2,label:"ID",align:"left",field:a=>a[3],format:a=>`${a}`,sortable:!0,required:!0},{name:3,label:"Classification",align:"left",field:a=>a[21],format:a=>`${a===""?"Open":a}`,sortable:!0,required:!0},{name:4,label:"Status",align:"left",field:a=>a[17],format:a=>`${a}`,sortable:!0},{name:5,label:"Rate",align:"left",field:a=>a[23],format:a=>`$ ${a.toFixed(2)}`,sortable:!0,required:!0},{name:6,label:"# Requested",align:"right",field:a=>a[18],format:a=>`${a}`},{name:7,label:"Offers",align:"right",field:a=>m(a),format:a=>`${a}`,sortable:!0,required:!0},{name:8,label:"# Names",align:"right",field:a=>a.names,format:a=>a?a.length:0,sortable:!0,required:!0},{name:9,label:"Balance",align:"right",field:a=>v(a),format:a=>`${a}`,sortable:!0,required:!0}]:[{name:1,label:"Created",align:"left",field:a=>a[1].$d,format:a=>`${K(a).format("L LT")}`,sortable:!0},{name:2,label:"ID",align:"left",field:a=>a[3],format:a=>`${a}`,sortable:!0,required:!0},{name:3,label:"Classification",align:"left",field:a=>a[21],format:a=>`${a===""?"Open":a}`,sortable:!0,required:!0},{name:4,label:"Status",align:"left",field:a=>a[17],format:a=>`${a}`,sortable:!0},{name:5,label:"Rate",align:"left",field:a=>a[23],format:a=>`$ ${a.toFixed(2)}`,sortable:!0,required:!0},{name:6,label:"# Requested",align:"right",field:a=>a[18],format:a=>`${a}`},{name:7,label:"Offers",align:"right",field:a=>m(a),format:a=>`${a}`,sortable:!0,required:!0},{name:8,label:"# Names",align:"right",field:a=>a.names,format:a=>a?a.length:0,sortable:!0,required:!0},{name:9,label:"Balance",align:"right",field:a=>v(a),format:a=>`${a}`,sortable:!0,required:!0}]);function m(a){return a.offers.filter(o=>o[21]==="Accepted").length}function v(a){const o=m(a);return a[18]-o}return{columns:s,props:e}}}),za={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"};function Ja(e,t,d,s,m,v){return u(),N("div",null,[l(De,{columns:e.columns,rows:e.props.rows,"row-key":a=>a[3],class:"q-pa-sm",pagination:{rowsPerPage:10},"table-header-class":"bg-dark text-white","no-data-label":"There are no classifications",dense:""},{header:r(a=>[l(ge,{class:"bg-dark text-white",props:a},{default:r(()=>[(u(!0),N(re,null,ce(a.cols,o=>(u(),$(Ne,{key:o.name,props:a},{default:r(()=>[Re(A(o.label),1)]),_:2},1032,["props"]))),128)),l(Ne,{"auto-width":""})]),_:2},1032,["props"])]),body:r(a=>[l(ge,{props:a},{default:r(()=>[(u(!0),N(re,null,ce(a.cols,o=>(u(),$(he,{key:o.name,props:a},{default:r(()=>[Re(A(o.value),1)]),_:2},1032,["props"]))),128)),l(he,{"auto-width":""},{default:r(()=>[a.row[17]==="Pending"&&e.$can("manage","projectRequests")&&!e.$can("read","hireRequests")?(u(),$(de,{key:0,class:"cursor-pointer",size:e.$q.screen.gt.sm?"sm":"xs",color:"primary",round:"",dense:"",onClick:o=>e.$emit("removeRow",a.row),name:"delete_forever"},null,8,["size","onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["props"])]),"no-data":r(({message:a})=>[c("div",za,[l(de,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),c("span",null,A(a),1)])]),"top-right":r(()=>[l(D,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[0]||(t[0]=a=>e.$emit("refresh"))})]),_:1},8,["columns","rows","row-key"])])}var Xa=I(Ba,[["render",Ja]]);const Ha=H({props:{data:Object},components:{ClassificationsTable:Xa},setup(e,t){const d=x(),{getClassifications:s,fetchClassifications:m,removeData:v,updateViewedRequests:a,getHireRequest:o}=ie(),b=q(()=>o(e.data[3])&&o(e.data[3]).classes?o(e.data[3]).classes:s(e.data[3]).sort((g,C)=>g[1].$d<C[1].$d?1:-1));async function _(g){d.loading.show();const{data:C}=await m({id:e.data[3]});a({id:e.data[3],dataset:"classes",data:C}),d.loading.hide()}async function i(g){d.dialog({title:"Confirm",message:`Are you sure you want to remove ${g[12]} from request# ${g[6]}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{const{data:C}=await Q.upsertRecordsXML({to:"bpzpyqcu4",data:[{3:{value:g[3]},17:{value:"Cancelled"},51:{value:new Date},128:{value:6}}],fieldsToReturn:[220],formatObject:220});v({type:"classifications",key:C[0][220][6],item:C[0][220],storageKey:"storageRequestClassifications"});const S=b.value.filter(p=>p[3]!==C[0][220][3]);a({id:e.data[3],dataset:"classes",data:S})}catch(C){d.notify({type:"negative",message:"Cannot remove classification"}),console.log(C)}})}return _(),{rows:b,removeRow:i,loadData:_}}});function Ya(e,t,d,s,m,v){const a=E("classifications-table");return u(),N("div",null,[l(a,{rows:e.rows,onRemoveRow:e.removeRow,onRefresh:t[0]||(t[0]=o=>e.loadData(!0))},null,8,["rows","onRemoveRow"])])}var Wa=I(Ha,[["render",Ya]]);const Ka=H({props:{data:Object},components:{NameRequestDataTable:ma},setup(e,t){const d=x(),s=ye(),{capitalize:m}=Ue,v=V(""),{getNameRequest:a,fetchNameRequest:o,removeData:b}=ie(),{userData:_}=fe(),i=q(()=>a(e.data[3]).sort((n,k)=>n[1].$d<k[1].$d?1:-1));async function g(){d.loading.show(),await o({id:e.data[3]}),d.loading.hide()}function C(n){return`${m(n[6].toLowerCase())} ${m(n[7].toLowerCase())}`}async function S(n){d.dialog({title:"Confirm",message:`Are you sure you want to remove ${C(n)} from request# ${n[18]}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{const{data:k}=await Q.upsertRecordsXML({to:"bsg4yb4wa",data:[{3:{value:n[3]},11:{value:!0},12:{value:K().tz("America/Chicago")},13:{value:`${_[35]} ${_[37]}`}}],fieldsToReturn:[15],formatObject:15});b({type:"nameRequest",key:k[0][15][18],item:k[0][15],storageKey:"storageNameRequest"})}catch(k){d.notify({type:"negative",message:"Cannot remove name request"}),console.log(k)}})}const p=n=>{s.push({name:"ee-summary",params:{id:n[3]}})};return g(),{nameRequests:i,search:v,removeName:S,viewEmployee:p}}}),Ga={class:"row items-center"},Za={class:"col-12 col-md-4"};function xa(e,t,d,s,m,v){const a=E("name-request-data-table");return u(),N("div",null,[l(J,{flat:""},{default:r(()=>[l(M,null,{default:r(()=>[c("div",Ga,[c("div",Za,[l(ee,{dense:"",modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=o=>e.search=o),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),l(a,{requests:e.nameRequests,status:"Named",onRemoveName:e.removeName,onViewEmployee:e.viewEmployee},null,8,["requests","onRemoveName","onViewEmployee"])])}var et=I(Ka,[["render",xa]]);const at=H({props:{rows:Array},setup(e,t){const d=x();ye();const{openWindow:s}=ia(),m=fe(),{getUserType:v}=Fe(m),{can:a}=fa(),o=q(()=>d.screen.gt.sm?[{name:"Action",label:"",align:"left"},{name:1,label:"Created",align:"left",field:i=>i[1].$d,format:i=>`${K(i).format("L LT")}`,sortable:!0},{name:2,label:"Offered To",align:"left",field:i=>i.employee[24],format:i=>`${i}`,sortable:!0,required:!0},{name:3,label:"Classification",align:"left",field:i=>i[57],format:i=>`${i===""?"Open":i}`,sortable:!0,required:!0},{name:4,label:"Status",align:"left",field:i=>i[21],format:i=>`${i}`,sortable:!0},{name:5,label:"Rate Offered",align:"left",field:i=>i[22],format:i=>`$ ${i.toFixed(2)}`,sortable:!0,required:!0}]:[{name:"Action",label:"",align:"left"},{name:1,label:"Created",align:"left",field:i=>i[1].$d,format:i=>`${K(i).fromNow()}`,sortable:!0},{name:2,label:"Offered To",align:"left",field:i=>i.employee[24],format:i=>`${i}`,sortable:!0,required:!0},{name:3,label:"Classification",align:"left",field:i=>i[57],format:i=>`${i===""?"Open":i}`,sortable:!0,required:!0},{name:4,label:"Status",align:"left",field:i=>i[21],format:i=>`${i}`,sortable:!0},{name:5,label:"Rate Offered",align:"left",field:i=>i[22],format:i=>`$ ${i.toFixed(2)}`,sortable:!0,required:!0}]),b=q(()=>d.screen.gt.sm?["Action",1,2,3,4,a("read","rates")?5:[]]:["Action",1,2,3,4,a("read","rates")?5:[]]);return{getUserType:v,viewProfile:i=>{s(null,{url:`https://elitehcms.quickbase.com/db/bs7qsu6wh?a=dbpage&pageID=6&ee=${i[25]}`,name:"View Profile"})},columns:o,props:e,visibleColumns:b}}}),tt={key:0},st={key:1},ot={key:2},lt={key:3},nt={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"};function rt(e,t,d,s,m,v){return u(),N("div",null,[l(De,{columns:e.columns,"visible-columns":e.visibleColumns,rows:e.props.rows,"row-key":a=>a[3],class:"q-pa-sm",pagination:{rowsPerPage:10},"table-header-class":"bg-dark text-white","no-data-label":"There are no offers",dense:""},{body:r(a=>[l(ge,{props:a},{default:r(()=>[(u(!0),N(re,null,ce(a.cols,o=>(u(),$(he,{key:o.name,props:a,"auto-width":""},{default:r(()=>[o.name==="Action"?(u(),N("span",tt,[e.getUserType==="QuickBase User"?(u(),$(de,{key:0,class:"cursor-pointer",size:e.$q.screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:b=>e.viewProfile(a.row),name:a.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])):R("",!0)])):o.name===4?(u(),N("span",st,A(a.row[29]==="Review"?"Pending":o.value),1)):o.name===5?(u(),N("span",ot,A(e.$can("read","rates")?o.value:"N/A"),1)):(u(),N("span",lt,A(o.value),1))]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":r(({message:a})=>[c("div",nt,[l(de,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),c("span",null,A(a),1)])]),_:1},8,["columns","visible-columns","rows","row-key"])])}var it=I(at,[["render",rt]]);const ut=H({props:{data:Array},components:{OffersDataTable:it},setup(e){const t=V("");return{offers:q(()=>{const s=[];return e.data.forEach(m=>{`${m.employee[24].toLowerCase}`.includes(t.value.toLowerCase())&&s.push(m)}),s}),search:t}}}),dt={class:"row items-center"},ct={class:"col-12 col-md-4"};function mt(e,t,d,s,m,v){const a=E("offers-data-table");return u(),N("div",null,[l(J,{flat:""},{default:r(()=>[l(M,null,{default:r(()=>[c("div",dt,[c("div",ct,[l(ee,{dense:"",modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=o=>e.search=o),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),l(a,{rows:e.offers},null,8,["rows"])])}var ft=I(ut,[["render",mt]]);const bt={name:"Pipeline",components:{ProjectPipelineTable:ba},props:{request:Object},setup(e){const t=x(),d=V(""),{fetchDeployments:s,fetchInProcess:m,fetchPending:v,getDeployments:a,getInProcess:o,getPending:b}=ie(),_=q(()=>a(e.request[3]).filter(n=>n[20]==="Complete")),i=q(()=>a(e.request[3])),g=q(()=>b(e.request[3])),C=q(()=>o(e.request[3])),S=q(()=>C.value.concat(g.value.concat(i.value)));async function p(){t.loading.show(),await s({requestId:e.request[3]}),await m({requestId:e.request[3]}),await v({requestId:e.request[3]}),t.loading.hide()}return p(),{arrived:_,allPipeline:S,search:d}}},pt={class:"q-pt-sm"},vt={class:"text-h5 text-dark"},gt={class:"text-body2 text-italic q-ml-sm"},ht=c("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for this request.",-1),yt={class:"row items-center"},qt={class:"col-12 col-md-3 q-px-sm"};function $t(e,t,d,s,m,v){const a=E("project-pipeline-table");return u(),$(Qe,{style:{"max-width":"100vw"}},{default:r(()=>[c("div",pt,[l(J,{flat:""},{default:r(()=>[l(M,{class:"q-pb-none"},{default:r(()=>[c("div",vt,[Re(" Staffing Pipeline "),c("span",gt,"("+A(s.allPipeline.length)+" total)",1)]),ht]),_:1}),l(M,null,{default:r(()=>[c("div",yt,[c("div",qt,[l(ee,{dense:"",modelValue:s.search,"onUpdate:modelValue":t[0]||(t[0]=o=>s.search=o),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),l(a,{rows:s.allPipeline,filter:s.search},null,8,["rows","filter"])])]),_:1})}var wt=I(bt,[["render",$t]]);const Ct=H({emits:["namesAdded","closeNames"],components:{phoneNumberInput:ha},props:{request:Object},setup(e,{emit:t}){const d=x(),{getClassifications:s,addNameRequest:m,getNameRequest:v,fetchNameRequest:a}=ie(),{userData:o}=fe(),{capitalize:b}=Ue;V(!1);const _=V(10),i=V(null),g=V([]),C=q(()=>v(e.request[3]).sort((f,O)=>f[1].$d<O[1].$d?1:-1)),S=q(()=>s(e.request[3])||[]),p=async()=>{C.value.length===0&&await a({id:e.request[3]})},n=[{name:0,label:"#",align:"left",field:f=>f.id,format:f=>`${f}`},{name:1,label:"First Name",align:"left",field:f=>f.firstName,format:f=>`${b(f.toLowerCase())}`,sortable:!0},{name:2,label:"Last Name",align:"left",field:f=>f.lastName,format:f=>`${b(f.toLowerCase())}`,sortable:!0},{name:3,label:"Phone",align:"left",field:f=>f.phone,format:f=>`${f}`,sortable:!1,required:!0},{name:4,label:"Last 4",align:"left",field:f=>f.ssn,format:f=>`${f}`}],k=q(()=>{const f=new RegExp("^(?!0+$)\\d{"+_.value+"}","g");return X({job:X().required("Classification is required"),firstName:ne().required().label("First Name"),lastName:ne().required().label("Last Name"),phoneNumber:ne().matches(f,{excludeEmptyString:!0,message:"Valid Phone Number Required!"}).required().label("Phone Number"),ssn:ne().matches(/^\d+$/,{excludeEmptyString:!0,message:"Numbers Only!"}).label("Last 4 of SSN")})}),{errors:B,handleSubmit:w,resetForm:P,isSubmitting:L}=Ae({validationSchema:k}),F=V(!1),G=V(""),{value:te}=z("job"),{value:y}=z("firstName"),{value:h}=z("lastName"),{value:j}=z("phoneNumber"),{value:se}=z("ssn"),Y={};S.value.forEach(f=>{Y[f[3]]=0});const Ve=w(f=>{const O=te.value[3],T=te.value[18],U=te.value[21];if(T>Y[O]){F.value=!1,G.value="";const pe=S.value.length+1;f.id=pe;const le={id:g.value.length+1,classification:f.job,firstName:f.firstName,lastName:f.lastName,phone:f.phoneNumber,ssn:f.ssn};g.value.push(le),Y[O]=Y[O]+1,P()}else G.value=U+" exceeds the selected quantity",F.value=!0,P()}),qe=f=>{const O=g.value.filter(T=>T.id!==f.id);g.value=O,Y[f.job.id]=Y[f.job.id]-1},Z=async f=>{const O=o;O.access&&delete O.access,O.permissions&&delete O.permissions;const{data:T}=await Q.upsertRecordsXML({to:"bsg4yb4wa",data:[{6:{value:f.firstName},7:{value:f.lastName},8:{value:f.phone},10:{value:"Has Not Arrived"},19:{value:K()},16:{value:f.ssn},14:{value:`${O[35]} ${O[37]}`},17:{value:f.classification[3]}}],fieldsToReturn:[15],formatObject:15}),U=T[0][15];return U[45]>U[43]&&Ie({id:U[17],qty:U[45]}),U},oe=async()=>{d.loading.show();const f=[];g.value.forEach(U=>{const pe=Z(U);f.push(pe)});const T=(await Promise.allSettled(f)).map(U=>U.value);m({id:e.request[3],data:T}),d.notify({type:"positive",message:"Names successfully added!"}),t("namesAdded"),d.loading.hide()},be=f=>{i.value=f},Se=f=>{_.value=f};return p(),{formErrors:B,submit:Ve,job:te,firstName:y,lastName:h,phoneNumber:j,ssn:se,resetForm:P,classifications:S,names:g,isError:F,errorMsg:G,columns:n,removeRow:qe,submitNames:oe,phoneLength:_,updateCountry:be,updatePhoneMaxLength:Se,nameRequests:C}}}),Rt={class:"q-mb-sm"},Nt={class:"text-caption"},kt={class:"q-mb-sm"},_t={class:"text-caption"},At={class:"q-mb-sm"},Vt={class:"q-mb-sm"},St={class:"text-caption"},Dt={class:"text-caption"},Pt=c("div",{class:"text-primary"},"No Positions are available, please remove names or add request?",-1),jt={class:"text-caption"},Lt=c("div",{class:"text-h6"},"Alert",-1),Ot={class:"text-caption"};function Et(e,t,d,s,m,v){const a=E("phone-number-input");return u(),$(_e,{onSubmit:ke(e.submit,["prevent"])},{default:r(()=>[l(J,null,{default:r(()=>[l(M,{class:"q-pb-sm"},{default:r(()=>[c("div",Rt,[l(ee,{tabindex:"1",dense:"",label:"First Name",modelValue:e.firstName,"onUpdate:modelValue":t[0]||(t[0]=o=>e.firstName=o),error:!!e.formErrors.firstName,"bottom-slots":""},{error:r(()=>[c("div",Nt,A(e.formErrors.firstName),1)]),_:1},8,["modelValue","error"])]),c("div",kt,[l(ee,{tabindex:"2",dense:"",label:"Last Name",modelValue:e.lastName,"onUpdate:modelValue":t[1]||(t[1]=o=>e.lastName=o),error:!!e.formErrors.lastName,"bottom-slots":""},{error:r(()=>[c("div",_t,A(e.formErrors.lastName),1)]),_:1},8,["modelValue","error"])]),c("div",At,[l(a,{name:"phoneNumber",class:"col-xs-12 col-sm-12",dense:"",modelValue:e.phoneNumber,"onUpdate:modelValue":t[2]||(t[2]=o=>e.phoneNumber=o),label:"Phone Number",tabindex:"3",onMaxLengthChanged:e.updatePhoneMaxLength,error:!!e.formErrors.phoneNumber,"error-message":e.formErrors.phoneNumber,onCountryChanged:e.updateCountry},null,8,["modelValue","onMaxLengthChanged","error","error-message","onCountryChanged"])]),c("div",Vt,[l(ee,{maxlength:"4",tabindex:"4",dense:"",label:"SSN Last 4 (Optional)",modelValue:e.ssn,"onUpdate:modelValue":t[3]||(t[3]=o=>e.ssn=o),error:!!e.formErrors.ssn,"bottom-slots":""},{error:r(()=>[c("div",St,A(e.formErrors.ssn),1)]),_:1},8,["modelValue","error"])]),c("div",null,[l(me,{dense:"",tabindex:"5",label:"Classification","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.job,"onUpdate:modelValue":t[4]||(t[4]=o=>e.job=o),options:e.classifications.filter(o=>{if(e.nameRequests.filter(b=>b[17]===o[3]).length<o[18])return!0}),"option-label":o=>`${o[21]} - $${Number(o[23]).toFixed(2)} (${o[18]})`,"display-value":e.job?`${e.job[21]} - $${Number(e.job[23]).toFixed(2)}`:"","bottom-slots":"",error:!!e.formErrors.job},ea({error:r(()=>[c("div",Dt,A(e.formErrors.job),1)]),_:2},[e.classifications.filter(o=>{if(e.nameRequests.filter(b=>b[17]===o[3]).length<o[18])return!0}).length===0?{name:"hint",fn:r(()=>[Pt]),key:"0"}:void 0]),1032,["modelValue","options","option-label","display-value","error"])])]),_:1}),l(aa),l(ae,{class:"q-pt-sm",align:"right"},{default:r(()=>[e.names.length===0?(u(),$(D,{key:0,dense:"",label:"Cancel",color:"secondary",onClick:t[5]||(t[5]=o=>e.$emit("closeNames"))})):R("",!0),l(D,{dense:"",color:"info",label:"Save Name",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1}),e.names.length>0?(u(),$(M,{key:0,class:"q-px-none"},{default:r(()=>[l(De,{flat:"",columns:e.columns,rows:e.names,"row-key":o=>o.name,class:"q-pa-sm",pagination:{rowsPerPage:100},"table-header-class":"bg-dark text-white",dense:"","hide-pagination":""},{header:r(o=>[l(ge,{class:"bg-dark text-white",props:o},{default:r(()=>[(u(!0),N(re,null,ce(o.cols,b=>(u(),$(Ne,{class:"text-left",key:b.name},{default:r(()=>[Re(A(b.label),1)]),_:2},1024))),128)),l(Ne,{"auto-width":""})]),_:2},1032,["props"])]),body:r(o=>[l(ge,{"no-hover":"",props:o},{default:r(()=>[(u(!0),N(re,null,ce(o.cols,b=>(u(),$(he,{key:b.name,props:o},{default:r(()=>[c("span",jt,A(b.value==="undefined"?"N/A":b.value),1)]),_:2},1032,["props"]))),128)),l(he,{"auto-width":""},{default:r(()=>[l(D,{round:"",flat:"",icon:"delete",color:"accent",onClick:b=>e.removeRow(o.row)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key"])]),_:1})):R("",!0),e.isError?(u(),$(ve,{key:1,modelValue:e.isError,"onUpdate:modelValue":t[6]||(t[6]=o=>e.isError=o)},{default:r(()=>[l(J,null,{default:r(()=>[l(M,null,{default:r(()=>[Lt]),_:1}),l(M,{class:"q-pt-none"},{default:r(()=>[c("span",Ot,A(e.errorMsg),1)]),_:1}),l(ae,{align:"right"},{default:r(()=>[ta(l(D,{flat:"",label:"OK",color:"primary"},null,512),[[pa]])]),_:1})]),_:1})]),_:1},8,["modelValue"])):R("",!0),e.names.length>0?(u(),$(ae,{key:2,align:"right"},{default:r(()=>[l(D,{dense:"",label:"Cancel",color:"secondary",onClick:t[7]||(t[7]=o=>e.$emit("closeNames"))}),l(D,{dense:"",color:"primary",label:"Submit These Names",onClick:e.submitNames},null,8,["onClick"])]),_:1})):R("",!0)]),_:1})]),_:1},8,["onSubmit"])}var Tt=I(Ct,[["render",Et]]);const Mt=H({emits:["jobsAdded","closeJobs","jobUpdated"],components:{PayRateField:va},props:{request:Object},setup(e,{emit:t}){x();const{getClassifications:d}=ie();fe();const s=V([]),m=q(()=>d(e.request[3])||[]),v=X({craft:X().required().nullable().label("Craft"),classification:X().required().nullable().label("Classification"),rate:je().required().nullable().label("Rate"),qty:je().required().nullable().label("Quantity")}),{errors:a,handleSubmit:o,resetForm:b,isSubmitting:_,setFieldError:i}=Ae({validationSchema:v}),{value:g}=z("craft"),{value:C}=z("classification"),{value:S}=z("rate"),{value:p}=z("qty"),n=o(async w=>{const P=m.value.find(L=>L[9]===w.classification[3]&&L[23]===w.rate);if(P){const L=P[18]+w.qty,F=await Ie({id:P[3],qty:L});t("jobUpdated",F)}else{const L=await ga({requestData:e.request,job:w});t("jobsAdded",L)}}),k=async()=>{const{data:w}=await Q.fetchFromProjectsApp({fields:[Ce({type:"projectCrafts",query:`{'7'.EX.'${e.request[6]}'}AND{'6'.EX.'Active'}`})]}),P=w.sort((L,F)=>L[20]>F[20]?1:-1);s.value=P,console.log(m.value)},B=q(()=>{const w=g.value&&g.value.classifications?g.value.classifications:[];return w.length>0?w.sort((P,L)=>P[32]>L[32]?-1:1):[]});return sa(C,(w,P)=>{w&&w.hasFixedRate?S.value=w.fixedRate:S.value&&(S.value=null)}),k(),{errors:a,submit:n,classificationOptions:B,craft:g,classification:C,rate:S,qty:p,crafts:s}}}),Ut={key:0,class:"text-body2 text-italic text-weight-bold text-dark"},Ft={key:1,class:"text-body2 text-italic text-weight-bold text-dark"},Qt={class:"row q-mb-md"},It={class:"col-6 q-pr-sm"},Bt={class:"text-caption"},zt={class:"col-6 q-pl-sm"},Jt={class:"text-caption"},Xt={class:"row"},Ht={class:"col-6 q-pr-sm"},Yt={class:"text-caption"},Wt={class:"col-6 q-pl-sm"};function Kt(e,t,d,s,m,v){const a=E("pay-rate-field");return u(),$(_e,oa(e.$attrs,{onSubmit:ke(e.submit,["prevent"])}),{default:r(()=>[l(J,null,{default:r(()=>[l(M,null,{default:r(()=>[e.$attrs.hideInstructions?(u(),N("div",Ft," Enter the following information about the classification and click Submit. ")):(u(),N("div",Ut," Enter the following information about the classification and click Save. Repeat until all classifications you are requesting have been saved. Then click Continue. ")),c("div",Qt,[c("div",It,[l(me,{class:"q-mt-md",dense:"",clearable:"","transition-show":"flip-up","transition-hide":"flip-down",label:"Select Craft",modelValue:e.craft,"onUpdate:modelValue":t[0]||(t[0]=o=>e.craft=o),options:e.crafts,"option-label":o=>o[10],"display-value":e.craft?`${e.craft[10]}`:"",error:!!e.errors.craft,"bottom-slots":""},{error:r(()=>[c("div",Bt,A(e.errors.craft),1)]),_:1},8,["modelValue","options","option-label","display-value","error"])]),c("div",zt,[l(me,{class:"q-mt-md",dense:"",clearable:"","transition-show":"flip-up","transition-hide":"flip-down",label:"Classification",modelValue:e.classification,"onUpdate:modelValue":t[1]||(t[1]=o=>e.classification=o),options:e.classificationOptions,"option-label":o=>o[18],"display-value":e.classification?`${e.classification[18]}`:"",error:!!e.errors.classification,"bottom-slots":"",disable:!e.craft},{error:r(()=>[c("div",Jt,A(e.errors.classification),1)]),_:1},8,["modelValue","options","option-label","display-value","error","disable"])])]),c("div",Xt,[c("div",Ht,[l(ee,{dense:"",type:"number",label:"Quantity",modelValue:e.qty,"onUpdate:modelValue":t[2]||(t[2]=o=>e.qty=o),modelModifiers:{number:!0},error:!!e.errors.qty,disable:!e.classification,"bottom-slots":""},{error:r(()=>[c("div",Yt,A(e.errors.qty),1)]),_:1},8,["modelValue","error","disable"])]),c("div",Wt,[l(a,{class:"q-mb-md",type:"number",step:"any",dense:"",label:"Hourly Rate",modelValue:e.rate,"onUpdate:modelValue":t[3]||(t[3]=o=>e.rate=o),modelModifiers:{number:!0},prefix:"$",disable:!e.classification||e.classification.hasFixedRate&&!e.$can("manage","rates"),error:!!e.errors.rate,"error-message":e.errors.rate,"bottom-slots":""},null,8,["modelValue","disable","error","error-message"])])])]),_:1}),l(ae,{align:"right"},{default:r(()=>[l(D,{dense:"",color:"secondary",label:"Cancel",onClick:t[4]||(t[4]=o=>e.$emit("closeJobs"))}),l(D,{dense:"",color:"primary",label:"Submit",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1})]),_:1})]),_:1},16,["onSubmit"])}var Gt=I(Mt,[["render",Kt]]);const Zt=H({props:{request:Object},setup(e){const t=V(null),d=["Continue Processing","Remove from In Process"],s=["Client Headcount Met","Client Changed Work Scope"],m=fe(),{userData:v}=Fe(m),a=ye(),o=x(),{getDeployments:b,getInProcess:_,getPending:i,fetchDeployments:g,fetchInProcess:C,fetchPending:S}=ie(),p=v.value&&v.value[35]?v.value[35]:"",n=v.value&&v.value[37]?v.value[37]:"",k=q(()=>b(e.request[3])),B=q(()=>_(e.request[3])),w=q(()=>i(e.request[3])),P=q(()=>k.value.concat(B.value)),L=q(()=>w.value.concat(B.value));async function F(){await g({requestId:e.request[3],refresh:!0}),await C({requestId:e.request[3],refresh:!0}),await S({requestId:e.request[3],refresh:!0})}F();const G=q(()=>{let Z={};return L.value.length>0?Z=X({action:ne().required().label("Applicant(s) In Process, Action Needed?"),reason:ne().required().label("Reason for Closing")}):Z=X({reason:ne().required().label("Reason for Closing")}),Z}),{meta:te,errors:y,handleSubmit:h,handleReset:j}=Ae({validationSchema:G}),{value:se}=z("action"),{value:Y}=z("reason"),Ve=h(async Z=>{try{let oe=P.value.length===0?"Cancelled":"Closed",be=P.value.length===0?6:5;e.request[305]>0&&(oe="Closed",be=5);const Se={3:{value:e.request[3]},14:{value:oe},84:{value:new Date},86:{value:new Date},147:{value:be},276:{value:v.value[3]},277:{value:`${p} ${n}`},303:{value:Z.reason},306:{value:Z.action||"N/A"}},f=[];e.request.classes&&Array.isArray(e.request.classes)&&e.request.classes.forEach(T=>{const U=V(T[18]);Z.action==="Continue Processing"?T.offers&&Array.isArray(T.offers)&&(U.value=T.offers.filter(le=>le[21]==="Accepted").length):U.value=k.value.filter(le=>le[89]===T[3]&&(le[20]==="Complete"||le[20]==="In Process")).length;const pe={3:{value:T[3]},17:{value:oe},29:{value:new Date},51:{value:new Date},128:{value:be},255:{value:U.value}};f.push(pe)});const{data:O}=await Q.upsertRecordsXML({to:"bpzpyjbuy",data:[Se],fieldsToReturn:[3]});if(O&&O[0]&&O[0][3]){const{data:T}=await Q.upsertRecordsXML({to:"bpzpyqcu4",data:f,fieldsToReturn:[3]});if(T)qe(),a.go(-1),o.notify({position:"top-right",type:"positive",message:"Request successfully closed"});else throw"Error in canceling request"}else throw"Error in canceling request"}catch(oe){console.log(oe),o.notify({position:"top-right",type:"negative",message:"There was a problem closing request!"})}}),qe=()=>{j(),t.value.hide()};return{cancelRequestDialog:t,hireRequestPipeline:L,actions:d,reasons:s,action:se,reason:Y,formErrors:y,submitCancel:Ve,closeCancelDialog:qe}}}),xt=c("div",{class:"text-h6 text-info"},"Close Request",-1),es={key:0,class:"row"},as={class:"col-12 q-pr-sm"},ts={class:"text-caption"},ss={class:"row q-mb-md"},os={class:"col-12 q-pr-sm"},ls={class:"text-caption"};function ns(e,t,d,s,m,v){return u(),$(ve,{ref:"cancelRequestDialog"},{default:r(()=>[l(J,{flat:"",style:{width:"400px"}},{default:r(()=>[l(_e,{onSubmit:ke(e.submitCancel,["prevent"])},{default:r(()=>[l(M,{class:"q-pb-none"},{default:r(()=>[xt]),_:1}),l(M,null,{default:r(()=>[e.hireRequestPipeline.length>0?(u(),N("div",es,[c("div",as,[l(me,{class:"q-mt-md",dense:"","transition-show":"flip-up","transition-hide":"flip-down",label:`${e.hireRequestPipeline.length} Applicant(s) In Process, Action Needed?`,modelValue:e.action,"onUpdate:modelValue":t[0]||(t[0]=a=>e.action=a),options:e.actions,error:!!e.formErrors.action,"bottom-slots":""},{error:r(()=>[c("div",ts,A(e.formErrors.action),1)]),_:1},8,["label","modelValue","options","error"])])])):R("",!0),c("div",ss,[c("div",os,[l(me,{class:"q-mt-md",dense:"","transition-show":"flip-up","transition-hide":"flip-down",label:"Reason for Closing",modelValue:e.reason,"onUpdate:modelValue":t[1]||(t[1]=a=>e.reason=a),options:e.reasons,error:!!e.formErrors.reason,"bottom-slots":""},{error:r(()=>[c("div",ls,A(e.formErrors.reason),1)]),_:1},8,["modelValue","options","error"])])])]),_:1}),l(ae,{align:"right"},{default:r(()=>[l(D,{dense:"",color:"secondary",label:"Cancel",onClick:e.closeCancelDialog},null,8,["onClick"]),l(D,{dense:"",color:"primary",label:"Submit",type:"submit",onClick:e.submitCancel},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},512)}var rs=I(Zt,[["render",ns]]);const is={name:"View Request",components:{ClassificationsTab:Wa,NamesTab:et,PipelineTab:wt,OffersTab:ft,NamesForm:Tt,DetailsCard:Ia,ClassificationForm:Gt,cancelHireRequest:rs},setup(){const e=V(!0),t=V(!1),d=V(!1),s=V(!1),m=x(),v=la(),a=ye(),o=V(0),{getHireRequest:b,fetchHireRequest:_,updateViewedRequests:i,setHireRequests:g}=ie(),{getUserType:C,userData:S}=fe(),p=V(!1),n=q(()=>b(v.params.id)),k=async y=>{if(!n.value[3]||y){m.loading.show();const{data:h}=await Q.fetchFromProjectsApp({fields:[Ce({type:"requests",id:v.params.id})]});g({requestId:v.params.id,data:h}),m.loading.hide()}},B=()=>{a.options.history.state.back?a.go(-1):a.push({name:"home"})},w=()=>{a.push({name:"project-general",params:{id:n.value[6]}})};k();const P=()=>{o.value=1,d.value=!1,k(!0)},L=y=>{s.value=!1,k(!0),i({id:n.value[3],dataset:"classes",data:y,push:!0})},F=y=>{s.value=!1,k(!0);const h=b(n.value[3]).classes,j=h.findIndex(se=>se[3]===y[3]);j>-1?(h[j]=y,i({id:n.value[3],dataset:"classes",data:h})):i({id:n.value[3],dataset:"classes",data:y,push:!0})},G=y=>{const h=[];for(const[j,se]of Object.entries(y)){const Y={fid:j,value:se};h.push(Y)}i({id:n.value[3],props:h})},te=q(()=>n.value[3]?[{label:"Request ID",value:n.value[3],editable:!1},{label:"Date Created",value:K(n.value[1].$d).format("MM/DD/YYYY hh:mm:ss a"),editable:!1},{label:"Date Needed",value:K(n.value[64].$d).format("MM/DD/YYYY"),editable:!1},{label:"Status",value:`${n.value[14]} (${n.value[59]})`,editable:!1},{label:"Request Type",value:`${n.value[282]}`,editable:!1},{label:"Opened On",value:n.value[82].$d?K(n.value[82].$d).format("MM/DD/YYYY hh:mm:ss a"):null,editable:!1,hide:n.value[14]!=="Open"&&n.value[14]!=="Closed"},{label:"Closed On",value:n.value[86].$d?K(n.value[86].$d).format("MM/DD/YYYY hh:mm:ss a"):null,editable:!1,hide:n.value[14]!=="Closed"},{label:"Project Name",value:n.value[91],editable:!1},{label:"Job Number",value:n.value[27],editable:n.value[14]!=="Closed",config:{permission:{action:"manage",subject:"projectRequests"},type:"options",allowNew:!1,newType:"customer",initialValue:y=>y.find(h=>h[3]===n.value[9]),formRules:X().required().label("Job Number").nullable(),fieldLabel:"Job Number",optionLabel:"11",displayValue:11,getter:async()=>{const{data:y}=await Q.fetchFromProjectsApp({fields:[Ce({type:"jobNumbers",query:`{'6'.EX.'${n.value[6]}'}AND{'29'.EX.'Active'}`})]});return y.sort((h,j)=>h[1].$d>j[1].$d?-1:1)},setter:async y=>{try{const{data:h}=await Q.upsertRecordsXML({to:"bpzpyjbuy",data:[{3:{value:n.value[3]},9:{value:y[3]}}],fieldsToReturn:[9,27]});G(h[0]),m.notify({type:"positive",message:"Job Number successfully updated"})}catch{m.notify({type:"negative",message:"Error updating Job Number"})}},filter:(y,h)=>y.filter(j=>j[11].toLowerCase().indexOf(h)>-1)}},{label:"Site Contact",value:n.value[76],editable:n.value[14]!=="Closed",config:{permission:{action:"manage",subject:"projectRequests"},type:"options",allowNew:!1,newType:"location",initialValue:y=>y.find(h=>h[3]===n.value[60]),formRules:X().required().label("Site Contact").nullable(),fieldLabel:"Site Contact",optionLabel:"17",displayValue:17,getter:async()=>{const{data:y}=await Q.fetchFromProjectsApp({fields:[Ce({type:"siteContacts",query:`{'7'.EX.'${n.value[6]}'}AND{'6'.EX.'Active'}`})]});return y.sort((h,j)=>h[17]>j[17]?1:-1)},setter:async y=>{try{const{data:h}=await Q.upsertRecordsXML({to:"bpzpyjbuy",data:[{3:{value:n.value[3]},60:{value:y[3]}}],fieldsToReturn:[60,76]});G(h[0]),m.notify({type:"positive",message:"Site Contact successfully updated"})}catch{m.notify({type:"negative",message:"Error updating Site Contact"})}},filter:(y,h)=>y.filter(j=>j[17].toLowerCase().indexOf(h)>-1)}},{label:"Meeting Location",value:n.value[32],editable:n.value[14]!=="Closed",config:{permission:{action:"manage",subject:"projectRequests"},type:"options",allowNew:!1,newType:"location",initialValue:y=>y.find(h=>h[3]===n.value[31]),formRules:X().required().label("Meeting Location").nullable(),fieldLabel:"Meeting Location",optionLabel:"6",displayValue:6,getter:async()=>{const{data:y}=await Q.fetchFromStructureApp({fields:[ua({type:"meetingLocations",query:`{'15'.EX.'${n.value[8]}'}AND{'14'.EX.'Active'}`})]});return y.sort((h,j)=>h[6]>j[6]?1:-1)},setter:async y=>{try{const{data:h}=await Q.upsertRecordsXML({to:"bpzpyjbuy",data:[{3:{value:n.value[3]},31:{value:y[3]}}],fieldsToReturn:[31,32,33]});G(h[0]),m.notify({type:"positive",message:"Meeting Location successfully updated"})}catch{m.notify({type:"negative",message:"Error updating Meeting Location"})}},filter:(y,h)=>y.filter(j=>j[6].toLowerCase().indexOf(h)>-1)}},{label:"Address",value:n.value[33],editable:!1},{label:"Shift",value:n.value[318]?n.value[318]:"N/A",editable:!1},{label:"Start Time",value:n.value[317]?n.value[317]:"N/A",editable:!1},{label:"Hours",value:n.value[319]?n.value[319]:"N/A",editable:!1},{label:"Per-Diem",value:n.value[65]?`Amount: $${Number(n.value[67]).toFixed(2)}
<br>
            Rules: ${n.value[66]?n.value[66]:"N/A"}
<br>
            Miles: ${n.value[99]?n.value[99]:"N/A"}
<br>
            Approval: ${n.value[98]?n.value[98]:"N/A"}
<br>
            DL/ID: ${n.value[100]?n.value[100]:"N/A"}
<br>
            Map: ${n.value[101]?n.value[101]:"N/A"}`:"",editable:!1,hide:!n.value[65]},{label:"Notes",value:n.value[299]?n.value[299]:"N/A",editable:!1},{label:"",value:"",editable:!1},{label:"Submitted By",value:n.value[4],editable:!1}]:[]);return{hireRequestData:n,tab:o,back:B,showAddNames:d,showAddJobs:s,namesAdded:P,details:te,viewProject:w,actions:e,navs:t,jobsAdded:L,jobUpdated:F,getUserType:C,cancelRequest:p}}},us={key:0,class:"q-pa-sm"},ds={class:"row"},cs={class:"col-12 col-md-6"},ms={class:"col-12 col-md-6"},fs={class:"row"},bs={class:"col-12 col-md-4 q-pa-sm"},ps={class:"col-12 col-md-8 q-pa-sm"};function vs(e,t,d,s,m,v){const a=E("details-card"),o=E("classifications-tab"),b=E("names-tab"),_=E("offers-tab"),i=E("pipeline-tab"),g=E("names-form"),C=E("classification-form"),S=E("cancelHireRequest");return u(),$(Qe,{style:{"max-width":"100vw"}},{default:r(()=>[s.hireRequestData[3]?(u(),N("div",us,[l(J,{flat:""},{default:r(()=>[l(M,{class:"q-pa-none"},{default:r(()=>[c("div",ds,[c("div",cs,[l(ae,{class:"q-pt-none",align:"left"},{default:r(()=>[l(D,{label:"Go Back",color:"secondary",icon:"keyboard_return",onClick:s.back},null,8,["onClick"])]),_:1})]),c("div",ms,[s.getUserType==="Project User"?(u(),$(ae,{key:0,class:"q-pt-none",align:"right"},{default:r(()=>[e.$can("manage","projectRequests")&&(s.hireRequestData[14]==="Pending"||s.hireRequestData[14]==="Open")||e.$can("manage","nameRequests")&&s.hireRequestData[14]!=="Closed"&&s.hireRequestData[282]!=="Open"||e.$can("manage","projectRequests")&&!e.$can("read","hireRequests")&&s.hireRequestData[14]==="Pending"?(u(),$(Le,{key:0,modelValue:s.actions,"onUpdate:modelValue":t[3]||(t[3]=p=>s.actions=p),square:"",color:"accent",icon:"keyboard_arrow_left",direction:"left",label:"Actions",padding:"sm"},{default:r(()=>[e.$can("manage","projectRequests")&&s.hireRequestData[14]==="Pending"?(u(),$(ue,{key:0,label:"Add Classifications",color:"primary",icon:"add",onClick:t[0]||(t[0]=p=>s.showAddJobs=!0)})):R("",!0),e.$can("manage","nameRequests")&&(s.hireRequestData[14]==="Pending"||s.hireRequestData[14]==="Open")&&s.hireRequestData[282]!=="Open"?(u(),$(ue,{key:1,label:"Add Names to Request",color:"accent",icon:"person_add",onClick:t[1]||(t[1]=p=>s.showAddNames=!0)})):R("",!0),e.$can("manage","projectRequests")&&(s.hireRequestData[14]==="Pending"||s.hireRequestData[14]==="Open")?(u(),$(ue,{key:2,label:"Close Hire Request",color:"dark",icon:"cancel",onClick:t[2]||(t[2]=p=>s.cancelRequest=!0)})):R("",!0)]),_:1},8,["modelValue"])):R("",!0)]),_:1})):s.getUserType==="QuickBase User"?(u(),$(ae,{key:1,class:"q-pt-none",align:"right"},{default:r(()=>[l(Le,{modelValue:s.actions,"onUpdate:modelValue":t[7]||(t[7]=p=>s.actions=p),square:"",color:"accent",icon:"keyboard_arrow_left",direction:"left",label:"Actions",padding:"sm"},{default:r(()=>[e.$can("manage","projectRequests")&&(s.hireRequestData[14]==="Open"||s.hireRequestData[14]==="Pending")?(u(),$(ue,{key:0,label:"Add Classifications",color:"primary",icon:"add",onClick:t[4]||(t[4]=p=>s.showAddJobs=!0)})):R("",!0),e.$can("manage","nameRequests")&&(s.hireRequestData[14]==="Open"||s.hireRequestData[14]==="Pending")?(u(),$(ue,{key:1,label:"Add Names to Request",color:"accent",icon:"person_add",onClick:t[5]||(t[5]=p=>s.showAddNames=!0)})):R("",!0),e.$can("manage","projectRequests")&&(s.hireRequestData[14]==="Open"||s.hireRequestData[14]==="Pending")?(u(),$(ue,{key:2,label:"Close Hire Request",color:"dark",icon:"cancel",onClick:t[6]||(t[6]=p=>s.cancelRequest=!0)})):R("",!0)]),_:1},8,["modelValue"])]),_:1})):R("",!0)])])]),_:1})]),_:1}),c("div",fs,[c("div",bs,[l(a,{details:s.details,title:"Details"},null,8,["details"])]),c("div",ps,[l(ra,{class:"q-py-xs bg-info text-white shadow-2 rounded-borders",align:"left",modelValue:s.tab,"onUpdate:modelValue":t[8]||(t[8]=p=>s.tab=p),dense:"","indicator-color":"accent","outside-arrows":"","mobile-arrows":"","inline-label":""},{default:r(()=>[l($e,{name:0,label:"Classifications"}),s.hireRequestData[282]==="Name Request Only"||s.hireRequestData[282]==="Mixed"?(u(),$($e,{key:0,name:1,label:"Names"})):R("",!0),s.hireRequestData[14]!=="Pending"?(u(),$($e,{key:1,name:2,label:"Offers"})):R("",!0),s.hireRequestData[14]!=="Pending"?(u(),$($e,{key:2,name:3,label:"Pipeline"})):R("",!0)]),_:1},8,["modelValue"]),l(na,{modelValue:s.tab,"onUpdate:modelValue":t[9]||(t[9]=p=>s.tab=p),animated:"",class:"q-px-none"},{default:r(()=>[l(we,{class:"q-pa-xs",name:0},{default:r(()=>[l(o,{data:s.hireRequestData},null,8,["data"])]),_:1}),l(we,{class:"q-pa-xs",name:1},{default:r(()=>[l(b,{data:s.hireRequestData},null,8,["data"])]),_:1}),l(we,{class:"q-pa-xs",name:2},{default:r(()=>[l(_,{data:s.hireRequestData.offers},null,8,["data"])]),_:1}),l(we,{class:"q-pa-xs",name:3},{default:r(()=>[l(i,{request:s.hireRequestData},null,8,["request"])]),_:1})]),_:1},8,["modelValue"])])]),l(ve,{persistent:"",modelValue:s.showAddNames,"onUpdate:modelValue":t[11]||(t[11]=p=>s.showAddNames=p)},{default:r(()=>[l(J,{flat:"",style:{width:"500px"}},{default:r(()=>[l(M,{class:"q-pa-none"},{default:r(()=>[l(g,{onCloseNames:t[10]||(t[10]=p=>s.showAddNames=!1),onNamesAdded:s.namesAdded,request:s.hireRequestData},null,8,["onNamesAdded","request"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ve,{persistent:"",modelValue:s.showAddJobs,"onUpdate:modelValue":t[13]||(t[13]=p=>s.showAddJobs=p)},{default:r(()=>[l(J,{flat:"",style:{width:"500px"}},{default:r(()=>[l(M,{class:"q-pa-none"},{default:r(()=>[l(C,{hideInstructions:!0,request:s.hireRequestData,onCloseJobs:t[12]||(t[12]=p=>s.showAddJobs=!1),onJobsAdded:s.jobsAdded,onJobUpdated:s.jobUpdated},null,8,["request","onJobsAdded","onJobUpdated"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])):R("",!0),s.hireRequestData[3]?(u(),$(S,{key:1,request:s.hireRequestData,modelValue:s.cancelRequest,"onUpdate:modelValue":t[14]||(t[14]=p=>s.cancelRequest=p)},null,8,["request","modelValue"])):R("",!0)]),_:1})}var ro=I(is,[["render",vs]]);export{ro as default};
