import{u as d,q as m}from"./app.b339b179.js";import{dayjs as v}from"./dayjs.5512aee7.js";import{l as g,_ as y,y as f,ap as w,bq as p,z as R,d as E,bP as N,aq as b,B as C,ab as $,E as D,cV as P}from"./index.8e33b0c3.js";const Q=async({data:a})=>{const{project:t,general:e,classifications:r,names:s,matches:n}=a;if(n)return{data:await _({data:a})};try{return{data:await M({data:a})}}catch(c){throw console.log(c),{message:"There was a problem submitting the hire request"}}},_=async({data:a})=>{const{matches:t,classifications:e,names:r}=a,s=t,n=e.filter(o=>o.match),c=e.filter(o=>!o.match);n.forEach(o=>{o.names=r.filter(l=>l.job.id===o.id)}),c.forEach(o=>{o.names=r.filter(l=>l.job.id===o.id)});const i=[];c.forEach(o=>{const l=h({requestData:s,job:o});i.push(l)}),n.forEach(o=>{const l=V({job:o});i.push(l)});const u=await Promise.allSettled(i);return s.classes=u.map(o=>o.value),s},M=async({data:a})=>{const{project:t,general:e,classifications:r,names:s}=a,{userData:n}=d();r.forEach(u=>{u.names=s.filter(o=>o.job.id===u.id)});const c={64:{value:e.dateNeeded},282:{value:e.restriction.value},284:{value:e.reason.value},31:{value:e.meetingLocation[3]},9:{value:e.jobNumber[3]},60:{value:e.siteContact[3]},92:{value:t[12]},6:{value:t[3]},272:{value:n[3]},281:{value:n[32]==="Project User"},14:{value:"Open"},147:{value:3},82:{value:v()},68:{value:e.perDiem?"Yes":"No"},65:{value:e.perDiem?e.perDiem[3]:""},299:{value:e.notes?e.notes:""},317:{value:e.time?e.time:""},318:{value:e.shift?e.shift.value:""},319:{value:e.hours?e.hours.value:""}};return await O({fields:c,classifications:r})},O=async({fields:a,classifications:t})=>{const{data:e}=await m.upsertRecordsXML({to:"bpzpyjbuy",data:[a],fieldsToReturn:[289],formatObject:289});if(!e[0])throw{message:"Error adding request!"};const r=e[0][289],s=[];t.forEach(c=>{const i=h({requestData:r,job:c});s.push(i)});const n=await Promise.allSettled(s);return r.classes=n.map(c=>c.value),r},V=async({job:a})=>{let t=0;t=a.match[18]+a.qty,t=t>a.names.length?t:a.names.length;const e={3:{value:a.match[3]},18:{value:t}},{data:r}=await m.upsertRecordsXML({to:"bpzpyqcu4",data:[e],fieldsToReturn:[250],formatObject:250});if(!r[0])throw{message:"Error updating classification!"};const s=r[0][250];if(a.names&&a.names.length>0){const n=[];a.names.forEach(i=>{const u=q({classificationData:s,name:i});n.push(u)});const c=await Promise.allSettled(n);return s.names=c.map(i=>i.value),s}else return s},h=async({requestData:a,job:t})=>{d();const e={6:{value:a[3]},9:{value:t.classification[3]},17:{value:"Open"},128:{value:3},18:{value:t.qty},23:{value:t.rate},238:{value:t.id}},{data:r}=await m.upsertRecordsXML({to:"bpzpyqcu4",data:[e],fieldsToReturn:[250],formatObject:250});if(!r[0])throw{message:"Error adding classification!"};const s=r[0][250];if(t.names&&t.names.length>0){const n=[];t.names.forEach(i=>{const u=q({classificationData:s,name:i});n.push(u)});const c=await Promise.allSettled(n);return s.names=c.map(i=>i.value),s}else return s},q=async({classificationData:a,name:t})=>{const{userData:e}=d(),r={6:{value:t.firstName},7:{value:t.lastName},8:{value:t.phoneNumber},19:{value:v()},16:{value:t.ssn},10:{value:"Has Not Arrived"},14:{value:`${e[35]} ${e[37]}`},17:{value:a[3]}},{data:s}=await m.upsertRecordsXML({to:"bsg4yb4wa",data:[r],fieldsToReturn:[40],formatObject:40});if(!s[0])throw{message:"Error adding name!"};return s[0][40]},x=async({job:a,matches:t})=>{const{classification:e,rate:r}=a,s=a.match?null:t.classes.find(n=>n[9]===e[3]&&n[23]===r);return s&&(a.match=s),a},F=async({id:a,qty:t})=>{const e={3:{value:a},18:{value:t}},{data:r}=await m.upsertRecordsXML({to:"bpzpyqcu4",data:[e],fieldsToReturn:[220],formatObject:220});return r[0][220]},k=g({name:"PayRateV2"}),z={key:0,class:"text-right"},L={class:"text-caption"};function S(a,t,e,r,s,n){return f(),w(P,D(a.$attrs,{"bottom-slots":""}),{append:p(()=>[a.$attrs.job&&a.$attrs.job.hasFixedRate&&!a.$can("manage","rates")?(f(),R("div",z,[E(N,{name:"lock",size:"sm"})])):b("",!0)]),error:p(()=>[C("div",L,$(a.$attrs.errorMessage),1)]),_:1},16)}var H=y(k,[["render",S]]);export{H as P,h as c,x as f,Q as n,F as u};
