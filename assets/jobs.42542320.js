import{Q as ce,a as fe,b as me}from"./QTabPanels.b3c7c119.js";import{Q as be}from"./QTabs.0e7a4c01.js";import{l as U,r as A,c as O,_ as z,y as n,z as N,B as h,d as o,bq as r,cT as Y,cU as L,ab as q,ap as g,cV as se,aq as R,bR as pe,cW as G,bV as V,bN as te,cz as oe,v as ve,bT as ie,b4 as W,F as H,b3 as K,aw as I}from"./index.b35eeed3.js";import{Q as ye}from"./QPage.6f4063c4.js";import{u as M}from"./use-quasar.6afddd70.js";import{q as J,b as we}from"./app.31ce29fc.js";import"./dayjs.c324749c.js";import{b as ee,a as ae}from"./useQuerySaver.d29ff9ee.js";import{u as de}from"./dataStore.54140746.js";import{Q as ge}from"./QInnerLoading.832dc14e.js";import{a as _,Q as he}from"./QTable.c08ed117.js";import{Q as ne}from"./QTr.47ac074f.js";import{Q as x}from"./QTd.a7c86421.js";import{a as Z}from"./QSelect.2ba35ed2.js";import{Q as re}from"./QForm.6c8993a8.js";import{a as le,u as X}from"./vee-validate.esm.0c700e69.js";import{a as D,f as Ce,c as $e}from"./array.164cfe36.js";import"./use-panel.87525cc8.js";import"./touch.3df10340.js";import"./selection.423f1a2d.js";import"./QResizeObserver.e8b5d41e.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.504e0e11.js";import"./index.04bc0a32.js";import"./i18n.a721d321.js";import"./QList.5b498127.js";import"./QMarkupTable.39675ceb.js";import"./use-fullscreen.36eb3617.js";import"./QChip.86c715a9.js";import"./QMenu.fc0510b6.js";import"./position-engine.301e00c6.js";const je=U({props:{job:Object,craft:Object},setup(e,{emit:t}){const s=M(),{capitalize:f}=ve,p=A(!1),d=A(""),l=A(null),i=A([]),a=A([]),m=c=>{const w=c.split(" ");let k="";return w.forEach((B,ue)=>{k+=ue>0?` ${f(B.toLowerCase())}`:f(B.toLowerCase())}),k},E=O(()=>D({alias:D().required().label("Custom Job Title"),fixedRate:Ce().moreThan(7.25,"Fixed rate must be greater than minimum wage.").lessThan(1e3).label("Fixed Rate").nullable().transform(c=>c||null)})),{meta:Q,errors:$,handleSubmit:b,handleReset:v}=le({validationSchema:E,initialValues:{fixedRate:e.job.fixedRate>0?e.job.fixedRate:null}}),{value:C}=X("alias"),{value:y}=X("fixedRate"),j=b(async c=>{s.loading.show();const w={3:{value:e.job[3]}};C.value!=={3:e.job[9],7:e.job[18]}&&Object.assign(w,{9:{value:c.alias[3]}}),y.value&&y.value!==e.job.fixedRate&&Object.assign(w,{155:{value:c.fixedRate}}),c.fixedRate===""&&Object.assign(w,{155:{value:null}});try{const{data:k}=await J.upsertRecordsXML({to:"bpzpx5m7x",data:[w],fieldsToReturn:[153],formatObject:153});k.length>0&&(v(),s.loading.hide(),t("editJobComplete",{craft:k[0][153]}))}catch{s.notify({type:"negative",message:"Something went wrong"})}}),T=async()=>{const c=a.value.find(k=>k[7].toLowerCase()===d.value.toLowerCase());await $e().required().isValid(d.value)?c?(C.value=c,P(),l.value="Custom Job Title already exists!"):(l.value=null,F(d.value)):l.value="Custom Job Title is required!"},F=async c=>{try{const{data:w}=await J.upsertRecordsXML({to:"bpzpi5rjh",data:[{6:{value:e.job[13]},7:{value:m(c)},11:{value:"No"}}],fieldsToReturn:[25],formatObject:25});a.value.push(w[0][25]),i.value=a.value,C.value=w[0][25],P()}catch{s.dialog({title:"Alert",message:"Something went wrong"}).onDismiss(()=>{P()})}},P=()=>{p.value=!1,d.value="",l.value=null},u=(c,w)=>{if(!c||c===""){w(()=>{i.value=a.value});return}w(()=>{const k=c.toLowerCase();i.value=a.value.filter(B=>B[7].toLowerCase().indexOf(k)>-1)})};return(async()=>{const{data:c}=await J.fetchFromStructureApp({fields:[ee({type:"jobAliases",query:`{'6'.EX.'${e.job[13]}'}AND{'15'.XEX.'Yes'}`})]});a.value=c,i.value=a.value,C.value={3:e.job[9],7:e.job[18]}})(),{formMeta:Q,formErrors:$,submit:j,alias:C,fixedRate:y,addNew:p,closeAddNew:P,newCategory:d,newCatError:l,filterOptions:u,validateNewCategory:T,options:i,rawOptions:a}}}),Ae={class:"text-body1 text-white"},Je={class:"text-caption"},Se={class:"text-caption"},ke={class:"text-caption"};function Ve(e,t,s,f,p,d){return n(),N("div",null,[h("div",null,[o(re,{onSubmit:te(e.submit,["prevent"])},{default:r(()=>[o(Y,{style:{width:"400px"}},{default:r(()=>[o(L,{class:"bg-dark"},{default:r(()=>[h("div",Ae,"Edit "+q(e.job[21])+" "+q(e.job[18]),1)]),_:1}),o(L,null,{default:r(()=>[o(Z,{class:"q-mb-sm",dense:"",label:"Job Title (Alias)","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.alias,"onUpdate:modelValue":t[0]||(t[0]=l=>e.alias=l),options:e.options,"option-label":"7","display-value":`${e.alias?e.alias[7]:""}`,"bottom-slots":"",disable:!0,readonly:!0,error:!!e.formErrors.alias},{error:r(()=>[h("div",Je,q(e.formErrors.alias),1)]),_:1},8,["modelValue","options","display-value","error"]),e.$can("manage","projects")?(n(),g(se,{key:0,step:"any",prefix:"$",type:"number",dense:"",label:"Fixed Rate",modelValue:e.fixedRate,"onUpdate:modelValue":t[1]||(t[1]=l=>e.fixedRate=l),error:!!e.formErrors.fixedRate,"bottom-slots":""},{error:r(()=>[h("div",Se,q(e.formErrors.fixedRate),1)]),_:1},8,["modelValue","error"])):R("",!0)]),_:1}),o(pe),o(G,{class:"bg-accent",align:"right"},{default:r(()=>[o(V,{size:e.$q.screen.lt.md?"sm":"",color:"secondary",label:"Cancel",onClick:t[2]||(t[2]=l=>e.$emit("closeEditJob"))},null,8,["size"]),o(V,{type:"submit",size:e.$q.screen.lt.md?"sm":"",color:"primary",label:"Save"},null,8,["size"])]),_:1})]),_:1})]),_:1},8,["onSubmit"]),o(oe,{modelValue:e.addNew,"onUpdate:modelValue":t[4]||(t[4]=l=>e.addNew=l)},{default:r(()=>[o(Y,null,{default:r(()=>[o(L,null,{default:r(()=>[o(se,{style:{width:"250px"},dense:"",label:"Custom Job Title",modelValue:e.newCategory,"onUpdate:modelValue":t[3]||(t[3]=l=>e.newCategory=l),error:!!e.newCatError,"bottom-slots":""},{error:r(()=>[h("div",ke,q(e.newCatError),1)]),_:1},8,["modelValue","error"])]),_:1}),o(G,{align:"right"},{default:r(()=>[o(V,{color:"secondary",label:"Cancel",onClick:e.closeAddNew},null,8,["onClick"]),o(V,{color:"primary",label:"Submit",type:"submit",onClick:e.validateNewCategory},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])])}var Re=z(je,[["render",Ve]]);const qe=U({props:{craft:Object},setup(e,t){const s=M(),f=D({job:D().required("Job is required."),alias:D().required("Alias is required.").nullable()}),{meta:p,errors:d,handleSubmit:l,handleReset:i}=le({validationSchema:f}),{value:a}=X("job"),{value:m}=X("alias"),E=l(async b=>{try{const{data:v}=await J.upsertRecordsXML({to:"bpzpx5m7x",data:[{9:{value:b.alias[3]},13:{value:b.job[3]},20:{value:e.craft[3]}}],fieldsToReturn:[153],formatObject:153});v.length>0&&(t.emit("newJobAdded",{craft:v[0][153]}),i())}catch{s.notify({type:"negative",message:"Something went wrong"})}});async function Q(b,v){s.dialog({title:"Confirm",message:`Confirm you want to add "${b}" as a new alias.`,cancel:!0,persistent:!0}).onOk(async()=>{try{const{data:C}=await J.upsertRecordsXML({to:"bpzpi5rjh",data:[{6:{value:a.value[3]},7:{value:b},11:{value:"No"}}],fieldsToReturn:[25],formatObject:25});C.length>0&&(m.value=C[0][25],v(C[0][25]))}catch{s.notify({type:"negative",message:"Something went wrong"})}}).onCancel(()=>{v()})}function $(){t.emit("cancelAddJob"),i()}return{formErrors:d,formMeta:p,submitJob:E,submitAlias:Q,cancelAddJob:$,job:a,alias:m,props:e}}}),Ee={class:"row justify-between"},Qe={class:"col-5"},Te={class:"text-caption"},Ne={class:"col-6"},Pe={class:"text-caption"};function Oe(e,t,s,f,p,d){return n(),N("div",null,[o(re,{onSubmit:te(e.submitJob,["prevent"])},{default:r(()=>[o(Y,{flat:""},{default:r(()=>[o(L,null,{default:r(()=>[h("div",Ee,[h("div",Qe,[o(Z,{class:"q-mb-sm",dense:"",label:"Select Default Job","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.job,"onUpdate:modelValue":t[0]||(t[0]=l=>e.job=l),options:e.props.craft.options.jobs,"option-label":"9","display-value":`${e.job?e.job[9]:""}`,"bottom-slots":"",error:!!e.formErrors.job},{error:r(()=>[h("div",Te,q(e.formErrors.job),1)]),_:1},8,["modelValue","options","display-value","error"])]),h("div",Ne,[o(Z,{disable:!e.job,class:"q-mb-sm",dense:"",label:"Select Custom Job Title (Alias)","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.alias,"onUpdate:modelValue":t[1]||(t[1]=l=>e.alias=l),options:e.job?e.job.aliases:[],"option-label":"7","display-value":`${e.alias?e.alias[7]:""}`,"bottom-slots":"",error:!!e.formErrors.alias,onNewValue:e.submitAlias,"use-input":"",behavior:e.$q.platform.is.ios===!0?"dialog":"menu"},{error:r(()=>[h("div",Pe,q(e.formErrors.alias),1)]),_:1},8,["disable","modelValue","options","display-value","error","onNewValue","behavior"])])])]),_:1}),o(G,{align:"right"},{default:r(()=>[o(V,{color:"secondary",label:"Cancel",onClick:e.cancelAddJob},null,8,["onClick"]),o(V,{color:"primary",label:"Submit Job",type:"submit"})]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var De=z(qe,[["render",Oe]]);const Fe=[{name:0,label:"Default Classification",align:"left",field:e=>e[17],format:e=>`${e}`,sortable:!0,required:!0},{name:1,label:"Vanity Job Title (Alias)",align:"left",field:e=>e[18],format:e=>`${e}`,sortable:!0}],Le=U({props:{category:Object,projectData:Object},components:{EditJobDialog:Re,AddNewJob:De},setup(e){const t=M(),s=ie(),{userType:f}=we(),p=A(!1),d=A(!1),l=A(null),i=A(null),a=A(!1),{getViewedProjects:m,updateViewedProjects:E,upsertProjectCraft:Q}=de(),$=O(()=>m(s.params.id)),b=O(()=>(e.category.classifications?e.category.classifications:[]).sort((S,c)=>S.order>c.order?-1:1)),v=async u=>{if(p.value=!0,$.value&&(u||!$.value[e.category.key]||$.value[e.category.key].length===0)){const{data:S}=await J.fetchFromProjectsApp({fields:[ae({type:e.category.key,query:e.category.query})]});E({id:s.params.id,dataset:e.category.key,data:S})}p.value=!1};function C(u,S){l.value=u,i.value=S,d.value=!0}const y=u=>{t.dialog({title:"Confirm",message:`Are you sure you want to remove the following Job?<br>Craft: ${u[21]}<br>Alias: ${u[18]}<br>Default: ${u[17]}`,ok:{label:"Yes"},html:!0,cancel:!0,persistent:!0}).onOk(()=>{j(u)})},j=async u=>{try{const{data:S}=await J.upsertRecordsXML({to:"bpzpx5m7x",data:[{3:{value:u[3]},33:{value:"Removed"}}],fieldsToReturn:[141],formatObject:141}),c=b.value.filter(k=>k[3]!==S[0][141][3]),w=e.category;w.classifications=c,E({id:s.params.id,dataset:"crafts",data:w,replace:!0}),t.notify({type:"positive",message:"Job Removed"})}catch(S){console.log(S),t.notify({type:"negative",message:"Something went wrong"})}};function T(){d.value=!1,l.value=null,i.value=null}function F({craft:u}){Q({craft:u}),d.value=!1,l.value=null,i.value=null,t.notify({type:"positive",message:"Job successfully updated!"})}function P({craft:u}){Q({craft:u}),a.value=!1,t.notify({type:"positive",message:"New job added!"})}return{props:e,loading:p,loadData:v,rows:b,initialPagination:A({rowsPerPage:100}),columns:Fe,showEditJob:d,showAddJob:a,editJobCraft:l,editJobJob:i,editJob:C,editJobComplete:F,newJobAddComplete:P,closeEditJob:T,removeJob:y,userType:f}}}),Xe={key:1};function Ue(e,t,s,f,p,d){const l=W("add-new-job"),i=W("edit-job-dialog");return n(),N("div",null,[e.showAddJob?R("",!0):(n(),g(he,{key:0,flat:"",dense:"",columns:e.$q.screen.lt.md?e.columns.filter(a=>a.required):e.columns,rows:e.rows,"row-key":a=>a[3],"table-header-class":"bg-dark text-white",class:"sticky-header-table","hide-pagination":"",pagination:e.initialPagination,"onUpdate:pagination":t[1]||(t[1]=a=>e.initialPagination=a),"rows-per-page-options":[0],loading:e.loading},{"top-left":r(()=>[e.$can("manage","projects")?(n(),g(V,{key:0,icon:"add",color:"accent",label:`Add a new ${e.category[10]} Job`,onClick:t[0]||(t[0]=a=>e.showAddJob=!0)},null,8,["label"])):R("",!0)]),loading:r(()=>[o(ge,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),header:r(a=>[o(ne,{class:"bg-dark text-white",props:a},{default:r(()=>[(n(!0),N(H,null,K(a.cols,m=>(n(),g(_,{class:"text-left",key:m.name},{default:r(()=>[I(q(m.label),1)]),_:2},1024))),128)),e.$can("manage","projects")?(n(),g(_,{key:0,class:"text-left"},{default:r(()=>[I("Rate")]),_:1})):R("",!0),o(_,{"auto-width":""})]),_:2},1032,["props"])]),body:r(a=>[o(ne,{props:a},{default:r(()=>[(n(!0),N(H,null,K(a.cols,m=>(n(),g(x,{key:m.name,props:a},{default:r(()=>[I(q(m.value),1)]),_:2},1032,["props"]))),128)),e.$can("manage","projects")?(n(),g(x,{key:0,class:"text-left"},{default:r(()=>[I(q(a.row.hasFixedRate?`$ ${a.row.fixedRate.toFixed(2)}`:"N/A"),1)]),_:2},1024)):R("",!0),o(x,{"auto-width":""},{default:r(()=>[e.$can("manage","projects")?(n(),g(V,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"edit",onClick:m=>e.editJob(e.category,a.row)},null,8,["onClick"])):R("",!0),e.$can("manage","projects")&&e.userType==="QuickBase User"?(n(),g(V,{key:1,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:m=>e.removeJob(a.row)},null,8,["onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAddJob?(n(),N("div",Xe,[o(l,{craft:e.category,onCancelAddJob:t[2]||(t[2]=a=>e.showAddJob=!1),onNewJobAdded:e.newJobAddComplete},null,8,["craft","onNewJobAdded"])])):R("",!0),o(oe,{modelValue:e.showEditJob,"onUpdate:modelValue":t[3]||(t[3]=a=>e.showEditJob=a),persistent:""},{default:r(()=>[o(i,{craft:e.editJobCraft,job:e.editJobJob,onCloseEditJob:e.closeEditJob,onEditJobComplete:e.editJobComplete},null,8,["craft","job","onCloseEditJob","onEditJobComplete"])]),_:1},8,["modelValue"])])}var ze=z(Le,[["render",Ue]]);const Me=U({emits:["cancelAddCraft","newCraftAdded"],props:{crafts:Array,project:Number},setup(e,{emit:t}){const s=M(),f=A([]),p=O(()=>{const y=new Set(e.crafts.map(T=>T[9]));return f.value.filter(T=>!y.has(T[3]))}),d=D({craftSelection:D().required("Craft is required.")}),{meta:l,errors:i,handleSubmit:a,handleReset:m}=le({validationSchema:d}),{value:E}=X("craftSelection"),Q=a(async y=>{s.loading.show();try{const j=await b(y.craftSelection[3]),T=await $(j),F=[];T.forEach(u=>{const S={9:{value:u[93]},13:{value:u[3]},20:{value:j[3]}};F.push(S)});const{data:P}=await J.upsertRecordsXML({to:"bpzpx5m7x",data:F,fieldsToReturn:[141],formatObject:141});P.forEach(u=>{j.classifications.push(u[141])}),s.loading.hide(),t("newCraftAdded",{craft:j})}catch{s.notify({type:"negative",message:"Something went wrong"})}}),$=async y=>{const{data:j}=await J.fetchFromStructureApp({fields:[ee({type:"availableJobs",query:`{'13'.EX.'${y[9]}'}AND{'71'.XEX.'Pending'}`})]});return j},b=async y=>{try{const{data:j}=await J.upsertRecordsXML({to:"bp5g8rym8",data:[{6:{value:"Active"},7:{value:e.project},9:{value:y}}],fieldsToReturn:[120],formatObject:120});return j[0][120]}catch{s.notify({type:"negative",message:"Something went wrong"})}},v=async()=>{s.loading.show();const{data:y}=await J.fetchFromStructureApp({fields:[ee({type:"availableCrafts",query:"{'16'.EX.'Yes'}"})]});f.value=y,s.loading.hide()};function C(){t("cancelAddCraft")}return v(),{formErrors:i,formMeta:l,submit:Q,cancelAdd:C,props:e,craftSelection:E,availableCrafts:p}}}),Be={class:"text-caption"},Ie=h("div",{class:"text-primary text-body1"},"This project already has all available crafts. Click cancel below to return.",-1);function Ye(e,t,s,f,p,d){return n(),N("div",null,[o(re,{onSubmit:te(e.submit,["prevent"])},{default:r(()=>[o(Y,{style:{width:"500px"}},{default:r(()=>[e.availableCrafts.length>0?(n(),g(L,{key:0},{default:r(()=>[o(Z,{class:"q-mb-sm",dense:"",label:"Select the Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.craftSelection,"onUpdate:modelValue":t[0]||(t[0]=l=>e.craftSelection=l),options:e.availableCrafts||[],"option-label":"6","display-value":`${e.craftSelection?e.craftSelection[6]:""}`,"bottom-slots":"",error:!!e.formErrors.craftSelection},{error:r(()=>[h("div",Be,q(e.formErrors.craftSelection),1)]),_:1},8,["modelValue","options","display-value","error"])]),_:1})):(n(),g(L,{key:1},{default:r(()=>[Ie]),_:1})),o(G,{align:"right"},{default:r(()=>[o(V,{color:"secondary",label:"Cancel",onClick:e.cancelAdd},null,8,["onClick"]),e.availableCrafts.length>0?(n(),g(V,{key:0,color:"primary",label:"Submit",type:"submit"})):R("",!0)]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var Ge=z(Me,[["render",Ye]]);const We=U({components:{CraftPanel:ze,AddNewCraft:Ge},setup(){const e=M(),t=A(null),s=A(!1),f=ie(),{getViewedProjects:p,updateViewedProjects:d,setViewedProjects:l}=de(),i=O(()=>f.params.id?f.params.id:null),a=O(()=>p(i.value)),m=O(()=>(a.value&&a.value.crafts?a.value.crafts:[]).sort((b,v)=>b.order>v.order?1:-1));function E({craft:$}){d({id:i.value,dataset:"crafts",data:[$],push:!0}),s.value=!1,t.value=$[3],e.notify({type:"positive",message:"New craft added!"})}return(async $=>{if(e.loading.show(),!a.value){const{data:b}=await J.fetchFromProjectsApp({fields:[ae({type:"projects",id:f.params.id})]});l({id:f.params.id,data:b})}if(i.value&&($||m.value.length===0)){const{data:b}=await J.fetchFromProjectsApp({fields:[ae({type:"projectCrafts",query:`{'7'.EX.'${i.value}'}`})]});d({id:i.value,dataset:"crafts",data:b});const v=b.sort((C,y)=>C.order>y.order?1:-1)[0];v?t.value=v[3]:s.value=!0}else t.value=m.value[0][3];e.loading.hide()})(),{tab:t,project:a,crafts:m,splitterModel:A(20),showAddCraft:s,newCraftAddComplete:E}}}),He={class:"q-pa-sm"},Ke={class:"row items-center"},Ze={class:"col-10 q-pr-sm"},_e={class:"col-2 text-center"};function xe(e,t,s,f,p,d){const l=W("craft-panel"),i=W("add-new-craft");return n(),g(ye,{style:{"max-width":"100vw"}},{default:r(()=>[h("div",He,[h("div",null,[h("div",Ke,[h("div",Ze,[o(be,{class:"q-py-xs bg-info text-white shadow-2 rounded-borders",dense:"",modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=a=>e.tab=a),"indicator-color":"accent","outside-arrows":"","mobile-arrows":"","inline-label":""},{default:r(()=>[(n(!0),N(H,null,K(e.crafts,a=>(n(),g(ce,{key:a[3],name:a[3],label:a[10]},null,8,["name","label"]))),128))]),_:1},8,["modelValue"])]),h("div",_e,[e.$can("manage","projects")?(n(),g(V,{key:0,color:"accent",label:"Add another Craft",onClick:t[1]||(t[1]=a=>e.showAddCraft=!0)})):R("",!0)])]),o(fe,{modelValue:e.tab,"onUpdate:modelValue":t[2]||(t[2]=a=>e.tab=a),animated:""},{default:r(()=>[(n(!0),N(H,null,K(e.crafts,a=>(n(),g(me,{key:a[3],name:a[3],class:"q-px-xs"},{default:r(()=>[o(l,{category:a,projectData:e.project},null,8,["category","projectData"])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),o(oe,{modelValue:e.showAddCraft,"onUpdate:modelValue":t[4]||(t[4]=a=>e.showAddCraft=a),persistent:""},{default:r(()=>[e.showAddCraft?(n(),g(i,{key:0,crafts:e.crafts,project:e.project[3]||null,onCancelAddCraft:t[3]||(t[3]=a=>e.showAddCraft=!1),onNewCraftAdded:e.newCraftAddComplete},null,8,["crafts","project","onNewCraftAdded"])):R("",!0)]),_:1},8,["modelValue"])])]),_:1})}var Qa=z(We,[["render",xe]]);export{Qa as default};
