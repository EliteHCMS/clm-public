import{Q as M,a as K,b as T}from"./QTabPanels.f08604ff.js";import{Q as Z}from"./QTabs.c48e8512.js";import{Q as ce}from"./QToolbar.7df6568a.js";import{Q as pe}from"./QPage.eef4aa2f.js";import{u as oe,q as se,i as ee}from"./app.5e67c239.js";import{l as x,bT as O,r as D,c as A,_ as z,b4 as N,y as v,z as X,d as l,bq as o,cU as B,B as c,cV as E,ap as V,aq as R,cT as L,bS as fe,w as be,o as ve,bP as ae,a7 as te,ab as W,bV as le,v as $e,aw as ge}from"./index.48ce5b72.js";import{a as re}from"./QSelect.06d0b9ce.js";import{u as H}from"./use-quasar.468e1258.js";import{u as G}from"./dataStore.dbb6cf0f.js";import{dayjs as Y}from"./dayjs.9bb68654.js";import{u as ne}from"./useQuerySaver.d29ff9ee.js";import{_ as ye}from"./projectSelector.c3a9b73c.js";import{R as ie,g as we}from"./quickbaseDataHelpers.3b3672f1.js";import{Q as De}from"./QTd.3c8ae2d8.js";import{Q as he}from"./QInnerLoading.bb9bb1a9.js";import{Q as _e}from"./QTable.68f70e77.js";import{e as Ve}from"./export-file.dc78ba05.js";import{P as je}from"./projectPipeline.6ffa13ce.js";import"./use-panel.a2490dda.js";import"./touch.3df10340.js";import"./selection.e8d17b8a.js";import"./QResizeObserver.903c6b28.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.a179cfc1.js";import"./index.04bc0a32.js";import"./i18n.0c36ad49.js";import"./QChip.d193a000.js";import"./QMenu.62e1eee7.js";import"./position-engine.a6f346a0.js";import"./QTr.9c84673a.js";import"./index.207f79eb.js";import"./arrivalDate.4ca1de77.js";import"./QTooltip.f21cfa79.js";import"./QForm.bcdbd200.js";import"./vee-validate.esm.51002094.js";import"./array.164cfe36.js";import"./QList.1735c3ac.js";import"./QMarkupTable.5a189cd0.js";import"./use-fullscreen.735db5b1.js";const Pe=x({props:{},components:{RosterTable:ie,projectSelector:ye},setup(a){const t=H(),j=O(),{getUserType:f}=oe(),P=D(""),b=D(null),d=D(null),{getManpowerData:s,setRosters:i}=G(),m=A(()=>j.params.id?j.params.id:null),$=A(()=>(s({dataset:"rosters",id:m.value})||[]).sort((g,S)=>g[1].$d<S[1].$d?1:-1).filter(g=>!g[112]&&g.latest&&g[102]==="Active")),_=A(()=>{let r=$.value;return r=b.value?r.filter(k=>Y(k[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===Y(b.value).tz("America/Chicago").format("MM/DD/YYYY")):r,r=d.value?r.filter(k=>k[68]===d.value):r,r.sort((k,g)=>k.employee[22]>g.employee[22]?1:-1)}),U=A(()=>[...new Map($.value.map(r=>[r[68],r[68]])).values()]),C=async r=>{(r||!s({dataset:"rosters",id:m.value}))&&(t.loading.show(),await u(),t.loading.hide())},u=async()=>{const r=`{'173'.EX.'${m.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:k}=await se.fetchFromHiringApp({fields:[ne({type:"assignments",query:r})]});i({id:m.value,data:k})};return C(!1),{allAssignments:$,search:P,startDateFilter:b,craftFilter:d,craftOptions:U,rows:_,getUserType:f,loadData:C}}}),ke={class:"row items-center"},Ye={class:"col-12 col-md-3 q-px-sm"},qe={class:"col-12 col-md-3 q-px-sm"},Re={class:"col-12 col-md-3 q-px-sm"};function Ae(a,t,j,f,P,b){const d=N("projectSelector"),s=N("roster-table");return v(),X("div",null,[l(L,{flat:""},{default:o(()=>[l(B,null,{default:o(()=>[c("div",ke,[c("div",Ye,[l(E,{dense:"",modelValue:a.search,"onUpdate:modelValue":t[0]||(t[0]=i=>a.search=i),label:"Search"},null,8,["modelValue"])]),c("div",qe,[l(E,{dense:"",modelValue:a.startDateFilter,"onUpdate:modelValue":t[1]||(t[1]=i=>a.startDateFilter=i),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),c("div",Re,[l(re,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:a.craftFilter,"onUpdate:modelValue":t[2]||(t[2]=i=>a.craftFilter=i),options:a.craftOptions,"use-chips":""},null,8,["modelValue","options"]),a.getUserType==="Project User"?(v(),V(d,{key:0,can:"read",dense:"",style:{display:"none"}})):R("",!0)])])]),_:1})]),_:1}),l(s,{rows:a.rows,onRefreshData:t[3]||(t[3]=i=>a.loadData(!0)),title:"Active Roster",filter:a.search},null,8,["rows","filter"])])}var Se=z(Pe,[["render",Ae]]);const Qe=x({props:{},components:{RosterTable:ie},setup(a){const t=H(),j=O(),f=D(""),P=D(null),b=D(null),{getManpowerData:d,setRosters:s}=G(),i=A(()=>j.params.id?j.params.id:null),m=A(()=>{const u=Y().subtract(14,"day");return(d({dataset:"rosters",id:i.value})||[]).sort((g,S)=>g[1].$d<S[1].$d?1:-1).filter(g=>!g[112]&&g.latest&&g[102]==="Active"&&Y(g[1].$d).isSameOrAfter(u)&&Y(g[1].$d).isSameOrBefore(Y()))}),$=A(()=>{let u=m.value;return u=P.value?u.filter(r=>Y(r[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===Y(P.value).tz("America/Chicago").format("MM/DD/YYYY")):u,u=b.value?u.filter(r=>r[68]===b.value):u,u.sort((r,k)=>r.employee[22]>k.employee[22]?1:-1)}),_=A(()=>[...new Map(m.value.map(u=>[u[68],u[68]])).values()]),U=async u=>{(u||!d({dataset:"rosters",id:i.value}))&&(t.loading.show(),await C(),t.loading.hide())},C=async()=>{const u=`{'173'.EX.'${i.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:r}=await se.fetchFromProjectsApp({fields:[ne({type:"assignments",query:u})]});s({id:i.value,data:r})};return{allAssignments:m,search:f,startDateFilter:P,craftFilter:b,craftOptions:_,rows:$,loadData:U}}}),Te={class:"row items-center"},Ne={class:"col-12 col-md-3 q-px-sm"},Ue={class:"col-12 col-md-3 q-px-sm"},Ce={class:"col-12 col-md-3 q-px-sm"};function Me(a,t,j,f,P,b){const d=N("roster-table");return v(),X("div",null,[l(L,{flat:""},{default:o(()=>[l(B,null,{default:o(()=>[c("div",Te,[c("div",Ne,[l(E,{dense:"",modelValue:a.search,"onUpdate:modelValue":t[0]||(t[0]=s=>a.search=s),label:"Search"},null,8,["modelValue"])]),c("div",Ue,[l(E,{dense:"",modelValue:a.startDateFilter,"onUpdate:modelValue":t[1]||(t[1]=s=>a.startDateFilter=s),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),c("div",Ce,[l(re,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:a.craftFilter,"onUpdate:modelValue":t[2]||(t[2]=s=>a.craftFilter=s),options:a.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),l(d,{rows:a.rows,onRefresh:t[3]||(t[3]=s=>a.loadData(!0)),title:"New Arrivals",filter:a.search},null,8,["rows","filter"])])}var Ee=z(Qe,[["render",Me]]);const Ie={class:"row items-center"},Be={class:"col-12 col-md-3 q-px-sm"},Fe={class:"col-12 col-md-3 q-px-sm"},Oe={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},ze={class:"text-dark text-caption text-italic"},Xe={__name:"releases",setup(a){const t=fe(),j=O(),f=H(),{capitalize:P}=$e,b=D(j.params.id?j.params.id:null),d=D(),s=D([]),i=D(""),m=D(""),$=D(!1),_=D({sortBy:6,descending:!0,page:1,rowsPerPage:25,rowsNumber:0});be(m,()=>{g()});const U=D([{name:"action",label:"",align:"left",field:e=>e[1],sortable:!1},{name:1,label:"Name",align:"left",field:e=>e[49],format:e=>`${u(e)}`,sortable:!1,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:e=>e[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[50],format:e=>`${e}`,sortable:!1,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[51],format:e=>e===""?"not available":e,sortable:!1},{name:4,label:"Classification",align:"left",field:e=>e[82],format:e=>`${!e||e===""?"Not Assigned":e.replace("&amp;","&")}`,sortable:!1},{name:7,label:"Term Reason",align:"left",field:e=>e[32],format:e=>`${e}`,sortable:!1},{name:"effectiveDate",label:"Release Date",align:"left",field:e=>e[36].$d,format:e=>`${Y(e).format("MM/DD/YYYY")}`,sortable:!0},{name:"releaseDateCreated",label:"Date Submitted",align:"left",field:e=>e[1].$d,format:e=>`${Y(e).format("MM/DD/YYYY")}`,sortable:!0},{name:42,label:"Status",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1,sortOrder:"ad"}]),C=D([{name:"action",label:"",align:"left",field:e=>e[1],sortable:!1},{name:1,label:"Name",align:"left",field:e=>e[49],format:e=>`${u(e)}`,sortable:!1,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:e=>e[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[50],format:e=>`${e}`,sortable:!1,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[51],format:e=>e===""?"not available":e,sortable:!1},{name:4,label:"Classification",align:"left",field:e=>e[82],format:e=>`${!e||e===""?"Not Assigned":e.replace("&amp;","&")}`,sortable:!1},{name:5,label:"Job #",align:"left",field:e=>e[81],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!1},{name:7,label:"Term Reason",align:"left",field:e=>e[32],format:e=>`${e}`,sortable:!1},{name:"effectiveDate",label:"Release Date",align:"left",field:e=>e[36].$d,format:e=>`${Y(e).format("MM/DD/YYYY")}`,sortable:!0},{name:"releaseDateCreated",label:"Date Submitted",align:"left",field:e=>e[1].$d,format:e=>`${Y(e).format("MM/DD/YYYY")}`,sortable:!0},{name:42,label:"Status",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1,sortOrder:"ad"}]),u=e=>{const y=e.split(" ");let n="";return y.forEach((p,Q)=>{n+=Q>0?` ${P(p.toLowerCase())}`:P(p.toLowerCase())}),n},r=({page:e,pageSize:y,descending:n,filter:p,sortBy:Q})=>{try{let q="";p&&(q=p.trim());const F={...p&&{$or:[{fullName:{$containsi:`${q}`}},{classification:{$containsi:`${q}`}},{jobNumber:{$containsi:`${q}`}},{workdayId:{$containsi:`${q}`}},{phoneNumber:{$containsi:`${q}`}},{payrollId:{$containsi:`${q}`}}]},...m.value&&{effectiveDate:{$eq:m.value}},...b.value&&{projectRID:{$eq:b.value}}};return ee.getReleases({pagination:{page:e,pageSize:y},sort:`effectiveDate:${n?"desc":"asc"}`,filters:F}).then(h=>{const{data:w,meta:I}=h,J=[];return w.forEach(ue=>{J.push(ee.formatObject(ue.syncObject))}),$.value=!1,{data:J,meta:I}})}catch{$.value=!1}},k=async e=>{const{page:y,rowsPerPage:n,sortBy:p,descending:Q}=e.pagination,q=e.filter,F=n===0?_.value.rowsNumber:n;$.value=!0;const h=await r({page:y,sortBy:p,descending:Q,pageSize:F,filter:q});if($.value=!1,h){const{data:w,meta:I}=h;s.value.splice(0,s.value.length,...w),_.value.page=I.pagination.page,_.value.rowsPerPage=I.pagination.pageSize,_.value.sortBy=p,_.value.rowsPerPage=I.pagination.pageSize,_.value.rowsNumber=I.pagination.total}};ve(()=>{d.value.requestServerInteraction()});const g=()=>{d.value.requestServerInteraction()};function S(e,y,n){let p=y!==void 0?y(e,n):e;return p=p==null?"":String(p),p=p.split('"').join('""'),`"${p}"`}const de=async()=>{const{page:e,rowsNumber:y,sortBy:n,descending:p}=_.value,Q=await r({page:e,sortBy:n,descending:p,pageSize:y,filter:i.value});let q=[U.value.map(h=>S(h.label))].concat(s.value.map(h=>U.value.map(w=>S(typeof w.field=="function"?w.field(h):h[w.field===void 0?w.name:w.field],w.format,h)).join(","))).join(`\r
`);Q&&Q.data&&(q=[C.value.map(h=>S(h.label))].concat(Q.data.map(h=>C.value.map(w=>S(typeof w.field=="function"?w.field(h):h[w.field===void 0?w.name:w.field],w.format,h)).join(","))).join(`\r
`)),Ve(`${Y().format("MM.DD.YYYY")} Releases-Export.csv`,q,"text/csv")!==!0&&f.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})};function me(e){t.push({name:"view-release",params:{release:e[3]}})}return(e,y)=>(v(),X("div",null,[l(L,{flat:""},{default:o(()=>[l(B,null,{default:o(()=>[c("div",Ie,[c("div",Be,[l(E,{dense:"",debounce:"300",modelValue:i.value,"onUpdate:modelValue":y[0]||(y[0]=n=>i.value=n),label:"Search"},null,8,["modelValue"])]),c("div",Fe,[l(E,{dense:"",debounce:"300",modelValue:m.value,"onUpdate:modelValue":y[1]||(y[1]=n=>m.value=n),label:"Release Date",type:"date","stack-label":""},null,8,["modelValue"])])])]),_:1})]),_:1}),c("div",null,[l(_e,{title:"Releases","title-class":"text-h5 text-primary",ref_key:"tableRef",ref:d,columns:U.value,rows:s.value,"row-key":n=>n[3],class:"q-pa-sm",pagination:_.value,"onUpdate:pagination":y[2]||(y[2]=n=>_.value=n),"table-header-class":"bg-dark text-white","no-data-label":"There are no releases",dense:"",filter:i.value,onRequest:k},{"body-cell-action":o(n=>[l(De,{props:n},{default:o(()=>[l(ae,{class:"cursor-pointer",size:te(f).screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:p=>me(n.row),name:n.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1032,["props"])]),"no-data":o(({message:n})=>[c("div",Oe,[l(ae,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),c("span",null,W(n),1)])]),"top-right":o(()=>[c("div",ze,"(Total: "+W(_.value.rowsNumber)+" releases)",1),l(le,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:g}),l(le,{dense:te(f).screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:de,disable:_.value.rowsNumber<1},null,8,["dense","disable"])]),loading:o(()=>[l(he,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key","pagination","filter"])])]))}},Le={name:"Pipeline",components:{ProjectPipelineTable:je},setup(){const a=H(),t=O(),j=D(""),{getManpowerData:f,setPipelines:P}=G(),b=A(()=>t.params.id?t.params.id:null),d=A(()=>f({dataset:"pipelines",id:b.value})||[]),s=async m=>{(m||!f({dataset:"pipelines",id:b.value}))&&(a.loading.show(),await i(),a.loading.hide())},i=async()=>{const m=await we(b.value);P({id:b.value,data:m})};return s(),{allPipeline:d,search:j,loadData:s}}},He={class:"text-h5 text-dark"},We={class:"text-body2 text-italic q-ml-sm"},xe=c("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for your job site(s).",-1),Ge={class:"row items-center"},Je={class:"col-12 col-md-3 q-px-sm"};function Ke(a,t,j,f,P,b){const d=N("project-pipeline-table");return v(),X("div",null,[l(L,{flat:""},{default:o(()=>[l(B,{class:"q-pb-none"},{default:o(()=>[c("div",He,[ge(" Staffing Pipeline "),c("span",We,"("+W(f.allPipeline.length)+" total)",1)]),xe]),_:1}),l(B,null,{default:o(()=>[c("div",Ge,[c("div",Je,[l(E,{dense:"",modelValue:f.search,"onUpdate:modelValue":t[0]||(t[0]=s=>f.search=s),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),l(d,{rows:f.allPipeline,onRefresh:t[1]||(t[1]=s=>f.loadData(!0))},null,8,["rows"])])}var Ze=z(Le,[["render",Ke]]);const ea=x({name:"Employees",components:{RosterTab:Se,NewArrivalsTab:Ee,ReleasesTab:Xe,PipelineTab:Ze},setup(){const a=D(0),{getUserType:t}=oe();return t==="QuickBase User"&&(a.value=3),{tab:a,getUserType:t}}}),aa={class:"q-pa-md"};function ta(a,t,j,f,P,b){const d=N("roster-tab"),s=N("new-arrivals-tab"),i=N("pipeline-tab"),m=N("releases-tab");return v(),V(pe,{style:{"max-width":"100vw"}},{default:o(()=>[c("div",aa,[l(ce,{class:"bg-info text-white shadow-2 rounded-borders"},{default:o(()=>[a.getUserType==="QuickBase User"?(v(),V(Z,{key:0,modelValue:a.tab,"onUpdate:modelValue":t[0]||(t[0]=$=>a.tab=$),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:o(()=>[a.$route.name==="project-manpower"?(v(),V(M,{key:0,name:3,label:"Pipeline"})):R("",!0),l(M,{name:2,label:"Releases"}),l(M,{name:0,label:a.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"])]),_:1},8,["modelValue"])):(v(),V(Z,{key:1,modelValue:a.tab,"onUpdate:modelValue":t[1]||(t[1]=$=>a.tab=$),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:o(()=>[a.$can("read","projectEmployees")?(v(),V(M,{key:0,name:0,label:a.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"])):R("",!0),a.$can("read","projectArrivals")?(v(),V(M,{key:1,name:1,label:"New Arrivals"})):R("",!0),a.$route.name==="project-manpower"&&a.$can("read","projectPipeline")?(v(),V(M,{key:2,name:3,label:"Pipeline"})):R("",!0),a.$can("read","projectEmployees")?(v(),V(M,{key:3,name:2,label:"Releases"})):R("",!0)]),_:1},8,["modelValue"]))]),_:1}),a.getUserType==="QuickBase User"?(v(),V(K,{key:0,modelValue:a.tab,"onUpdate:modelValue":t[2]||(t[2]=$=>a.tab=$),animated:""},{default:o(()=>[l(T,{name:0},{default:o(()=>[l(d)]),_:1}),l(T,{name:1},{default:o(()=>[l(s)]),_:1}),l(T,{name:3},{default:o(()=>[l(i)]),_:1}),l(T,{name:2},{default:o(()=>[l(m)]),_:1})]),_:1},8,["modelValue"])):(v(),V(K,{key:1,modelValue:a.tab,"onUpdate:modelValue":t[3]||(t[3]=$=>a.tab=$),animated:""},{default:o(()=>[a.$can("read","projectEmployees")?(v(),V(T,{key:0,name:0},{default:o(()=>[l(d)]),_:1})):R("",!0),a.$can("read","projectArrivals")?(v(),V(T,{key:1,name:1},{default:o(()=>[l(s)]),_:1})):R("",!0),a.$can("read","projectPipeline")?(v(),V(T,{key:2,name:3},{default:o(()=>[l(i)]),_:1})):R("",!0),a.$can("read","projectEmployees")?(v(),V(T,{key:3,name:2},{default:o(()=>[l(m)]),_:1})):R("",!0)]),_:1},8,["modelValue"]))])]),_:1})}var Oa=z(ea,[["render",ta]]);export{Oa as default};
