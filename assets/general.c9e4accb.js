import{Q as he,a as Se,b as je}from"./QTabPanels.8debf809.js";import{Q as De}from"./QTabs.809dd373.js";import{Q as Oe}from"./QPage.076a4a22.js";import{u as te}from"./use-quasar.8f886427.js";import{l as ae,r as V,c as D,_ as oe,b4 as W,y as p,z as L,d as s,bq as n,B as N,ab as S,bV as E,aq as X,cV as Q,bN as fe,ap as A,cz as ke,D as ie,cU as se,F as B,b3 as K,cT as ce,a4 as Ae,w as ve,a7 as h,b as G,cW as Ce,bT as de,aw as ue,v as Xe,bU as qe}from"./index.ffe008a3.js";import{q as w,u as Le,c as Ue,g as Te}from"./app.5c870bdd.js";import{dayjs as Me}from"./dayjs.90447d16.js";import{a as J,c as z,f as Ie}from"./array.164cfe36.js";import{a as Z,b as pe}from"./useQuerySaver.d29ff9ee.js";import{u as ne}from"./dataStore.1bd383fe.js";import{a as me}from"./QSelect.ae55bb14.js";import{Q as be}from"./QForm.6fe618de.js";import{a as ye,u as M}from"./vee-validate.esm.d1883a78.js";import{A as Fe,a as ze}from"./addNewCustomer.6054cf05.js";import{Q as ge}from"./QInnerLoading.56779734.js";import{a as _,Q as we}from"./QTable.38b8ded1.js";import{Q as x}from"./QTr.55b6c37e.js";import{Q as Qe}from"./QTooltip.aa54978d.js";import{Q as ee}from"./QTd.8827818e.js";import{u as He}from"./project.4b5ad551.js";import{s as Je}from"./states.03e3d448.js";import{p as We}from"./VueTelInput.b9c1c80c.js";import{u as Be}from"./dataStore.5bb6bbb0.js";import{a as Ye}from"./approveHeadcount.da2be008.js";import{d as H}from"./decode.3998c82c.js";import"./use-panel.71d52368.js";import"./touch.3df10340.js";import"./selection.67688afd.js";import"./QResizeObserver.825a34be.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.24be37ee.js";import"./index.04bc0a32.js";import"./i18n.ee1ec30d.js";import"./QChip.3ca5e7ec.js";import"./QMenu.1f533564.js";import"./position-engine.a8f2d15a.js";import"./QList.ec7dea95.js";import"./QMarkupTable.790f93ea.js";import"./use-fullscreen.6e4ff1be.js";const Ge=ae({emits:["cancelEdit"],components:{AddProjectLocationForm:Fe,AddCustomerForm:ze},props:{config:Object},setup(e,{emit:r}){const d=V(null),c=V(null),m=V(!1),g=async()=>{const{type:i,initialValue:C}=e.config;if(i==="options"){const{getter:y}=e.config;c.value=await y(),d.value=c.value,b.value=C(d.value)}else b.value=C},u=D(()=>J({entry:e.config.formRules})),{meta:l,errors:t,handleSubmit:k}=ye({validationSchema:u}),{value:b}=M("entry"),j=(i,C)=>{const{filter:y}=e.config;i===""&&C(()=>{d.value=c.value}),C(()=>{const v=i.toLowerCase();d.value=y(c.value,v)})},o=i=>{m.value=!1,c.value.push(i),d.value.push(i),b.value=i},a=k(async i=>{const{setter:C}=e.config;await C(i.entry),r("cancelEdit")});return g(),{rawOptions:c,options:d,entry:b,formErrors:t,formMeta:l,submit:a,filterOptions:j,addNew:m,newOptionAdded:o}}}),Ke={key:0,class:"q-pr-xl"},Ze={class:"text-caption"},_e={key:0,class:"text-center bg-info"},xe={key:0,class:"text-center bg-info"},et={key:1,class:"q-pr-xl"},tt={class:"text-caption"};function at(e,r,d,c,m,g){const u=W("add-project-location-form"),l=W("add-customer-form");return p(),L("div",null,[s(be,{onSubmit:fe(e.submit,["prevent"])},{default:n(()=>[e.config.type==="options"?(p(),L("div",Ke,[s(me,{class:"q-mb-sm",dense:"",label:`Select a ${e.config.fieldLabel}`,"transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.entry,"onUpdate:modelValue":r[3]||(r[3]=t=>e.entry=t),options:e.options,"option-label":e.config.optionLabel,"display-value":`${e.entry?e.entry[e.config.displayValue]:""}`,"bottom-slots":"",error:!!e.formErrors.entry,"stack-label":"","use-input":"",behavior:e.$q.platform.is.ios===!0?"dialog":"menu","input-debounce":"0",onFilter:e.filterOptions,clearable:"",loading:!e.rawOptions,disable:!e.rawOptions},{error:n(()=>[N("div",Ze,S(e.formErrors.entry),1)]),after:n(()=>[s(E,{type:"submit",color:"info",icon:"done",dense:"",onClick:e.submit},null,8,["onClick"]),s(E,{color:"dark",icon:"close",dense:"",onClick:r[0]||(r[0]=t=>e.$emit("cancelEdit"))})]),"after-options":n(()=>[e.config.allowNew&&e.options&&e.options.length>0?(p(),L("div",_e,[s(E,{flat:"",color:"white",label:`Add a New ${e.config.fieldLabel}`,onClick:r[1]||(r[1]=t=>e.addNew=!0)},null,8,["label"])])):X("",!0)]),"no-option":n(()=>[e.config.allowNew?(p(),L("div",xe,[s(E,{flat:"",color:"white",label:`Add a New ${e.config.fieldLabel}`,onClick:r[2]||(r[2]=t=>e.addNew=!0)},null,8,["label"])])):X("",!0)]),_:1},8,["label","modelValue","options","option-label","display-value","error","behavior","onFilter","loading","disable"])])):X("",!0),e.config.type==="input"?(p(),L("div",et,[s(Q,{class:"q-mb-sm",dense:"",label:e.config.fieldLabel,modelValue:e.entry,"onUpdate:modelValue":r[5]||(r[5]=t=>e.entry=t),"bottom-slots":"",error:!!e.formErrors.entry,"stack-label":""},{error:n(()=>[N("div",tt,S(e.formErrors.entry),1)]),after:n(()=>[s(E,{type:"submit",color:"info",icon:"done",dense:"",onClick:e.submit},null,8,["onClick"]),s(E,{color:"dark",icon:"close",dense:"",onClick:r[4]||(r[4]=t=>e.$emit("cancelEdit"))})]),_:1},8,["label","modelValue","error"])])):X("",!0)]),_:1},8,["onSubmit"]),s(ke,{modelValue:e.addNew,"onUpdate:modelValue":r[8]||(r[8]=t=>e.addNew=t)},{default:n(()=>[e.config.newType==="location"?(p(),A(u,{key:0,onCancelAdd:r[6]||(r[6]=t=>e.addNew=!1),onAddComplete:e.newOptionAdded},null,8,["onAddComplete"])):X("",!0),e.config.newType==="customer"?(p(),A(l,{key:1,onCancelAdd:r[7]||(r[7]=t=>e.addNew=!1),onAddComplete:e.newOptionAdded},null,8,["onAddComplete"])):X("",!0)]),_:1},8,["modelValue"])])}var ot=oe(Ge,[["render",at]]);const rt=ae({emits:[],props:{item:Object},components:{EditDetailsForm:ot},setup(e,{emit:r}){const d=V(!1),c=D(()=>{const{permission:m}=e.item.editable&&e.item.config?e.item.config:{action:null,subject:null};return m});return{edit:d,permission:c}}}),lt={key:0,class:"row"},st={class:"col-12 col-md-4"},nt={class:"col-12 col-md-8"};function it(e,r,d,c,m,g){const u=W("edit-details-form");return p(),A(se,{class:"q-py-sm"},{default:n(()=>[e.edit?(p(),A(u,{key:1,type:e.item.label,config:e.item.config,onCancelEdit:r[1]||(r[1]=l=>e.edit=!1)},null,8,["type","config"])):(p(),L("div",lt,[N("div",st,[N("div",null,[N("span",{class:ie(e.$q.screen.gt.lg?"text-body2":"text-caption")},S(e.item.label),3)])]),N("div",nt,[N("div",null,[N("span",{class:ie(["text-weight-light",e.$q.screen.gt.lg?"text-body2":"text-caption"])},S(e.item.value),3),e.item.editable&&e.$can(e.permission.action,e.permission.subject)?(p(),A(E,{key:0,color:"accent",flat:"",dense:"",round:"",icon:"edit",size:"sm",onClick:r[0]||(r[0]=l=>e.edit=!0)})):X("",!0)])])]))]),_:1})}var ut=oe(rt,[["render",it]]);const dt=ae({props:{title:String,details:Array},components:{DetailsSection:ut}}),ct={class:"text-body1 text-white"};function pt(e,r,d,c,m,g){const u=W("details-section");return p(),L("div",null,[s(ce,{class:"text-dark q-pb-sm"},{default:n(()=>[e.title&&e.title!==""?(p(),A(se,{key:0,class:"bg-info q-py-sm"},{default:n(()=>[N("div",ct,S(e.title.toUpperCase()),1)]),_:1})):X("",!0),(p(!0),L(B,null,K(e.details,l=>(p(),A(u,{key:l,item:l},null,8,["item"]))),128))]),_:1})])}var mt=oe(dt,[["render",pt]]);const ft={class:"q-pa-md q-gutter-sm"},vt={class:"text-body1 text-white"},bt={__name:"projectJobNumber",props:{prompt:{type:Boolean,default:!1},record:{type:Object,default:null}},emits:["update","canceled"],setup(e,{emit:r}){const d=e,c=te(),{getViewedProjects:m,updateViewedProjects:g}=ne(),{prompt:u,record:l}=Ae(d),t=V(!1),k=V(!1),b=D(()=>l.value&&l.value.projectId?m(l.value.projectId):null),j=D(()=>b.value&&b.value.crafts?b.value.crafts:[]),o=D(()=>J({jobNumber:z().required().label("Job Number"),description:z().required().label("Description"),craft:J().nullable().label("Craft")})),{errors:a,handleSubmit:i,handleReset:C}=ye({validationSchema:o}),{value:y}=M("jobNumber"),{value:v}=M("description"),{value:f}=M("craft"),O=V("add"),I=V("Project Job Number");ve(u,async R=>{if(l.value&&l.value.projectId&&j.value.length===0){const{data:P}=await w.fetchFromProjectsApp({fields:[Z({type:"projectCrafts",query:`{'7'.EX.'${l.value.projectId}'}`})]});g({id:l.value.projectId,dataset:"crafts",data:P})}R===!0&&(t.value=!0,l.value&&l.value[3]?(I.value=`Edit Job Number ${l.value[11]}`,O.value="edit",y.value=l.value[11],l.value[20]==="N/A"?v.value="":v.value=l.value[20],f.value=j.value?j.value.find(P=>P[3]===l.value[14]):null):(I.value="New Job Number",O.value="add"))});const q=i(async R=>{try{k.value=!0;const P={11:{value:R.jobNumber},20:{value:R.description},14:{value:R.craft?R.craft[3]:""}};l.value[3]&&(P[3]={value:l.value[3]}),l.value.projectId&&(P[6]={value:l.value.projectId}),await w.upsertRecordsXML({to:"bpzpwr2eh",data:[P],fieldsToReturn:[35],formatObject:35}),T(),k.value=!1,F(!0)}catch{k.value=!1,U()}}),F=R=>{C(),t.value=!1,r(R?"update":"canceled")},T=()=>{O.value==="add"?c.notify({type:"positive",message:"Record added."}):O.value==="edit"?c.notify({type:"positive",message:"Record updated."}):c.notify({type:"positive",message:"Successful."})},U=R=>{O.value==="add"?c.notify({type:"negative",message:"Error on adding Record!"}):O.value==="edit"?c.notify({type:"negative",message:"Error on updating Record!"}):c.notify({type:"negative",message:"Error!"})};return(R,P)=>(p(),L("div",ft,[s(ke,{modelValue:t.value,"onUpdate:modelValue":P[4]||(P[4]=$=>t.value=$),persistent:""},{default:n(()=>[s(ce,{style:{"min-width":"350px"}},{default:n(()=>[s(be,{onSubmit:fe(h(q),["prevent"])},{default:n(()=>[s(se,{class:"bg-dark"},{default:n(()=>[N("div",vt,S(I.value),1)]),_:1}),s(se,null,{default:n(()=>[s(Q,{dense:"",modelValue:h(y),"onUpdate:modelValue":P[0]||(P[0]=$=>G(y)?y.value=$:null),label:"Job Number *",readonly:O.value==="edit",error:!!h(a).jobNumber,"error-message":h(a).jobNumber},null,8,["modelValue","readonly","error","error-message"]),s(me,{dense:"",label:"Craft",clearable:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:h(f),"onUpdate:modelValue":P[1]||(P[1]=$=>G(f)?f.value=$:null),options:j.value,"option-label":"10",error:!!h(a).craft,"error-message":h(a).craft},null,8,["modelValue","options","error","error-message"]),s(Q,{dense:"",modelValue:h(v),"onUpdate:modelValue":P[2]||(P[2]=$=>G(v)?v.value=$:null),label:"Description *",error:!!h(a).description,"error-message":h(a).description},null,8,["modelValue","error","error-message"])]),_:1}),s(Ce,{align:"right",class:"text-primary bg-accent"},{default:n(()=>[s(E,{color:"secondary",onClick:P[3]||(P[3]=$=>F(!1)),label:"Cancel",size:h(c).screen.lt.md?"sm":"",disable:k.value},null,8,["size","disable"]),s(E,{color:"primary",type:"submit",label:"Save",size:h(c).screen.lt.md?"sm":"",disable:k.value},null,8,["size","disable"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]))}},yt=[{name:0,label:"Job Number",align:"left",field:e=>e[11],format:e=>`${e}`,sortable:!0},{name:1,label:"Craft",align:"left",field:e=>e[15],format:e=>`${e}`,sortable:!0,required:!0}],gt=ae({components:{projectJobNumber:bt},props:{project:String},setup(e){const r=te(),d=de(),c=V(!0),m=V(!1),g=V(null),{getViewedProjects:u,updateViewedProjects:l}=ne(),t=V(d.params.id?d.params.id:e.project);ve(()=>d.params.id,y=>{t.value=d.params.id});const k=D(()=>u(t.value)),b=D(()=>{const y=k.value&&k.value.jobNumbers?k.value.jobNumbers:[];return y.length>0?y.sort((v,f)=>v[1].$d>f[1].$d?1:-1):y}),j=async y=>{if(c.value=!0,m.value=!1,b.value.length===0||y){const{data:v}=await w.fetchFromProjectsApp({fields:[Z({type:"jobNumbers",query:`{'6'.EX.'${t.value}'}AND{'29'.EX.'Active'}`})]});l({id:t.value,dataset:"jobNumbers",data:v})}c.value=!1};function o(y){r.dialog({title:"Confirm",message:`Are you sure you want to remove job number ${y[11]}?`,cancel:!0,persistent:!0}).onOk(()=>{a(y)})}async function a(y){try{const{data:v}=await w.upsertRecordsXML({to:"bpzpwr2eh",data:[{3:{value:y[3]},29:{value:"Inactive"}}],fieldsToReturn:[35],formatObject:35}),f=b.value.filter(O=>O[3]!==v[0][35][3]);l({id:t.value,dataset:"jobNumbers",data:f}),r.notify({type:"positive",message:"Job Number Removed"})}catch(v){console.log(v),r.notify({type:"negative",message:"Something went wrong"})}}const i=y=>{y?g.value={projectId:t.value,...y}:g.value={projectId:t.value},m.value=!0},C=()=>{m.value=!1,g.value=null};return j(),{projectData:k,jobNumberColumns:yt,rows:b,initialPagination:{rowsPerPage:V(10)},showAddJobNumber:m,removeRow:o,loadData:j,loading:c,record:g,openJobNumber:i,jobNumberClosed:C}}}),wt={class:"text-caption"};function $t(e,r,d,c,m,g){const u=W("project-job-number");return p(),L("div",null,[s(we,{dense:"",title:"Job Numbers","title-class":"text-primary",style:{"max-height":"600px"},columns:e.jobNumberColumns,rows:e.rows,"row-key":l=>l[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{label:"Loading...","label-class":"text-info"})]),"top-left":n(()=>[e.$can("create","projectJobNumbers")||e.$can("manage","projects")?(p(),A(E,{key:0,dense:"",color:"accent",label:"Add New",onClick:r[0]||(r[0]=l=>e.openJobNumber())})):X("",!0)]),"top-right":n(()=>[s(E,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:r[1]||(r[1]=l=>e.loadData(!0))})]),header:n(l=>[s(x,{class:"bg-dark text-white",props:l},{default:n(()=>[(p(!0),L(B,null,K(l.cols,t=>(p(),A(_,{class:"text-left",key:t.name},{default:n(()=>[ue(S(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(l=>[s(x,{props:l},{default:n(()=>[s(Qe,{anchor:"top middle",self:"top middle"},{default:n(()=>[ue("Description: "+S(l.row[20]),1)]),_:2},1024),(p(!0),L(B,null,K(l.cols,t=>(p(),A(ee,{key:t.name,props:l},{default:n(()=>[N("span",wt,S(t.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","projectJobNumbers")||e.$can("manage","projects")?(p(),A(E,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"edit",onClick:t=>e.openJobNumber(l.row)},null,8,["onClick"])):X("",!0),e.$can("manage","projectJobNumbers")||e.$can("manage","projects")?(p(),A(E,{key:1,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(l.row)},null,8,["onClick"])):X("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"]),s(u,{prompt:e.showAddJobNumber,record:e.record,onUpdate:r[2]||(r[2]=l=>e.loadData(!0)),onCanceled:e.jobNumberClosed},null,8,["prompt","record","onCanceled"])])}var ht=oe(gt,[["render",$t]]);const jt={class:"q-pa-md q-gutter-sm"},Ct={class:"text-body1 text-white"},Nt={__name:"projectPerDiem",props:{prompt:{type:Boolean,default:!1},record:{type:Object,default:null}},emits:["update","canceled"],setup(e,{emit:r}){const d=e,c=te(),m=V(!1),g=D(()=>J({miles:z().required().label("Contract Miles"),rule:z().required().label("Rule"),amount:Ie().required().label("Per-Diem Amount"),approval:z().nullable().label("Approval"),mapRequired:z().nullable().required().label("Map Required").oneOf(["Yes","No",""]),idRequired:z().nullable().required().label("ID Required").oneOf(["Yes","No",""])})),{errors:u,handleSubmit:l,handleReset:t}=ye({validationSchema:g}),{value:k}=M("miles"),{value:b}=M("rule"),{value:j}=M("amount"),{value:o}=M("approval"),{value:a}=M("mapRequired"),{value:i}=M("idRequired"),C=V("add"),y=V("Project Per Diem"),{prompt:v,record:f}=Ae(d);ve(v,T=>{T===!0&&(m.value=!0,f.value&&f.value[3]?(y.value=`Edit #${f.value[3]} Per Diem`,C.value="edit",k.value=f.value[6],b.value=f.value[11],j.value=f.value[10],o.value=f.value[7]||"",a.value=f.value[23]||"",i.value=f.value[24]||""):(y.value="New Per Diem",C.value="add"))});const O=l(async T=>{try{const U={6:{value:T.miles},11:{value:T.rule},10:{value:T.amount},7:{value:T.approval},23:{value:T.mapRequired},24:{value:T.idRequired}};f.value[3]&&(U[3]={value:f.value[3]}),f.value.projectId&&(U[12]={value:f.value.projectId}),await w.upsertRecordsXML({to:"bp5mpfxia",data:[U],fieldsToReturn:[39],formatObject:39}),q(),I(!0)}catch{F()}}),I=T=>{t(),m.value=!1,r(T?"update":"canceled")},q=()=>{C.value==="add"?c.notify({type:"positive",message:"Record added."}):C.value==="edit"?c.notify({type:"positive",message:"Record updated."}):c.notify({type:"positive",message:"Successful."})},F=T=>{C.value==="add"?c.notify({type:"negative",message:"Error on adding Record!"}):C.value==="edit"?c.notify({type:"negative",message:"Error on updating Record!"}):c.notify({type:"negative",message:"Error!"})};return(T,U)=>(p(),L("div",jt,[s(ke,{modelValue:m.value,"onUpdate:modelValue":U[7]||(U[7]=R=>m.value=R),persistent:""},{default:n(()=>[s(ce,{style:{"min-width":"350px"}},{default:n(()=>[s(be,{onSubmit:fe(h(O),["prevent"])},{default:n(()=>[s(se,{class:"bg-dark"},{default:n(()=>[N("div",Ct,S(y.value),1)]),_:1}),s(se,null,{default:n(()=>[s(Q,{dense:"",modelValue:h(b),"onUpdate:modelValue":U[0]||(U[0]=R=>G(b)?b.value=R:null),label:"Rule *",error:!!h(u).rule,"error-message":h(u).rule},null,8,["modelValue","error","error-message"]),s(Q,{dense:"",modelValue:h(k),"onUpdate:modelValue":U[1]||(U[1]=R=>G(k)?k.value=R:null),label:"Contract Miles *",error:!!h(u).miles,"error-message":h(u).miles},null,8,["modelValue","error","error-message"]),s(Q,{dense:"",modelValue:h(j),"onUpdate:modelValue":U[2]||(U[2]=R=>G(j)?j.value=R:null),label:"Per-Diem Amount *",type:"number",error:!!h(u).amount,"error-message":h(u).amount},null,8,["modelValue","error","error-message"]),s(Q,{dense:"",modelValue:h(o),"onUpdate:modelValue":U[3]||(U[3]=R=>G(o)?o.value=R:null),label:"Approval",error:!!h(u).approval,"error-message":h(u).approval},null,8,["modelValue","error","error-message"]),s(me,{"transition-show":"flip-up","transition-hide":"flip-down",dense:"",modelValue:h(i),"onUpdate:modelValue":U[4]||(U[4]=R=>G(i)?i.value=R:null),options:["Yes","No"],label:"DL/ID Required? *",error:!!h(u).idRequired,"error-message":h(u).idRequired},null,8,["modelValue","error","error-message"]),s(me,{"transition-show":"flip-up","transition-hide":"flip-down",dense:"",modelValue:h(a),"onUpdate:modelValue":U[5]||(U[5]=R=>G(a)?a.value=R:null),options:["Yes","No"],label:"Map Required? *",error:!!h(u).mapRequired,"error-message":h(u).mapRequired},null,8,["modelValue","error","error-message"])]),_:1}),s(Ce,{align:"right",class:"text-primary bg-accent"},{default:n(()=>[s(E,{color:"secondary",onClick:U[6]||(U[6]=R=>I(!1)),label:"Cancel",size:h(c).screen.lt.md?"sm":""},null,8,["size"]),s(E,{color:"primary",type:"submit",label:"Save",size:h(c).screen.lt.md?"sm":""},null,8,["size"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]))}},kt=[{name:0,label:"Rule",align:"left",field:e=>e[11],format:e=>`${e}`,sortable:!0},{name:1,label:"Miles",align:"left",field:e=>e[6],format:e=>`${e}`,sortable:!0,required:!0},{name:2,label:"Amount",align:"left",field:e=>e[10],format:e=>e?`$ ${e.toFixed(2)}`:"",sortable:!0,required:!0}],Rt=ae({components:{projectPerDiem:Nt},props:{project:String},setup(e){const r=te(),d=de(),c=V(!0),m=V(null),{getViewedProjects:g,updateViewedProjects:u}=ne(),l=D(()=>d.params.id?d.params.id:e.project),t=D(()=>g(l.value)),k=D(()=>(t.value&&t.value.perDiem?t.value.perDiem:[]).sort((v,f)=>v[1].$d>f[1].$d?1:-1)),b=async y=>{if(c.value=!0,j.value=!1,k.value.length===0||y){const{data:v}=await w.fetchFromProjectsApp({fields:[Z({type:"perDiemSpecs",query:`{'12'.EX.'${l.value}'}AND{'38'.EX.'Active'}`})]});u({id:l.value,dataset:"perDiem",data:v})}c.value=!1},j=V(!1);He(),D(()=>(t.value&&t.value.jobNumbers?t.value.jobNumbers:[]).sort((v,f)=>v[1].$d>f[1].$d?1:-1));function o(y){r.dialog({title:"Confirm",message:`Are you sure you want to remove job number ${y[11]}?`,cancel:!0,persistent:!0}).onOk(()=>{a(y)})}async function a(y){try{const{data:v}=await w.upsertRecordsXML({to:"bp5mpfxia",data:[{3:{value:y[3]},38:{value:"Inactive"}}],fieldsToReturn:[39],formatObject:39}),f=k.value.filter(O=>O[3]!==v[0][39][3]);u({id:l.value,dataset:"perDiem",data:f})}catch(v){console.log(v),r.notify({type:"negative",message:"Something went wrong"})}}const i=y=>{y?m.value=y:m.value={projectId:l.value},j.value=!0},C=()=>{j.value=!1,m.value=null};return b(),{projectData:t,columns:kt,rows:k,initialPagination:{rowsPerPage:V(10)},showAddJobNumber:j,removeRow:o,loadData:b,loading:c,openPerDiem:i,perDiemClosed:C,record:m}}}),Vt={class:"text-caption"};function At(e,r,d,c,m,g){const u=W("project-per-diem");return p(),L("div",null,[s(we,{dense:"",title:"Per-Diem","title-class":"text-primary",style:{"max-height":"600px"},columns:e.columns,rows:e.rows,"row-key":l=>l[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":n(()=>[e.$can("create","projectPerDiem")||e.$can("manage","projects")?(p(),A(E,{key:0,dense:"",color:"accent",label:"Add New",onClick:r[0]||(r[0]=l=>e.openPerDiem())})):X("",!0)]),"top-right":n(()=>[s(E,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:r[1]||(r[1]=l=>e.loadData(!0))})]),header:n(l=>[s(x,{class:"bg-dark text-white",props:l},{default:n(()=>[(p(!0),L(B,null,K(l.cols,t=>(p(),A(_,{class:"text-left",key:t.name},{default:n(()=>[ue(S(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(l=>[s(x,{props:l},{default:n(()=>[(p(!0),L(B,null,K(l.cols,t=>(p(),A(ee,{key:t.name,props:l},{default:n(()=>[N("span",Vt,S(t.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","projectPerDiem")||e.$can("manage","projects")?(p(),A(E,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"edit",onClick:t=>e.openPerDiem(l.row)},null,8,["onClick"])):X("",!0),e.$can("manage","projectPerDiem")||e.$can("manage","projects")?(p(),A(E,{key:1,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(l.row)},null,8,["onClick"])):X("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"]),s(u,{prompt:e.showAddJobNumber,record:e.record,onUpdate:r[2]||(r[2]=l=>e.loadData(!0)),onCanceled:e.perDiemClosed},null,8,["prompt","record","onCanceled"])])}var qt=oe(Rt,[["render",At]]);const Et=ae({emits:["cancelAdd","addComplete"],props:{project:Object},setup(e,{emit:r}){const d=te(),c=de(),{getViewedProjects:m,updateViewedProjects:g}=ne(),u=D(()=>c.params.id?c.params.id:e.project[3]?e.project[3]:null),l=D(()=>u.value?m(u.value):null),t=J({name:z().required().label("Location Name"),street1:z().required().label("Street Address 1"),street2:z(),city:z().required().label("City"),state:z().required().label("State"),postal:z().required().label("Postal Code")}),{meta:k,errors:b,handleSubmit:j,handleReset:o}=ye({validationSchema:t}),{value:a}=M("name"),{value:i}=M("street1"),{value:C}=M("street2"),{value:y}=M("city"),{value:v}=M("state"),{value:f}=M("postal"),O=j(async I=>{const q={6:{value:I.name},8:{value:I.street1},9:{value:I.street2?I.street2:""},10:{value:I.city},11:{value:I.state},12:{value:I.postal},13:{value:"United States"}};l.value[8]&&Object.assign(q,{15:{value:l.value[8]}});try{const{data:F}=await w.upsertRecordsXML({to:"bp5d2twyj",data:[q],fieldsToReturn:[22],formatObject:22}),T=l.value.meetingLocations;T.push(F[0][22]),g({id:u.value,dataset:"meetingLocations",data:T}),d.notify({type:"positive",message:`Meeting location ${F[0][22][6]} successfully added`}),r("addComplete"),o()}catch(F){console.log(F),d.notify({type:"negative",message:"Something went wrong!"})}});return{projectObject:l,formErrors:b,formMeta:k,submit:O,name:a,street1:i,street2:C,city:y,state:v,postal:f,states:Je}}}),Pt={class:"row"},Lt={class:"col-6 col-md-12"},St={class:"text-caption"},Dt={class:"text-caption"},Ot={class:"text-caption"},Xt={class:"text-caption"},Ut={class:"text-caption"};function Tt(e,r,d,c,m,g){return p(),L("div",null,[s(be,{onSubmit:fe(e.submit,["prevent"])},{default:n(()=>[s(ce,null,{default:n(()=>[s(se,null,{default:n(()=>[N("div",Pt,[N("div",Lt,[s(Q,{label:"Location Name",dense:"",modelValue:e.name,"onUpdate:modelValue":r[0]||(r[0]=u=>e.name=u),error:!!e.formErrors.name,"bottom-slots":""},{error:n(()=>[N("div",St,S(e.formErrors.name),1)]),_:1},8,["modelValue","error"]),s(Q,{label:"Street Address 1",dense:"",modelValue:e.street1,"onUpdate:modelValue":r[1]||(r[1]=u=>e.street1=u),error:!!e.formErrors.street1,"bottom-slots":""},{error:n(()=>[N("div",Dt,S(e.formErrors.street1),1)]),_:1},8,["modelValue","error"]),s(Q,{label:"Street Address 2",dense:"",modelValue:e.street2,"onUpdate:modelValue":r[2]||(r[2]=u=>e.street2=u),error:!!e.formErrors.street2,"bottom-slots":""},{error:n(()=>[N("div",Ot,S(e.formErrors.street2),1)]),_:1},8,["modelValue","error"]),s(Q,{label:"City",dense:"",modelValue:e.city,"onUpdate:modelValue":r[3]||(r[3]=u=>e.city=u),error:!!e.formErrors.city,"bottom-slots":""},{error:n(()=>[N("div",Xt,S(e.formErrors.city),1)]),_:1},8,["modelValue","error"]),s(me,{dense:"",label:"State","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.state,"onUpdate:modelValue":r[4]||(r[4]=u=>e.state=u),options:e.states,"bottom-slots":""},null,8,["modelValue","options"]),s(Q,{label:"Postal Code",dense:"",modelValue:e.postal,"onUpdate:modelValue":r[5]||(r[5]=u=>e.postal=u),error:!!e.formErrors.postal,"bottom-slots":""},{error:n(()=>[N("div",Ut,S(e.formErrors.postal),1)]),_:1},8,["modelValue","error"])])])]),_:1}),s(Ce,{align:"right"},{default:n(()=>[s(E,{color:"secondary",label:"Cancel",onClick:r[6]||(r[6]=u=>e.$emit("cancelAdd"))}),s(E,{color:"primary",label:"Submit",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var Mt=oe(Et,[["render",Tt]]);const It=[{name:0,label:"Location Name",align:"left",field:e=>e[6],format:e=>`${e}`,sortable:!0},{name:1,label:"Address",align:"left",field:e=>e[8],format:e=>`${e}`,sortable:!1,required:!0}],Ft=ae({components:{AddMeetingLocation:Mt},props:{project:String},setup(e){const r=te(),d=de(),c=V(!0),m=V(!1),{getViewedProjects:g,updateViewedProjects:u}=ne(),l=D(()=>d.params.id?d.params.id:e.project),t=D(()=>g(l.value)),k=D(()=>t.value&&t.value.meetingLocations?t.value.meetingLocations:[]),b=async a=>{if(c.value=!0,(k.value.length===0||a)&&t.value){const{data:i}=await w.fetchFromStructureApp({fields:[pe({type:"meetingLocations",query:`{'15'.EX.'${t.value[8]}'}AND{'14'.EX.'Active'}`})]});u({id:l.value,dataset:"meetingLocations",data:i})}c.value=!1};function j(a){r.dialog({title:"Confirm",message:`Are you sure you want to remove location ${a[6]}?`,cancel:!0,persistent:!0}).onOk(()=>{o(a)})}async function o(a){try{const{data:i}=await w.upsertRecordsXML({to:"bp5d2twyj",data:[{3:{value:a[3]},14:{value:"Inactive"}}],fieldsToReturn:[22],formatObject:22}),C=k.value.filter(y=>y[3]!==i[0][22][3]);u({id:l.value,dataset:"meetingLocations",data:C}),r.notify({type:"positive",message:"Meeting Location Removed"})}catch(i){console.log(i),r.notify({type:"negative",message:"Something went wrong"})}}return b(),{projectData:t,columns:It,rows:k,initialPagination:{rowsPerPage:V(10)},showAdd:m,removeRow:j,loadData:b,loading:c}}}),zt={class:"text-caption"};function Qt(e,r,d,c,m,g){const u=W("add-meeting-location");return p(),L("div",null,[e.showAdd?X("",!0):(p(),A(we,{key:0,dense:"",title:"Meeting Locations","title-class":"text-primary",style:{"max-height":"600px"},columns:e.columns,rows:e.rows,"row-key":l=>l[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":n(()=>[e.$can("create","projects")?(p(),A(E,{key:0,dense:"",color:"accent",label:"Add New",onClick:r[0]||(r[0]=l=>e.showAdd=!0)})):X("",!0)]),"top-right":n(()=>[s(E,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:r[1]||(r[1]=l=>e.loadData(!0))})]),header:n(l=>[s(x,{class:"bg-dark text-white",props:l},{default:n(()=>[(p(!0),L(B,null,K(l.cols,t=>(p(),A(_,{class:"text-left",key:t.name},{default:n(()=>[ue(S(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(l=>[s(x,{props:l},{default:n(()=>[(p(!0),L(B,null,K(l.cols,t=>(p(),A(ee,{key:t.name,props:l},{default:n(()=>[N("span",zt,S(t.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("create","projects")?(p(),A(E,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(l.row)},null,8,["onClick"])):X("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAdd?(p(),A(u,{key:1,onAddComplete:r[2]||(r[2]=l=>e.showAdd=!1),onCancelAdd:r[3]||(r[3]=l=>e.showAdd=!1)})):X("",!0)])}var Ht=oe(Ft,[["render",Qt]]);const Jt={class:"q-pa-md q-gutter-sm"},Wt={class:"text-body1 text-white"},Bt={__name:"projectSiteContact",props:{prompt:{type:Boolean,default:!1},record:{type:Object,default:null}},emits:["update","canceled"],setup(e,{emit:r}){const d=e,c=te(),m=V(10),g=V(null),u=V(!1),l=D(()=>{const R=new RegExp("^[0-9]{"+m.value+"}","g");return J({firstName:z().required().label("First Name"),lastName:z().required().label("Last Name"),email:z().email().required().label("Email"),phoneNumber:z().matches(R,{excludeEmptyString:!0,message:"Valid Phone Number Required!"}).required().label("Phone Number")})}),{errors:t,handleSubmit:k,handleReset:b}=ye({validationSchema:l}),{value:j}=M("firstName"),{value:o}=M("lastName"),{value:a}=M("email"),{value:i}=M("phoneNumber"),C=V("add"),y=V("Project Site Contact"),{prompt:v,record:f}=Ae(d);ve(v,async R=>{R===!0&&(u.value=!0,f.value&&f.value[3]?(y.value=`Edit #${f.value[3]} ${f.value[17]}`,C.value="edit",j.value=f.value[28],o.value=f.value[29],i.value=f.value[20].replace(/\D/g,""),a.value=f.value[21]):(y.value="New Site Contact",C.value="add"))});const O=k(async R=>{try{const P={28:{value:R.firstName},29:{value:R.lastName},30:{value:R.phoneNumber},31:{value:R.email}};f.value[3]&&(P[3]={value:f.value[3]}),f.value.projectId&&(P[7]={value:f.value.projectId}),await w.upsertRecordsXML({to:"bp5hcce69",data:[P],fieldsToReturn:[27],formatObject:27}),T(),F(!0)}catch{U()}}),I=R=>{g.value=R},q=R=>{m.value=R},F=R=>{b(),u.value=!1,r(R?"update":"canceled")},T=()=>{C.value==="add"?c.notify({type:"positive",message:"Record added."}):C.value==="edit"?c.notify({type:"positive",message:"Record updated."}):c.notify({type:"positive",message:"Successful."})},U=R=>{C.value==="add"?c.notify({type:"negative",message:"Error on adding Record!"}):C.value==="edit"?c.notify({type:"negative",message:"Error on updating Record!"}):c.notify({type:"negative",message:"Error!"})};return(R,P)=>(p(),L("div",Jt,[s(ke,{modelValue:u.value,"onUpdate:modelValue":P[5]||(P[5]=$=>u.value=$),persistent:""},{default:n(()=>[s(ce,{style:{"min-width":"350px"}},{default:n(()=>[s(be,{onSubmit:fe(h(O),["prevent"])},{default:n(()=>[s(se,{class:"bg-dark"},{default:n(()=>[N("div",Wt,S(y.value),1)]),_:1}),s(se,null,{default:n(()=>[s(Q,{dense:"",modelValue:h(j),"onUpdate:modelValue":P[0]||(P[0]=$=>G(j)?j.value=$:null),label:"First Name *",tabindex:"1",error:!!h(t).firstName,"error-message":h(t).firstName},null,8,["modelValue","error","error-message"]),s(Q,{dense:"",modelValue:h(o),"onUpdate:modelValue":P[1]||(P[1]=$=>G(o)?o.value=$:null),label:"Last Name *",tabindex:"2",error:!!h(t).lastName,"error-message":h(t).lastName},null,8,["modelValue","error","error-message"]),s(We,{name:"phoneNumber",class:"col-xs-12 col-sm-12",dense:"",modelValue:h(i),"onUpdate:modelValue":P[2]||(P[2]=$=>G(i)?i.value=$:null),label:"Phone Number",tabindex:"3",onMaxLengthChanged:q,error:!!h(t).phoneNumber,"error-message":h(t).phoneNumber,onCountryChanged:I},null,8,["modelValue","error","error-message"]),s(Q,{dense:"",modelValue:h(a),"onUpdate:modelValue":P[3]||(P[3]=$=>G(a)?a.value=$:null),label:"Email *",type:"email",tabindex:"4",error:!!h(t).email,"error-message":h(t).email},null,8,["modelValue","error","error-message"])]),_:1}),s(Ce,{align:"right",class:"text-primary bg-accent"},{default:n(()=>[s(E,{color:"secondary",onClick:P[4]||(P[4]=$=>F(!1)),label:"Cancel",size:h(c).screen.lt.md?"sm":""},null,8,["size"]),s(E,{color:"primary",type:"submit",label:"Save",size:h(c).screen.lt.md?"sm":""},null,8,["size"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]))}},{capitalize:Pe}=Xe,Ve=e=>{const r=e.split(" ");let d="";return r.forEach((c,m)=>{d+=m>0?` ${Pe(c.toLowerCase())}`:Pe(c.toLowerCase())}),d},Yt=[{name:0,label:"Name",align:"left",field:e=>e[17],format:e=>`${Ve(e)}`,sortable:!0},{name:1,label:"Phone",align:"left",field:e=>e[20],format:e=>e!==""?`${e}`:"N/A",sortable:!0,required:!0}],Gt=ae({components:{projectSiteContact:Bt},props:{project:String},setup(e){const r=te(),d=de(),c=V(!0),m=V(null),g=V(!1),{getViewedProjects:u,updateViewedProjects:l}=ne(),t=D(()=>d.params.id?d.params.id:e.project),k=D(()=>u(t.value)),b=D(()=>(k.value&&k.value.siteContacts?k.value.siteContacts:[]).sort((f,O)=>f[17]>O[17]?1:-1)),j=async v=>{if(c.value=!0,g.value=!1,m.value=null,b.value.length===0||v){const{data:f}=await w.fetchFromProjectsApp({fields:[Z({type:"siteContacts",query:`{'7'.EX.'${t.value}'}AND{'6'.EX.'Active'}`})]});l({id:t.value,dataset:"siteContacts",data:f})}c.value=!1};function o(v){r.dialog({title:"Confirm",message:`Are you sure you want to remove contact ${Ve(v[17])}?`,cancel:!0,persistent:!0}).onOk(()=>{a(v)})}async function a(v){try{const{data:f}=await w.upsertRecordsXML({to:"bp5hcce69",data:[{3:{value:v[3]},6:{value:"Inactive"}}],fieldsToReturn:[27],formatObject:27}),O=b.value.filter(I=>I[3]!==f[0][27][3]);l({id:t.value,dataset:"siteContacts",data:O}),r.notify({type:"positive",message:"Contact Removed"})}catch(f){console.log(f),r.notify({type:"negative",message:"Something went wrong"})}}const i=v=>{g.value=!1,j(!0)},C=v=>{v?m.value=v:m.value={projectId:t.value},g.value=!0},y=()=>{g.value=!1,m.value=null};return j(),{projectData:k,columns:Yt,rows:b,initialPagination:{rowsPerPage:V(10)},showAdd:g,removeRow:o,loadData:j,loading:c,properValue:Ve,contactAdded:i,record:m,openSiteContact:C,siteContactClosed:y}}}),Kt={class:"text-caption"};function Zt(e,r,d,c,m,g){const u=W("project-site-contact");return p(),L("div",null,[s(we,{dense:"",title:"Contacts","title-class":"text-primary",style:{"max-height":"600px"},columns:e.columns,rows:e.rows,"row-key":l=>l[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":n(()=>[e.$can("create","projectContacts")||e.$can("manage","projects")?(p(),A(E,{key:0,dense:"",color:"accent",label:"Add New",onClick:r[0]||(r[0]=l=>e.openSiteContact())})):X("",!0)]),"top-right":n(()=>[s(E,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:r[1]||(r[1]=l=>e.loadData(!0))})]),header:n(l=>[s(x,{class:"bg-dark text-white",props:l},{default:n(()=>[(p(!0),L(B,null,K(l.cols,t=>(p(),A(_,{class:"text-left",key:t.name},{default:n(()=>[ue(S(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(l=>[s(x,{props:l},{default:n(()=>[(p(!0),L(B,null,K(l.cols,t=>(p(),A(ee,{key:t.name,props:l},{default:n(()=>[N("span",Kt,S(t.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","projectContacts")||e.$can("manage","projects")?(p(),A(E,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"edit",onClick:t=>e.openSiteContact(l.row)},null,8,["onClick"])):X("",!0),e.$can("manage","projectContacts")||e.$can("manage","projects")?(p(),A(E,{key:1,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(l.row)},null,8,["onClick"])):X("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"]),s(u,{prompt:e.showAdd,record:e.record,onUpdate:r[2]||(r[2]=l=>e.loadData(!0)),onCanceled:e.siteContactClosed},null,8,["prompt","record","onCanceled"])])}var _t=oe(Gt,[["render",Zt]]);const xt=ae({components:{},props:{project:Object},setup(e,r){const d=te(),c=V(10),m=V(null),{getUser:g}=qe(Le()),u=V(null),l=D(()=>{const $=new RegExp("^[0-9]{"+c.value+"}","g");return J({firstName:z().required().label("First Name"),lastName:z().required().label("Last Name"),email:z().email().required().label("Email"),phoneNumber:z().matches($,{excludeEmptyString:!0,message:"Valid Phone Number Required!"}).required().label("Phone Number"),role:J().required().nullable().label("Role"),workdayId:z().required().label("Workday ID")})}),{meta:t,errors:k,handleSubmit:b,handleReset:j}=ye({validationSchema:l}),{value:o}=M("firstName"),{value:a}=M("lastName"),{value:i}=M("email"),{value:C}=M("phoneNumber"),{value:y}=M("role"),{value:v}=M("workdayId");async function f({accessID:$}){const{data:Y}=await w.upsertRecordsXML({to:"br598isx6",data:[{3:{value:$},20:{value:!0}}],fieldsToReturn:[28],formatObject:28});r.emit("userAdded",{user:Y[0][28]}),d.loading.hide(),j()}async function O($,Y){w.upsertRecordsXML({to:"br4pxrbs6",data:[{3:{value:$},10:{value:"Active"},11:{value:Y}}]});const{data:$e}=await w.fetchFromStructureApp({fields:[{6:{value:"br598isx6"},7:{value:"Table Query"},8:{value:`{'6'.EX.${$}}`},9:{value:1},14:{value:24}}]});if(new Set($e.filter(le=>le[7]==="Project").map(le=>le[9])).has(e.project[3])){const le=$e.find(Re=>Re[9]===e.project[3]);f({accessID:le[3]})}else return!1}async function I($){const Y=`{'6'.EX.'${$.email}'}AND{'8'.EX.'${$.phoneNumber}'}AND{'32'.EX.'${$.userType}'}`,$e=[{7:{value:"User Request"},8:{value:Y},9:{value:1},14:{value:77}}];if(Y==="{'10'.EX.'Active'}AND{'32'.EX.'Candidate'}"||Y==="{'10'.EX.'Active'}AND{'32'.EX.'Project User'}")throw{response:{data:{errtext:"Unknown username",errdetail:"Sorry! Something's wrong. Try again."}}};const{data:re}=await w.fetchFromStructureApp({fields:$e});if(re.length<1)return null;if(!await O(re[0][3],$.role))return re}const q=b(async $=>{d.loading.show();const Y={userType:"Project User",phoneNumber:`+${m.value?m.value.dialCode:"1"}${$.phoneNumber}`,email:$.email,role:$.role[3]};if(e.project.users.filter(re=>re[6]===Y.email||re[8]===Y.phoneNumber).length>0)d.dialog({title:"Alert",message:"Your project already has a user with that phone or email."}).onOk(()=>{r.emit("userCanceled")});else{const re=await I(Y);if(console.log(re),re){const{data:le}=await w.upsertRecordsXML({to:"br598isx6",data:[{6:{value:re[0][3]},7:{value:"Project"},9:{value:e.project[3]}}],fieldsToReturn:[28],formatObject:28});le.length>0&&r.emit("userAdded",{user:le[0][28]})}else{const le=i.value.match(/^([^@]*)@/)[1],Re=Object.assign({phoneNumber:C.value},m.value),{data:Ee}=await w.upsertRecordsXML({to:"br4pxrbs6",data:[{6:{value:$.email},7:{value:"temp"},8:{value:`+${m.value?m.value.dialCode:"1"}${$.phoneNumber}`},9:{value:JSON.stringify(Re)},10:{value:"Active"},11:{value:$.role[3]},17:{value:!0},23:{value:g.value[3]},24:{value:g.value[3]},25:{value:new Date},26:{value:new Date},32:{value:"Project User"},33:{value:le},35:{value:o.value},37:{value:a.value},49:{value:!0},50:{value:!0},70:{value:$.workdayId}}],fieldsToReturn:[3,96],formatObject:96});if(Ee[0]!==void 0){const Ne=await w.upsertRecordsXML({to:"br598isx6",data:[{6:{value:Ee[0][3]},7:{value:"Project"},9:{value:e.project[3]}}],fieldsToReturn:[28],formatObject:28});Ne.data[0]!==void 0&&d.dialog({title:"Confirm",message:"User successfully added. Would you like to send them an invite?",cancel:!0,persistent:!0}).onOk(async()=>{(await w.upsertRecordsXML({to:"br4pxrbs6",data:[{3:{value:Ne.data[0][28][3]},93:{value:new Date}}],fieldsToReturn:[3]})).data[0]!==void 0&&(d.notify({type:"positive",message:"User invite submitted"}),r.emit("userAdded",{user:Ne.data[0][28]}))}).onCancel(()=>{r.emit("userAdded",{user:Ne.data[0][28]})})}}}j(),d.loading.hide()}),F=D(()=>{const $=e.project.users.map(Y=>Y[9].phoneNumber);return new Set($)});ve(C,$=>{F.value.has($)&&d.notify({type:"negative",message:"Phone Number is already in use!",timeout:1e4,position:d.screen.lt.md?"top":"center"})});const T=$=>{m.value=$},U=$=>{c.value=$};function R(){j(),r.emit("userCanceled")}async function P(){d.loading.show();const{data:$}=await w.fetchFromStructureApp({fields:[{6:{value:"br5v4in72"},7:{value:"Table Query"},8:{value:"{'7'.EX.'Projects'}AND{'15'.EX.'Active'}AND{'17'.EX.true}"},9:{value:1},14:{value:18}}]});u.value=$,d.loading.hide()}return P(),{updateCountry:T,updatePhoneMaxLength:U,firstName:o,lastName:a,email:i,phoneNumber:C,role:y,workdayId:v,formMeta:t,formErrors:k,submitUser:q,roleOptions:u,cancel:R}}}),ea=N("div",{class:"text-primary text-h6"},"Add a New User",-1),ta=N("div",{class:"text-accent text-body2 text-italic q-mb-md"},"All info is required.",-1),aa={class:"row justify-between"},oa={class:"row justify-between"},ra={class:"text-caption"},la={class:"row justify-between"},sa={class:"text-caption"},na={class:"text-caption"};function ia(e,r,d,c,m,g){return p(),L("div",null,[s(ce,null,{default:n(()=>[s(be,{onSubmit:fe(e.submitUser,["prevent"])},{default:n(()=>[s(se,null,{default:n(()=>[ea,ta,N("div",aa,[N("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(Q,{dense:"",outlined:"",label:"First Name",modelValue:e.firstName,"onUpdate:modelValue":r[0]||(r[0]=u=>e.firstName=u),error:!!e.formErrors.firstName},null,8,["modelValue","error"])],2),N("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(Q,{dense:"",outlined:"",label:"Last Name",modelValue:e.lastName,"onUpdate:modelValue":r[1]||(r[1]=u=>e.lastName=u),error:!!e.formErrors.lastName},null,8,["modelValue","error"])],2)]),N("div",oa,[N("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(Q,{dense:"",outlined:"",label:"Workday ID",modelValue:e.workdayId,"onUpdate:modelValue":r[2]||(r[2]=u=>e.workdayId=u),error:!!e.formErrors.workdayId},null,8,["modelValue","error"])],2),N("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(Q,{dense:"",outlined:"",label:"Phone Number",modelValue:e.phoneNumber,"onUpdate:modelValue":r[3]||(r[3]=u=>e.phoneNumber=u),error:!!e.formErrors.phoneNumber,"bottom-slots":""},{error:n(()=>[N("div",ra,S(e.formErrors.phoneNumber),1)]),_:1},8,["modelValue","error"])],2)]),N("div",la,[N("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(Q,{dense:"",outlined:"",label:"Email","bottom-slots":"",modelValue:e.email,"onUpdate:modelValue":r[4]||(r[4]=u=>e.email=u),error:!!e.formErrors.email},{error:n(()=>[N("div",sa,S(e.formErrors.email),1)]),_:1},8,["modelValue","error"])],2),N("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(me,{dense:"",outlined:"",label:"Role","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.role,"onUpdate:modelValue":r[5]||(r[5]=u=>e.role=u),options:e.roleOptions,"option-label":"6","display-value":`${e.role?e.role[6]:""}`,"bottom-slots":"",error:!!e.formErrors.role},{error:n(()=>[N("div",na,S(e.formErrors.role),1)]),_:1},8,["modelValue","options","display-value","error"])],2)])]),_:1}),s(Ce,{align:"right"},{default:n(()=>[s(E,{color:"secondary",onClick:e.cancel,label:"Cancel"},null,8,["onClick"]),s(E,{color:"primary",type:"submit",label:"Submit"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})])}var ua=oe(xt,[["render",ia]]);const da=[{name:1,label:"Name",align:"left",field:e=>e[35],format:(e,r)=>`${e} ${r[37]}`,sortable:!0},{name:2,label:"Role",align:"left",field:e=>e[44],format:e=>`${e}`,sortable:!0}],ca=ae({components:{AddUser:ua},props:{project:String},setup(e){const r=te(),d=de(),c=V(!0),m=V(!1),g=Le(),{getViewedProjects:u,updateViewedProjects:l}=ne(),{getUserType:t,userData:k}=qe(g),b=D(()=>d.params.id?d.params.id:e.project),j=D(()=>u(b.value)),o=D(()=>(j.value&&j.value.users?j.value.users:[]).sort((f,O)=>f[1].$d>O[1].$d?1:-1)),a=async v=>{if(c.value=!0,o.value.length===0||v){const{data:f}=await w.fetchFromStructureApp({fields:[pe({type:"userAccess",query:`{'9'.EX.'${b.value}'}AND{'20'.EX.true}${t.value==="Project User"&&k.value[130]!==!0?"AND{'60'.EX.false}":""}`})]});l({id:b.value,dataset:"users",data:f})}c.value=!1};function i(v){console.log(v),r.dialog({title:"Confirm",message:`Are you sure you want to remove user ${v[35]} ${v[37]}?`,cancel:!0,persistent:!0}).onOk(()=>{y(v)})}function C({user:v}){r.notify({type:"positive",message:"User successfully added!"}),m.value=!1;const f=j.value.users;f.push(v),l({id:b.value,dataset:"users",data:f})}async function y(v){const{data:f}=await w.fetchFromStructureApp({fields:[pe({type:"userAccessObject",query:`{'6'.EX.'${v[3]}'}AND{'7'.EX.'Project'}AND{'9'.EX.'${b.value}'}`})]}),O=[];f.forEach(q=>{const F={3:{value:q[3]},20:{value:!1},38:{value:!1},39:{value:!1},40:{value:!1},41:{value:!1}};O.push(F)}),w.upsertRecordsXML({to:"br598isx6",data:O,fieldsToReturn:[3]});const I=o.value.filter(q=>q[3]!==v[3]);l({id:b.value,dataset:"users",data:I}),r.notify({type:"positive",message:"User Removed"})}return a(),{projectData:j,columns:da,rows:o,initialPagination:{rowsPerPage:V(10)},showAdd:m,removeRow:i,loadData:a,loading:c,userAdded:C,userData:k}}}),pa={key:0,class:"text-caption"},ma={key:1,class:"text-caption"};function fa(e,r,d,c,m,g){const u=W("add-user");return p(),L("div",null,[e.showAdd?X("",!0):(p(),A(we,{key:0,dense:"",title:"Users","title-class":"text-primary",style:{"max-height":"600px"},columns:e.columns,rows:e.rows,"row-key":l=>l[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":n(()=>[e.$can("create","users")?(p(),A(E,{key:0,dense:"",color:"accent",label:"Add New",onClick:r[0]||(r[0]=l=>e.showAdd=!0)})):X("",!0)]),"top-right":n(()=>[s(E,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:r[1]||(r[1]=l=>e.loadData(!0))})]),header:n(l=>[s(x,{class:"bg-dark text-white",props:l},{default:n(()=>[(p(!0),L(B,null,K(l.cols,t=>(p(),A(_,{class:"text-left",key:t.name},{default:n(()=>[ue(S(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(l=>[s(x,{props:l},{default:n(()=>[(p(!0),L(B,null,K(l.cols,t=>(p(),A(ee,{key:t.name,props:l},{default:n(()=>[t.label==="Name"&&l.row[130]===!0?(p(),L("span",pa,S(`${t.value} (Not Visible to WMP Users)`),1)):(p(),L("span",ma,S(t.value),1))]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","users")?(p(),A(E,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(l.row)},null,8,["onClick"])):X("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAdd?(p(),A(u,{key:1,onUserAdded:e.userAdded,onUserCanceled:r[2]||(r[2]=l=>e.showAdd=!1),project:e.projectData},null,8,["onUserAdded","project"])):X("",!0)])}var va=oe(ca,[["render",fa]]);const ba=ae({components:{approveHeadcount:Ye},props:{project:Object},setup(e){const r=te(),d=de(),c=V(!1),m=V(!0),g=V([]),u=ne(),{getApprovedHeadcount:l}=qe(u),{getAssignments:t,fetchAssignments:k}=Be(),b=Ue(),{fetchAllProjects:j}=b,o=D(()=>d.params.id?d.params.id:e.project&&e.project[3]?e.project[3]:null),a=D(()=>[{name:0,label:"Headcount",align:"left",field:q=>q[6],format:q=>`${q}`,sortable:!0},{name:1,label:"Date",align:"left",field:q=>q[7],format:q=>`${Te.formatDate(new Date(q),"MM/DD/YYYY")}`,sortable:!0}]),i=D(()=>g.value&&g.value[0]&&g.value[0][6]?g.value[0][6]:null),C=async q=>{if(m.value=!0,q||g.value.length===0){const{data:F}=await w.fetchFromProjectsApp({fields:[{14:{value:10},9:{value:1},8:{value:`{'8'.EX.'${o.value}'}AND{'12'.EX.'TRUE'}`},7:{value:"Table Query"},6:{value:"bteqadt9j"}}]});g.value=F.sort((T,U)=>T[7].$d>U[7].$d?-1:1)}m.value=!1},y=D(()=>t(o.value)?t(o.value).filter(q=>!q[112]&&q.latest&&q[102]==="Active").length:"N/A"),v=async q=>{try{t(o.value)&&t(o.value).length===0&&await k({projectId:o.value,refresh:q})}catch(F){console.log(F)}},f=()=>{C(!0),v(!0),j({can:"read"})};function O(q){r.dialog({title:"Confirm",message:`Are you sure you want to remove Client Contracted Headcount ${q[6]}?`,cancel:!0,persistent:!0}).onOk(()=>{I(q)})}async function I(q){try{const F=[{3:{value:q[3]},6:{value:q[6]},7:{value:q[7]},8:{value:q[8]},12:{value:!1}}],{data:T}=await w.upsertRecordsXML({to:"bteqadt9j",fieldsToReturn:[3,6,7,8,12],data:F,formatObject:10});if(T&&T[0]&&T[0][3])f(),r.notify({position:"top-right",type:"positive",message:"Client Contracted Headcount successfully removed"});else throw"Error in removing Client Contracted Headcount"}catch(F){console.log(F),r.notify({position:"top-right",type:"negative",message:"Error removing Client Contracted Headcount"})}}return ve(l,()=>{f()}),C(!1),v(!1),{props:e,addHeadcount:c,loading:m,rows:g,columns:a,initialPagination:{rowsPerPage:V(10)},approvedHeadcount:i,activeHeadcount:y,refreshHeadcount:f,removeRow:O}}}),ya={class:"q-mt-xs"},ga={class:"text-body1 text-white text-uppercase"},wa={key:0,class:"q-px-xs"},$a={key:1,class:"text-caption text-dark text-italic q-px-md"},ha={class:"text-caption"};function ja(e,r,d,c,m,g){const u=W("approveHeadcount");return p(),L(B,null,[N("div",ya,[s(ce,{class:"text-dark q-pb-sm"},{default:n(()=>[s(se,{class:"bg-info q-py-sm"},{default:n(()=>[N("div",ga,[ue(" Client Contracted Headcount "),e.approvedHeadcount?(p(),L("span",wa,"("+S(e.approvedHeadcount)+")",1)):X("",!0)])]),_:1})]),_:1})]),N("div",null,[s(we,{dense:"",style:{},columns:e.columns,rows:e.rows,"row-key":l=>l[7],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{label:"Loading...","label-class":"text-info"})]),"top-left":n(()=>[N("div",null,[e.$can("create","projectHeadcount")||e.$can("manage","projects")?(p(),A(E,{key:0,dense:"",color:"accent",label:"Add New",onClick:r[0]||(r[0]=l=>e.addHeadcount=!0)})):X("",!0),e.activeHeadcount!==null?(p(),L("span",$a,"Active Headcount: "+S(e.activeHeadcount),1)):X("",!0)])]),"top-right":n(()=>[s(E,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:e.refreshHeadcount},null,8,["onClick"])]),header:n(l=>[s(x,{class:"bg-dark text-white",props:l},{default:n(()=>[(p(!0),L(B,null,K(l.cols,t=>(p(),A(_,{class:"text-left",key:t.name},{default:n(()=>[ue(S(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(l=>[s(x,{props:l},{default:n(()=>[(p(!0),L(B,null,K(l.cols,t=>(p(),A(ee,{key:t.name,props:l},{default:n(()=>[N("span",ha,S(t.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","projectHeadcount")||e.$can("manage","projects")?(p(),A(E,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(l.row)},null,8,["onClick"])):X("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"]),s(u,{project:e.props.project,modelValue:e.addHeadcount,"onUpdate:modelValue":r[1]||(r[1]=l=>e.addHeadcount=l)},null,8,["project","modelValue"])])],64)}var Ca=oe(ba,[["render",ja]]);const Na=ae({components:{DetailsCard:mt,JobNumbers:ht,PerDiem:qt,MeetingLocations:Ht,SiteContacts:_t,Users:va,ApprovedHeadcount:Ca},setup(e,{emit:r}){const d=te(),c=V(0),m=de(),{getViewedProjects:g,updateViewedProjects:u,setViewedProjects:l}=ne(),t=D(()=>g(m.params.id));(async()=>{if(!t.value){const{data:o}=await w.fetchFromProjectsApp({fields:[Z({type:"projects",id:m.params.id})]});l({id:m.params.id,data:o})}})();const b=o=>{const a=[];for(const[i,C]of Object.entries(o)){const y={fid:i,value:C};a.push(y)}u({id:t.value[3],props:a})};return{details:D(()=>t.value?[{label:"Date Created",value:Me(t.value[1].$d).format("MM/DD/YYYY hh:mm:ss a"),editable:!1},{label:"Project Name",value:t.value[20],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"input",initialValue:t.value[20],formRules:z().required().label("Project Name"),fieldLabel:"Enter the Project Name",getter:null,setter:async o=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},20:{value:o}}],fieldsToReturn:[20,43]});b(a[0]),d.notify({type:"positive",message:"Project Name successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Project Name"})}}}},{label:"Project Alias",value:t.value[44],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"input",initialValue:t.value[44],formRules:z().required().label("Project Alias"),fieldLabel:"Enter the Project Alias",getter:null,setter:async o=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},44:{value:o}}],fieldsToReturn:[44]});b(a[0]),d.notify({type:"positive",message:"Project Alias successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Project Alias"})}}}},{label:"Customer",value:t.value[25],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"options",allowNew:!0,newType:"customer",initialValue:o=>o.find(a=>a[3]===t.value[9]),formRules:J().required().label("Customer").nullable(),fieldLabel:"Customer",optionLabel:"6",displayValue:6,getter:async()=>{const{data:o}=await w.fetchFromStructureApp({fields:[pe({type:"projectCustomers",query:"{'7'.EX.'Active'}"})]});return o.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async o=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},9:{value:o[3]}}],fieldsToReturn:[9,25]});b(a[0]),d.notify({type:"positive",message:"Customer successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Customer"})}},filter:(o,a)=>o.filter(i=>i[6].toLowerCase().indexOf(a)>-1)}},{label:"Job Site",value:t.value[24],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"options",allowNew:!0,newType:"location",initialValue:o=>o.find(a=>a[3]===t.value[8]),formRules:J().required().label("Job Site").nullable(),fieldLabel:"Job Site",optionLabel:"6",displayValue:6,getter:async()=>{const{data:o}=await w.fetchFromStructureApp({fields:[pe({type:"projectLocations",query:"{'51'.EX.true}"})]});return o.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async o=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},8:{value:o[3]}}],fieldsToReturn:[8,24,43,67,69,136]});b(a[0]),d.notify({type:"positive",message:"Job Site successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Job Site"})}},filter:(o,a)=>o.filter(i=>i[6].toLowerCase().indexOf(a)>-1)}},{label:"Address",value:t.value[67]},{label:"Sup Org Manager",value:t.value[245]},{label:"Primary Hiring Center",value:t.value[76],editable:!0,config:{permission:{action:"manage",subject:"hiringCenters"},type:"options",allowNew:!1,initialValue:o=>o.find(a=>a[3]===t.value[12]),formRules:J().required().label("Primary Hiring Center").nullable(),fieldLabel:"Hiring Center",optionLabel:"60",displayValue:60,getter:async()=>{const{data:o}=await w.fetchFromStructureApp({fields:[pe({type:"hiringCenters",query:"{'51'.EX.'Active'}"})]});return o.sort((a,i)=>a[60]>i[60]?1:-1)},setter:async o=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},12:{value:o[3]}}],fieldsToReturn:[12,26,76]});b(a[0]),d.notify({type:"positive",message:"Hiring Center successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Hiring Center"})}},filter:(o,a)=>o.filter(i=>i[60].toLowerCase().indexOf(a)>-1)}},{label:"Workday Location",value:`${t.value[241]} (${t.value[242]})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:o=>o.find(a=>a[3]===t.value[240]),formRules:J().required().label("Workday Location").nullable(),fieldLabel:"Workday Location",optionLabel:o=>`${o[6]} (${o[7]})`,displayValue:6,getter:async()=>{const{data:o}=await w.fetchFromProjectsApp({fields:[Z({type:"workdayLocations",query:`{'14'.EX.true}AND{'45'.EX.'${t.value[136]}'}`})]});return o.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async o=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},240:{value:o[40]}}],fieldsToReturn:[240,241,242,257,258]});return b(a[0]),d.notify({type:"positive",message:"Workday Location successfully updated"}),!0}catch{d.notify({type:"negative",message:"Error updating Workday Location"})}},filter:(o,a)=>o.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}},{label:"Workday Region",value:`${H(t.value[283])} (${H(t.value[284])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:o=>o.find(a=>a[3]===t.value[282]),formRules:J().required().label("Workday Region").nullable(),fieldLabel:"Workday Region",optionLabel:o=>`${H(o[6])} (${o[7]})`,displayValue:6,getter:async()=>{const{data:o}=await w.fetchFromProjectsApp({fields:[Z({type:"workdayRegions",query:"{'8'.EX.true}"})]});return o.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async o=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},282:{value:o[9]}}],fieldsToReturn:[282,283,284]});b(a[0]),d.notify({type:"positive",message:"Region successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Region"})}},filter:(o,a)=>o.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}},{label:"Company",value:`${H(t.value[286])} (${H(t.value[287])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:o=>o.find(a=>a[3]===t.value[285]),formRules:J().required().label("Company").nullable(),fieldLabel:"Company",optionLabel:o=>`${H(o[6])} (${o[7]})`,displayValue:6,getter:async()=>{const{data:o}=await w.fetchFromProjectsApp({fields:[Z({type:"companies",query:`{'8'.EX.true}AND{'14'.EX.'${t.value[136]}'}`})]});return o.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async o=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},285:{value:o[10]}}],fieldsToReturn:[285,286,287]});b(a[0]),d.notify({type:"positive",message:"Company successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Company"})}},filter:(o,a)=>o.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}},{label:"Workday Branch",value:`${H(t.value[289])} (${H(t.value[290])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:o=>o.find(a=>a[3]===t.value[288]),formRules:J().required().label("Workday Branch").nullable(),fieldLabel:"Workday Branch",optionLabel:o=>`${H(o[6])} (${o[7]})`,displayValue:6,getter:async()=>{const o=t.value[264]===""?"Weekly":t.value[264],{data:a}=await w.fetchFromProjectsApp({fields:[Z({type:"workdayBranches",query:`{'8'.EX.true}AND{'9'.EX.'${o}'}AND{'16'.EX.'${t.value[136]}'}`})]});return a.sort((i,C)=>i[6]>C[6]?1:-1)},setter:async o=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},288:{value:o[12]}}],fieldsToReturn:[288,289,290]});b(a[0]),d.notify({type:"positive",message:"Branch successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Branch"})}},filter:(o,a)=>o.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}},{label:"Pay Group",value:`${H(t.value[261])} (${H(t.value[262])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:o=>o.find(a=>a[3]===t.value[260]),formRules:J().required().label("Workday Pay Group").nullable(),fieldLabel:"Workday Pay Group",optionLabel:o=>`${H(o[6])} (${o[7]})`,displayValue:6,getter:async()=>{const{data:o}=await w.fetchFromProjectsApp({fields:[Z({type:"workdayPayGroups",query:`{'8'.EX.'TRUE'}AND{'11'.EX.'Weekly'}AND{'21'.EX.'${t.value[136]}'}`})]});return o.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async o=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},260:{value:o[16]}}],fieldsToReturn:[260,261,262,263,264,272]});b(a[0]),d.notify({type:"positive",message:"Pay Group successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Pay Group"})}},filter:(o,a)=>o.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}},{label:"Supervisory Org",value:`${H(t.value[259])} (${H(t.value[244])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:o=>o.find(a=>a[3]===t.value[243]),formRules:J().required().label("Supervisory Organization").nullable(),fieldLabel:"Supervisory Organization",optionLabel:o=>`${o[42]} (${o[6]}) - ${H(o[26])}`,displayValue:42,getter:async()=>{const{data:o}=await w.fetchFromProjectsApp({fields:[Z({type:"supOrgs",query:`{'32'.EX.'Active'}AND{'44'.EX.'${t.value[272]}'}`})]});return o.sort((a,i)=>a[42]>i[42]?1:-1)},setter:async o=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},243:{value:o[16]}}],fieldsToReturn:[243,244,245,259]});b(a[0]),d.notify({type:"positive",message:"Supervisory Organization successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Supervisory Organization"})}},filter:(o,a)=>o.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[26].toLowerCase().indexOf(a)>-1||i[41].toLowerCase().indexOf(a)>-1||i[42].toLowerCase().indexOf(a)>-1)}},{label:"Cost Center",value:`${H(t.value[276])} (${H(t.value[275])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:o=>o.find(a=>a[3]===t.value[274]),formRules:J().required().label("Workday Cost Center").nullable(),fieldLabel:"Workday Cost Center",optionLabel:o=>`${H(o[6])} (${o[7]})`,displayValue:6,getter:async()=>{const{data:o}=await w.fetchFromProjectsApp({fields:[Z({type:"workdayCostCenters",query:`{'8'.EX.true}AND{'9'.EX.'${t.value[287]}'}`})]});return o.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async o=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},274:{value:o[22]}}],fieldsToReturn:[274,275,276]});b(a[0]),d.notify({type:"positive",message:"Cost Center successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Cost Center"})}},filter:(o,a)=>o.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}}]:[]),tab:c,project:t}}}),ka={class:"q-pa-sm"},Ra={class:"row"},Va={class:"col-12 col-sm-7 q-px-xs"},Aa={class:"col-12 col-sm-5 q-px-xs"};function qa(e,r,d,c,m,g){const u=W("details-card"),l=W("job-numbers"),t=W("meeting-locations"),k=W("site-contacts"),b=W("per-diem"),j=W("users"),o=W("approved-headcount");return p(),A(Oe,{style:{"max-width":"100vw"}},{default:n(()=>[N("div",ka,[N("div",Ra,[N("div",Va,[s(u,{details:e.details,title:"Details"},null,8,["details"])]),N("div",Aa,[s(De,{class:"q-py-xs bg-info text-white shadow-2 rounded-borders",align:"left",modelValue:e.tab,"onUpdate:modelValue":r[0]||(r[0]=a=>e.tab=a),dense:"","indicator-color":"accent","outside-arrows":"","mobile-arrows":"","inline-label":""},{default:n(()=>[s(he,{name:0,label:"Job Numbers"}),s(he,{name:1,label:"Locations"}),s(he,{name:2,label:"Contacts"}),s(he,{name:3,label:"Per Diem"}),s(he,{name:4,label:"Users"})]),_:1},8,["modelValue"]),s(Se,{modelValue:e.tab,"onUpdate:modelValue":r[1]||(r[1]=a=>e.tab=a),animated:"",class:"q-px-none"},{default:n(()=>[s(je,{class:"q-px-xs",name:0},{default:n(()=>[s(l)]),_:1}),s(je,{class:"q-px-xs",name:1},{default:n(()=>[s(t)]),_:1}),s(je,{class:"q-px-xs",name:2},{default:n(()=>[s(k)]),_:1}),s(je,{class:"q-px-xs",name:3},{default:n(()=>[s(b)]),_:1}),s(je,{class:"q-px-xs",name:4},{default:n(()=>[s(j)]),_:1})]),_:1},8,["modelValue"]),s(o,{project:e.project},null,8,["project"])])])])]),_:1})}var go=oe(Na,[["render",qa]]);export{go as default};
