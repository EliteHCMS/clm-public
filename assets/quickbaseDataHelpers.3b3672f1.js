import{a as fe,Q as Ce}from"./QTable.68f70e77.js";import{Q as K}from"./QTr.9c84673a.js";import{Q as X}from"./QTd.3c8ae2d8.js";import{l as te,r as m,bU as oe,c as A,w as Ve,_ as le,y as a,ap as c,bq as u,B as D,z as y,ab as j,bV as F,aq as g,d,bN as pe,aw as B,C as ye,bS as je,v as De,b4 as Z,au as Ne,F as _,b3 as x,cV as Q,bP as ee}from"./index.48ce5b72.js";import{a as ae}from"./QSelect.06d0b9ce.js";import{Q as re}from"./QInnerLoading.bb9bb1a9.js";import{u as se}from"./use-quasar.468e1258.js";import{e as Ee}from"./export-file.dc78ba05.js";import{dayjs as Y}from"./dayjs.9bb68654.js";import{u as Ae}from"./index.207f79eb.js";import{g as ne,l as M,q as J,u as be}from"./app.5e67c239.js";import{A as Pe}from"./arrivalDate.4ca1de77.js";import{Q as W}from"./QTooltip.f21cfa79.js";import{Q as ve}from"./QForm.bcdbd200.js";import{a as we,u as ge}from"./vee-validate.esm.51002094.js";import{a as G}from"./array.164cfe36.js";import{u as ie}from"./useQuerySaver.d29ff9ee.js";const Se=te({emits:["disableEdit"],props:{row:Object,rowType:String,edit:Boolean},setup(e,{emit:l}){const $=se(),h=ne(),b=m(e.edit),k=m(null),p=m(null),w=m(!0),{fetchAllJobNumbers:P}=h,{getJobNumbers:o}=oe(h),s=m(e.row[74]?e.row[74]:null);P();const n=A(()=>o.value(s.value)),S=m(M.exports.uniqBy(o.value(s.value),"11"));Ve(n,(C,f)=>{S.value=M.exports.uniqBy(o.value(s.value),"11")});const q=A(()=>G({entry:G().nullable().label("Job #")})),{errors:L,handleSubmit:I,handleReset:R}=we({validationSchema:q}),{value:N}=ge("entry"),U=I(async C=>{w.value=!0;try{const{data:f}=await J.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:p.value},182:{value:C.entry[11].trim()}}],fieldsToReturn:[144],formatObject:144});k.value=f[0][144][105],N.value=f[0][144][105],w.value=!1,$.notify({type:"positive",message:"Job # was updated!"}),b.value=!1}catch{$.notify({type:"negative",message:"There was a problem updating Job #"}),w.value=!1,b.value=!1}});return(async()=>{const C=e.row[105]===""?"":e.row[105];p.value=e.row[3],k.value=C,N.value=C,w.value=!1})(),{editField:b,entry:N,formErrors:L,submit:U,fieldValue:k,loading:w,jobNumbers:S,getJobNumbers:o,projectId:s,disableEditFunction:()=>{b.value=!1,l("disableEdit",e.row)},filterFn:(C,f)=>{if(C===""){f(()=>{S.value=M.exports.uniqBy(o.value(s.value),"11")});return}f(()=>{const V=C.toLowerCase();S.value=M.exports.uniqBy(o.value(s.value),"11").filter(H=>H[11].toLowerCase().indexOf(V)>-1)})}}}}),qe={key:0},Le={key:0},Ie={key:1},Te={key:1},Be={class:"q-pt-sm"},Re={class:"text-caption"};function Ue(e,l,$,h,b,k){return a(),c(X,{"auto-width":!e.editField,style:ye([e.editField?"min-width: 250px;":"",{"padding-left":"0px"}])},{default:u(()=>[D("div",null,[e.editField?(a(),y("div",Te,[d(ve,{onSubmit:pe(e.submit,["prevent"])},{default:u(()=>[d(ae,{outlined:"",dense:"","bg-color":"grey-2",class:"text-caption","use-input":"",behavior:e.$q.platform.is.ios===!0?"dialog":"menu",onFilter:e.filterFn,"popup-content-class":"text-caption",options:e.jobNumbers,"option-value":"11","option-label":"11","options-dense":"",modelValue:e.entry,"onUpdate:modelValue":l[2]||(l[2]=p=>e.entry=p),error:!!e.formErrors.entry},{after:u(()=>[D("div",Be,[d(F,{class:"q-mr-xs",onClick:l[1]||(l[1]=p=>e.disableEditFunction()),icon:"close",color:"secondary",dense:"",size:"sm"},{default:u(()=>[d(W,{class:"bg-secondary"},{default:u(()=>[B("Cancel")]),_:1})]),_:1}),d(F,{disable:!!e.formErrors.entry,type:"submit",onClick:e.submit,icon:"done",color:"info",dense:"",size:"sm"},{default:u(()=>[d(W,{class:"bg-info"},{default:u(()=>[B("Submit")]),_:1})]),_:1},8,["disable","onClick"])])]),error:u(()=>[D("div",Re,j(e.formErrors.entry),1)]),_:1},8,["behavior","onFilter","options","modelValue","error"])]),_:1},8,["onSubmit"])])):(a(),y("div",qe,[e.loading?(a(),y("div",Ie,[d(re,{size:"sm",showing:"",color:"primary"})])):(a(),y("div",Le,[D("span",null,j(e.fieldValue||"Not Assigned"),1),e.$can("manage","employees")?(a(),c(F,{key:0,icon:"edit",color:"accent",flat:"",size:"sm",onClick:l[0]||(l[0]=p=>e.editField=!0)})):g("",!0)]))]))])]),_:1},8,["auto-width","style"])}var ze=le(Se,[["render",Ue]]);const Qe=te({emits:["disableEdit"],props:{row:Object,rowType:String,edit:Boolean},setup(e,{emit:l}){const $=se(),h=ne(),b=m(e.edit),k=m(null),p=m(null),w=m(!0),{getUserType:P,getUser:o}=be(),{getProjects:s,getSelectedOffice:n}=oe(h),S=m(n.value?n.value[8]:null),q=m(P==="Project User"?o[3]:S),L=A(()=>s.value({userType:P,selectedId:q.value,can:"read"}).filter(f=>!0).sort((f,V)=>f[298].localeCompare(V[298]))),I=A(()=>G({entry:G().nullable().label("Project")})),{errors:R,handleSubmit:N,handleReset:U}=we({validationSchema:I}),{value:E}=ge("entry"),z=N(async f=>{w.value=!0;try{if(f.entry[3]===0||!f.entry[3]||!M.exports.isNumber(f.entry[3]))return w.value=!1,b.value=!1,!0;const{data:V}=await J.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:p.value},156:{value:f.entry[3]},204:{value:!0}}],fieldsToReturn:[144],formatObject:144});k.value=V[0][144][117],E.value=V[0][144][117],w.value=!1,$.notify({type:"positive",message:"Project was updated!"}),b.value=!1}catch{$.notify({type:"negative",message:"There was a problem updating Project"}),w.value=!1,b.value=!1}});return(async()=>{const f=e.row[117]===""?"":e.row[117];p.value=e.row[3],k.value=f,E.value=f,w.value=!1})(),{editField:b,entry:E,formErrors:R,submit:z,fieldValue:k,loading:w,options:L,disableEditFunction:()=>{b.value=!1,l("disableEdit",e.row)}}}}),Ye={key:0},Xe={key:0},Oe={key:1},Me={key:1},Je={class:"q-pt-sm"},He={class:"text-caption"};function We(e,l,$,h,b,k){return a(),c(X,{"auto-width":!e.editField,style:ye([e.editField?"min-width: 250px;":"",{"padding-left":"0px"}])},{default:u(()=>[D("div",null,[e.editField?(a(),y("div",Me,[d(ve,{onSubmit:pe(e.submit,["prevent"])},{default:u(()=>[d(ae,{outlined:"",dense:"","bg-color":"grey-2",class:"text-caption","popup-content-class":"text-caption",options:e.options,"option-label":"298","options-dense":"",modelValue:e.entry,"onUpdate:modelValue":l[2]||(l[2]=p=>e.entry=p),behavior:"menu",error:!!e.formErrors.entry},{after:u(()=>[D("div",Je,[d(F,{class:"q-mr-xs",onClick:l[1]||(l[1]=p=>e.disableEditFunction()),icon:"close",color:"secondary",dense:"",size:"sm"},{default:u(()=>[d(W,{class:"bg-secondary"},{default:u(()=>[B("Cancel")]),_:1})]),_:1}),d(F,{disable:!!e.formErrors.entry,type:"submit",onClick:e.submit,icon:"done",color:"info",dense:"",size:"sm"},{default:u(()=>[d(W,{class:"bg-info"},{default:u(()=>[B("Submit")]),_:1})]),_:1},8,["disable","onClick"])])]),error:u(()=>[D("div",He,j(e.formErrors.entry),1)]),_:1},8,["options","modelValue","error"])]),_:1},8,["onSubmit"])])):(a(),y("div",Ye,[e.loading?(a(),y("div",Oe,[d(re,{size:"sm",showing:"",color:"primary"})])):(a(),y("div",Xe,[D("span",null,j(e.fieldValue||"Not Assigned"),1),e.$can("manage","employees")?(a(),c(F,{key:0,icon:"edit",color:"accent",flat:"",size:"sm",onClick:l[0]||(l[0]=p=>e.editField=!0)})):g("",!0)]))]))])]),_:1},8,["auto-width","style"])}var Ge=le(Qe,[["render",We]]);const Ke=te({components:{ArrivalDate:Pe,JobNumber:ze,ProjectEdit:Ge},emits:["refreshData"],props:{rows:Array,filter:String,title:String},setup(e,l){const $=se(),h=je(),{can:b}=Ae(),k=ne(),{getUserType:p,getUser:w}=be(),{getProjects:P,getSelectedOffice:o,getSelectedProject:s}=oe(k),{capitalize:n}=De,S=m(!1),q=m(null),L=m(null),I=m(null),R=m(null),N=m(null),U=m(null),E=m(null),z=m(null),O=m(!1),C=m(o.value?o.value[8]:null),f=m(p==="Project User"?w[3]:C),V=A(()=>P.value({userType:p,selectedId:f.value,can:"read"}).length),H=A(()=>[{name:1,label:"Name",align:"left",field:t=>t.employee[22],format:(t,i)=>`${me(i.employee)}`,sortable:!0,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:t=>t.employee[25],format:t=>`${t}`,sortable:!1},{name:2,label:"Workday ID",align:"left",field:t=>t.employee[378],format:t=>`${t}`,sortable:!0,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:t=>t.employee[213],format:t=>t===""?"not available":t,sortable:!0},{name:4,label:"Classification",align:"left",field:t=>t[20],format:t=>`${!t||t===""?"Not Assigned":t}`,sortable:!0},{name:116,label:"Rate",align:"left",field:t=>t[116],format:t=>`${t===""||!t||t===0?"N/A":`$${Number(t).toFixed(2)}`}`,sortable:!0},{name:117,label:"Project",align:"left",field:t=>t[117],format:t=>`${t}`,sortable:!0},{name:217,label:"Location",align:"left",field:t=>t[217],format:t=>`${t}`,sortable:!0},{name:5,label:"Job #",align:"left",field:t=>t[105],format:t=>`${t===""||!t?"Not Assigned":t}`,sortable:!0},{name:145,label:"Arrival Date",align:"left",field:t=>t[145],format:t=>`${Y(t).isValid()?Y(t).format("MM/DD/YYYY"):"N/A"}`,sortable:!0}]),ue=A(()=>$.screen.gt.sm?[1,7,2,3,4,b("read","rates")?116:[],V.value>1&&O.value?117:[],s.value&&s.value[393]===!0?217:[],5,145]:[1,7,2,3,4,b("read","rates")?116:[],V.value>1&&O.value?117:[],5,145]),$e=A(()=>[...new Set(e.rows.map(t=>t[105]===""||!t[105]?"Not Assigned":t[105]))]),de=A(()=>{let t=e.rows;if(q.value&&q.value.trim().length>0){const i=q.value.trim().toLowerCase();t=t.filter(r=>r.employee&&me(r.employee).toLowerCase().includes(i))}if(L.value&&L.value.trim().length>0){const i=L.value.trim().toLowerCase();t=t.filter(r=>r.employee&&r.employee[25]&&r.employee[25].toLowerCase().includes(i))}if(I.value&&I.value.trim().length>0){const i=I.value.trim().toLowerCase();t=t.filter(r=>r.employee&&r.employee[378]&&r.employee[378].toLowerCase().includes(i))}if(R.value&&R.value.trim().length>0){const i=R.value.trim().toLowerCase();t=t.filter(r=>r.employee&&(r.employee[213]===""?"not available".includes(i):r.employee[213]&&r.employee[213].toLowerCase().includes(i)))}if(N.value&&N.value.trim().length>0){const i=N.value.trim().toLowerCase();t=t.filter(r=>!r[20]||r[20]===""?"Not Assigned".toLowerCase().includes(i):r[20]&&r[20].toLowerCase().includes(i))}if(U.value&&U.value.trim().length>0){const i=U.value.trim().toLowerCase();t=t.filter(r=>r[116]===""||!r[116]||r[116]===0?"N/A".toLowerCase().includes(i):r[116]&&"$".concat(Number(r[116]).toFixed(2).toString()).toLowerCase().includes(i))}if(E.value&&E.value.trim().length>0){const i=E.value.trim().toLowerCase();t=t.filter(r=>r[105]===""||!r[105]?"Not Assigned".toLowerCase().includes(i):r[105]&&r[105].toLowerCase().includes(i))}if(z.value&&z.value.trim().length>0){const i=Y(z.value.trim()).format("MM/DD/YYYY");t=t.filter(r=>he(r)===i)}return t}),me=t=>{const i=t[20]!==""?n(t[20].toLowerCase().trim()):"",r=t[22]!==""?n(t[22].toLowerCase().trim()):"",v=t[21]!==""?` ${n(t[21].toLowerCase().trim())}`:"",T=t[23]!==""?` ${n(t[23])}`:"";return`${r}${T}, ${i}${v}`};function ke(t){h.push({name:"ee-summary",params:{id:t[18]}})}function ce(t,i,r){let v=i!==void 0?i(t,r):t;return v=v==null?"":String(v),v=v.split('"').join('""'),`"${v}"`}function Fe(){const t=H.value.filter(v=>!!ue.value.includes(v.name)),i=[t.map(v=>ce(v.label))].concat(de.value.map(v=>t.map(T=>ce(typeof T.field=="function"?T.field(v):v[T.field===void 0?T.name:T.field],T.format,v)).join(","))).join(`\r
`);Ee(`${Y().format("MM.DD.YYYY")} Employees-Export.csv`,i,"text/csv")!==!0&&$.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}const he=t=>{const i=t[145]&&t[145].$d?t[145].$d:t[1].$d;return Y(i).format("MM/DD/YYYY")};return{columns:H,visibleColumns:ue,props:e,exportAllEmployees:Fe,viewEmployee:ke,showFilter:S,nameFilter:q,phoneNumberFilter:L,workdayIDFilter:I,payrollIDFilter:R,classificationFilter:N,rateFilter:U,jobNumberFilter:E,arrivalDateFilter:z,jobNumbers:$e,filteredRows:de,dayjs:Y,projectsAvailable:V,transferBetweenProjects:O,getUserType:p}}}),Ze={key:0},_e={key:1},xe={key:1},et={key:1},tt={key:2},ot={key:1},lt={key:3},at={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},rt={class:"text-dark text-caption text-italic"};function st(e,l,$,h,b,k){const p=Z("job-number"),w=Z("arrival-date"),P=Z("project-edit");return a(),y("div",null,[d(Ce,{title:e.title,"title-class":"text-h5 text-primary",columns:e.columns,"visible-columns":e.visibleColumns,rows:e.filteredRows,"row-key":o=>o[3],filter:e.filter?e.filter.trim():null,class:"q-pa-sm",pagination:{rowsPerPage:25},"table-header-class":"bg-dark text-white","no-data-label":"There are no employees in the roster",dense:""},Ne({header:u(o=>[d(K,{class:"bg-dark text-white",props:o},{default:u(()=>[d(fe,{"auto-width":""}),(a(!0),y(_,null,x(o.cols,s=>(a(),c(fe,{key:s.name,props:o},{default:u(()=>[B(j(s.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:u(o=>[d(K,{props:o},{default:u(()=>[d(X,{"auto-width":""},{default:u(()=>[d(ee,{class:"cursor-pointer",size:e.$q.screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:s=>e.viewEmployee(o.row),name:o.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1024),(a(!0),y(_,null,x(o.cols,s=>(a(),c(X,{key:s.name,props:o},{default:u(()=>[s.name===5?(a(),y("span",Ze,[o.row.editJobNumber?(a(),c(p,{class:"text-left",rowType:"assignment",row:o.row,key:o.row[3],edit:!0,onDisableEdit:n=>o.row.editJobNumber=!1},null,8,["row","onDisableEdit"])):g("",!0),o.row.editJobNumber?g("",!0):(a(),y("span",_e,[B(j(s.value)+" ",1),e.$can("create","employees")?(a(),c(F,{key:0,icon:"edit",color:"accent",flat:"",size:"sm",onClick:n=>o.row.editJobNumber=!0},null,8,["onClick"])):g("",!0)]))])):s.name===145?(a(),y("span",xe,[o.row.editArrivalDate?(a(),c(w,{class:"text-left",rowType:"assignment",row:o.row,key:o.row[3],edit:!0,onDisableEdit:n=>o.row.editArrivalDate=!1},null,8,["row","onDisableEdit"])):g("",!0),o.row.editArrivalDate?g("",!0):(a(),y("span",et,[B(j(s.value)+" ",1),e.$can("create","employees")?(a(),c(F,{key:0,icon:"edit",color:"accent",flat:"",size:"sm",onClick:n=>o.row.editArrivalDate=!0},null,8,["onClick"])):g("",!0)]))])):s.name===117?(a(),y("span",tt,[o.row.editProject?(a(),c(P,{class:"text-left",rowType:"assignment",row:o.row,key:o.row[3],edit:!0,onDisableEdit:n=>o.row.editProject=!1},null,8,["row","onDisableEdit"])):g("",!0),o.row.editProject?g("",!0):(a(),y("span",ot,[B(j(s.value),1),e.transferBetweenProjects&&e.$can("create","employees")?(a(),c(F,{key:0,icon:"edit",color:"accent",flat:"",size:"sm",onClick:n=>o.row.editProject=!0},null,8,["onClick"])):g("",!0)]))])):(a(),y("span",lt,j(s.value),1))]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":u(({message:o})=>[D("div",at,[d(ee,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),D("span",null,j(o),1)])]),"top-right":u(()=>[(e.projectsAvailable>1&&!e.transferBetweenProjects&&e.getUserType==="Project User"&&e.title==="Active Roster"&&e.$can("create","employees"),g("",!0)),e.projectsAvailable>1&&e.transferBetweenProjects&&e.getUserType==="Project User"?(a(),c(F,{key:1,dense:e.$q.screen.lt.md,class:"q-mr-sm",color:"primary",label:"Cancel",onClick:l[9]||(l[9]=o=>e.transferBetweenProjects=!1)},null,8,["dense"])):g("",!0),D("div",rt,"(Total: "+j(e.filteredRows.length)+" employees)",1),d(ee,{class:"q-pl-md",size:"xs",color:e.showFilter?"info":"grey-7",name:"fa-solid fa-filter",onClick:l[10]||(l[10]=o=>e.showFilter=!e.showFilter)},null,8,["color"]),d(F,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:l[11]||(l[11]=o=>e.$emit("refreshData"))}),d(F,{dense:e.$q.screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:e.exportAllEmployees,disable:e.filteredRows.length<1},null,8,["dense","onClick","disable"])]),loading:u(()=>[d(re,{showing:"",color:"primary"})]),_:2},[e.showFilter?{name:"top-row",fn:u(o=>[d(K,{props:o},{default:u(()=>[d(X,{"auto-width":""}),(a(!0),y(_,null,x(o.cols,s=>(a(),c(X,{key:s.name},{default:u(()=>[s.name===1?(a(),c(Q,{key:0,outlined:"",dense:"","bg-color":"grey-2",clearable:"","input-class":"text-caption",modelValue:e.nameFilter,"onUpdate:modelValue":l[0]||(l[0]=n=>e.nameFilter=n)},null,8,["modelValue"])):s.name===7?(a(),c(Q,{key:1,outlined:"",dense:"","bg-color":"grey-2",clearable:"","input-class":"text-caption",modelValue:e.phoneNumberFilter,"onUpdate:modelValue":l[1]||(l[1]=n=>e.phoneNumberFilter=n)},null,8,["modelValue"])):s.name===2?(a(),c(Q,{key:2,outlined:"",dense:"","bg-color":"grey-2",clearable:"","input-class":"text-caption",modelValue:e.workdayIDFilter,"onUpdate:modelValue":l[2]||(l[2]=n=>e.workdayIDFilter=n)},null,8,["modelValue"])):s.name===3?(a(),c(Q,{key:3,outlined:"",dense:"","bg-color":"grey-2",clearable:"","input-class":"text-caption",modelValue:e.payrollIDFilter,"onUpdate:modelValue":l[3]||(l[3]=n=>e.payrollIDFilter=n)},null,8,["modelValue"])):s.name===4?(a(),c(Q,{key:4,outlined:"",dense:"","bg-color":"grey-2",clearable:"","input-class":"text-caption",modelValue:e.classificationFilter,"onUpdate:modelValue":l[4]||(l[4]=n=>e.classificationFilter=n)},null,8,["modelValue"])):s.name===116?(a(),c(Q,{key:5,outlined:"",dense:"","bg-color":"grey-2",clearable:"","input-class":"text-caption",modelValue:e.rateFilter,"onUpdate:modelValue":l[5]||(l[5]=n=>e.rateFilter=n)},null,8,["modelValue"])):s.name===5?(a(),c(ae,{key:6,outlined:"",dense:"","bg-color":"grey-2",clearable:"",class:"text-caption","popup-content-class":"text-caption",options:e.jobNumbers,"options-dense":"",modelValue:e.jobNumberFilter,"onUpdate:modelValue":l[6]||(l[6]=n=>e.jobNumberFilter=n)},null,8,["options","modelValue"])):s.name===145?(a(),c(Q,{key:7,outlined:"",dense:"","bg-color":"grey-2","input-class":"text-caption",clearable:"",type:"date",modelValue:e.arrivalDateFilter,"onUpdate:modelValue":l[7]||(l[7]=n=>e.arrivalDateFilter=n)},null,8,["modelValue"])):g("",!0)]),_:2},1024))),128))]),_:2},1032,["props"])]),key:"0"}:void 0]),1032,["title","columns","visible-columns","rows","row-key","filter"])])}var Dt=le(Ke,[["render",st],["__scopeId","data-v-5b0bb12e"]]);const Nt=async e=>{const l=await nt(e),$=await it(e),h=await ut(e);return l.concat($.concat(h))},nt=async e=>{const{data:l}=await J.fetchFromHiringApp({fields:[ie({type:"inProcesses",query:`{'108'.EX.'${e}'}AND{'37'.EX.'In Process'}AND{'38'.EX.'4'}`})]});return l},it=async e=>{const{data:l}=await J.fetchFromHiringApp({fields:[ie({type:"dispatches",query:`{'157'.EX.'${e}'}AND{'24'.EX.'5'}AND{'17'.EX.'In Process'}`})]});return l},ut=async e=>{const{data:l}=await J.fetchFromHiringApp({fields:[ie({type:"deployments",query:`{'134'.EX.'${e}'}ANDAND({'33'.OAF.'today'}OR{'33'.IR.'last 10 d'})AND({'20'.EX.'In Process'}OR{'20'.EX.'Complete'})AND{'128'.EX.'Yes'}AND({'27'.EX.'6'}OR{'27'.EX.'7'})`})]});return l};export{Dt as R,Nt as g};
