import{bX as z,B as W,as as X,bt as i,E as t,d as s,cV as G,bQ as O,aa as e,cW as Q,b as d,ae as p,cX as _,bS as Y,az as H,cY as J,bY as U}from"./index.960d5b34.js";import{a as k}from"./QSelect.ce23f885.js";import{Q as K}from"./QTooltip.7454b396.js";import{Q as Z}from"./QFile.34da3c46.js";import{Q as ee}from"./QSpinnerGears.4fd5f8fe.js";import{Q as te}from"./QForm.f3e65354.js";import{Q as oe}from"./QPage.8d15663e.js";import{a as le,u as c}from"./vee-validate.esm.d4095220.js";import{a as R,c as u}from"./array.164cfe36.js";import{u as ae,b as se,q as ie}from"./app.bda2cd70.js";import{u as re}from"./use-quasar.09536e80.js";import"./QChip.e4d2f168.js";import"./QMenu.dd57348b.js";import"./position-engine.40859e34.js";import"./selection.4cab378b.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./dayjs.501e8a8e.js";import"./localForage.84a30b23.js";import"./index.04bc0a32.js";import"./i18n.2abc02f2.js";const ne={class:"row justify-center q-pt-sm"},de={class:"col-12 col-md-8"},ce=t("div",{class:"text-h5 text-dark"},"Request Support",-1),ue=t("div",{class:"text-primary text-h6 q-mb-sm"},"Support Details",-1),me={class:"row"},pe={class:"col-12 col-md-6 q-pr-md"},be={class:"text-caption"},ge={class:"col-12 col-md-6 q-pr-md"},_e={class:"text-caption"},fe={class:"row"},he={class:"col-12 q-pr-md"},qe={class:"text-caption q-pt-none"},ve={class:"row"},ye={class:"col-12 q-pr-md"},Ve={class:"text-caption"},xe={class:"row"},Fe={class:"col-12 col-md-8 q-pr-md"},Pe=t("div",{class:"text-primary text-h6 q-mb-sm"},"Contact Information",-1),Se={class:"row"},we={class:"col-12 col-md-8 q-pr-md"},Qe={class:"text-caption"},Ce={class:"row"},Ee={class:"col-12 col-md-6 q-pr-md"},Ue={class:"text-caption"},ke={class:"col-12 col-md-6 q-pr-md"},Re={class:"text-caption"},je={class:"row"},Te={class:"col-12 q-pr-md"},at={__name:"index",setup(Ae){const C=re(),j=ae(),{userData:b,fullName:f}=z(j),{userType:T}=se(),A=b.value&&b.value[8]?b.value[8]:"",h=b.value&&b.value[6]?b.value[6]:"",B=[...h===""?["Personal Login Issues"]:[],"General Help","Data Updates & System Maintenance","Reporting","Security","Integration Maintenance/Failure","Bug",...h!==""?["Personal Login Issues"]:[]],M=["Worksite Management Portal","Craft Employee Management"],D=R({type:u().required().label("Type"),category:u().required().label("Category"),subject:u().required().label("Subject"),details:u().required().label("Details"),supportingFile:R().nullable().label("Supporting File"),requestedFor:u().required().label("Requested For"),contactPhone:u().matches(/^[+()0-9 .-]+$/,{excludeEmptyString:!0,message:"Valid Phone Number Only!"}).required().label("Contact Phone"),contactEmail:u().email().required().label("Contact Email"),additionalPeople:u().nullable().label("Additional People Affected")}),{errors:r,handleSubmit:I,handleReset:N,isSubmitting:n}=le({validationSchema:D,initialValues:{type:"",category:T==="QuickBase User"?"Craft Employee Management":"Worksite Management Portal",requestedFor:f.value?f.value.includes("undefined")?"":f.value:"",contactPhone:A,contactEmail:h}}),{value:q}=c("type"),{value:v}=c("category"),{value:y}=c("subject"),{value:V}=c("details"),{value:x}=c("supportingFile"),{value:F}=c("requestedFor"),{value:P}=c("contactPhone"),{value:S}=c("contactEmail"),{value:w}=c("additionalPeople"),L=o=>new Promise((l,a)=>{const g=new FileReader;g.readAsDataURL(o),g.onload=()=>l(g.result.replace(/^data:.+;base64,/,"")),g.onerror=m=>a(m)}),$=I(async o=>{try{o.details=o.details?o.details.replace(/(\r\n|\n|\r)/gm," "):null,o.additionalPeople=o.additionalPeople?o.additionalPeople.replace(/(\r\n|\n|\r)/gm," "):null;const l=o.supportingFile&&o.supportingFile[0]?await L(o.supportingFile[0]):null,a=o.supportingFile&&o.supportingFile[0]?o.supportingFile[0].name:null,g=[{7:{value:o.type},8:{value:o.category},6:{value:o.subject},10:{value:o.details},11:{value:l,filename:a},19:{value:o.requestedFor},21:{value:o.contactPhone},22:{value:o.contactEmail},23:{value:o.additionalPeople?o.additionalPeople:""}}],{data:m}=await ie.upsertRecordsXML({to:"btb8bh2ki",fieldsToReturn:[32],data:g,formatObject:32});if(m&&m[0]&&m[0][32]&&m[0][32][3])C.notify({position:"top-right",type:"positive",message:`Support Request ${m[0][32][3]} successfully added`});else throw"Error in adding support request";E()}catch(l){console.log(l),C.notify({position:"top-right",type:"negative",message:"There was a problem submitting request!"})}}),E=()=>{N()};return(o,l)=>(W(),X(oe,{style:{"max-width":"100vw","max-height":"100vh"}},{default:i(()=>[t("div",ne,[t("div",de,[s(G,{flat:""},{default:i(()=>[s(te,{onSubmit:O(e($),["prevent"])},{default:i(()=>[s(Q,{class:"q-pb-lg"},{default:i(()=>[ce]),_:1}),s(Q,{class:"q-pl-lg q-pt-none"},{default:i(()=>[ue,t("div",me,[t("div",pe,[s(k,{class:"q-mb-md",dense:"",outlined:"",label:"Type","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e(q),"onUpdate:modelValue":l[0]||(l[0]=a=>d(q)?q.value=a:null),options:B,"bottom-slots":"",error:!!e(r).type,disable:e(n)},{error:i(()=>[t("div",be,p(e(r).type),1)]),_:1},8,["modelValue","error","disable"])]),t("div",ge,[s(k,{class:"q-mb-md",dense:"",outlined:"",label:"App","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e(v),"onUpdate:modelValue":l[1]||(l[1]=a=>d(v)?v.value=a:null),options:M,"bottom-slots":"",error:!!e(r).category,disable:e(n)},{error:i(()=>[t("div",_e,p(e(r).category),1)]),_:1},8,["modelValue","error","disable"])])]),t("div",fe,[t("div",he,[s(_,{class:"q-mb-md",dense:"",outlined:"",maxlength:"100",label:"Subject",modelValue:e(y),"onUpdate:modelValue":l[2]||(l[2]=a=>d(y)?y.value=a:null),"bottom-slots":"",error:!!e(r).subject,disable:e(n)},{error:i(()=>[t("div",qe,p(e(r).subject),1)]),_:1},8,["modelValue","error","disable"])])]),t("div",ve,[t("div",ye,[s(_,{class:"q-mb-md",dense:"",outlined:"","input-style":"resize: none",maxlength:"2500",type:"textarea",modelValue:e(V),"onUpdate:modelValue":l[3]||(l[3]=a=>d(V)?V.value=a:null),label:"Details","bottom-slots":"",error:!!e(r).details,disable:e(n)},{error:i(()=>[t("div",Ve,p(e(r).details),1)]),_:1},8,["modelValue","error","disable"])])]),t("div",xe,[t("div",Fe,[s(Z,{dense:"",outlined:"","bottom-slots":"",modelValue:e(x),"onUpdate:modelValue":l[4]||(l[4]=a=>d(x)?x.value=a:null),multiple:"",append:"","max-files":"1","use-chips":"",label:"Supporting File",disable:e(n)},{prepend:i(()=>[s(Y,{name:"attach_file"},{default:i(()=>[s(K,null,{default:i(()=>[H("Click in the box to add supporting file")]),_:1})]),_:1})]),_:1},8,["modelValue","disable"])])])]),_:1}),s(Q,{class:"q-pl-lg q-pt-none"},{default:i(()=>[Pe,t("div",Se,[t("div",we,[s(_,{class:"q-mb-md",dense:"",outlined:"",maxlength:"100",label:"Requested For",modelValue:e(F),"onUpdate:modelValue":l[5]||(l[5]=a=>d(F)?F.value=a:null),error:!!e(r).requestedFor,"bottom-slots":"",disable:e(n)},{error:i(()=>[t("div",Qe,p(e(r).requestedFor),1)]),_:1},8,["modelValue","error","disable"])])]),t("div",Ce,[t("div",Ee,[s(_,{class:"q-mb-md",dense:"",outlined:"",maxlength:"15",label:"Contact Phone",modelValue:e(P),"onUpdate:modelValue":l[6]||(l[6]=a=>d(P)?P.value=a:null),error:!!e(r).contactPhone,"bottom-slots":"",disable:e(n)},{error:i(()=>[t("div",Ue,p(e(r).contactPhone),1)]),_:1},8,["modelValue","error","disable"])]),t("div",ke,[s(_,{class:"q-mb-md",dense:"",outlined:"",maxlength:"100",label:"Contact Email",modelValue:e(S),"onUpdate:modelValue":l[7]||(l[7]=a=>d(S)?S.value=a:null),error:!!e(r).contactEmail,"bottom-slots":"",disable:e(n)},{error:i(()=>[t("div",Re,p(e(r).contactEmail),1)]),_:1},8,["modelValue","error","disable"])])]),t("div",je,[t("div",Te,[s(_,{dense:"",outlined:"","input-style":"resize: none",maxlength:"2500",type:"textarea",modelValue:e(w),"onUpdate:modelValue":l[8]||(l[8]=a=>d(w)?w.value=a:null),label:"Additional People Affected",disable:e(n)},null,8,["modelValue","disable"])])])]),_:1}),s(J,{class:"q-pl-lg q-py-lg",align:"right"},{default:i(()=>[s(U,{loading:e(n),disable:e(n),color:"primary",label:"Save & Close",type:"submit"},{loading:i(()=>[s(ee)]),_:1},8,["loading","disable"]),s(U,{class:"q-mr-lg",color:"secondary",label:"Cancel",onClick:E})]),_:1})]),_:1},8,["onSubmit"])]),_:1})])])]),_:1}))}};export{at as default};
