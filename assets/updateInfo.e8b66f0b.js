import{Q as he}from"./QImg.d809cf38.js";import{_ as le,a5 as H,r as v,c as oe,w as B,B as t,C as _,d as y,bs as g,as as r,ay as ee,ad as F,cV as V,bP as ue,bO as re,ar as R,cW as se,a9 as f,b as ae,bX as ie,E as U,b2 as ge,b0 as be,bV as ye,bU as _e,cU as qe,H as Ne,bR as xe,cX as we}from"./index.2e7fe8e8.js";import{Q as ne}from"./QForm.8dd8e189.js";import{Q as $e}from"./QPage.b37a2af4.js";import{u as de}from"./use-quasar.40d4c05b.js";import{u as G,a as ke}from"./vee-validate.esm.f0f46958.js";import{u as Ce}from"./i18n.2ffb039e.js";import{u as ce,q as Q,i as me,b as Ie}from"./app.1914f476.js";import{_ as Se}from"./languageSelector.1f51c99c.js";import{p as Ee}from"./VueTelInput.6d26c085.js";import{c as E,a as J}from"./array.59f93f43.js";import{dayjs as L}from"./dayjs.d259e186.js";import{c as Re}from"./carousel.ed3f70f7.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.efbf8f90.js";import"./api.15b844fb.js";import"./index.04bc0a32.js";import"./QSelect.63d8c041.js";import"./QChip.1e62c9f1.js";import"./QMenu.aa89615f.js";import"./position-engine.fae1bc72.js";import"./selection.87b1e79a.js";import"./rtl.b51694b1.js";import"./use-panel.3430e8b4.js";import"./touch.3df10340.js";import"./use-fullscreen.a6d76165.js";const ve=j=>(ge("data-v-6bed7e94"),j=j(),be(),j),Ue={key:0,class:"text-dark"},De={key:1,class:"text-dark"},Me={key:2,class:"text-dark"},Ve={key:3,class:"text-dark"},Pe={key:4,class:"text-dark"},Qe=ve(()=>U("br",null,null,-1)),je={key:5,class:"text-dark"},Ae=ve(()=>U("br",null,null,-1)),Oe={key:2,class:"text-grey-6 text-right"},Te={key:3,class:"text-grey-6 text-right"},Le={__name:"codeComponent",props:{phoneNumber:String,email:String,type:String,rid:String},emits:["verified"],setup(j,{emit:k}){const D=j,M=de(),q=ce(),C=H(D,"phoneNumber"),e=H(D,"email"),a=H(D,"type"),l=v("code-confirmation"),b=v(Math.floor(1e5+Math.random()*9e5)),s=v(null),h=v(!1),i=v(!1),n=v(!1),p=v(0),c=H(D,"rid"),{value:I}=G("codeConfirmation",E().matches(/^[0-9]{6}/g,{excludeEmptyString:!0,message:"Code Not Valid!"}).required().oneOf([b.value],"Code Not Valid!")),te=oe(()=>I.value===b.value),K=d=>{const o=Math.floor(d/6e4),m=(d%6e4/1e3).toFixed(0);return o+":"+(m<10?"0":"")+m};B(a,d=>{b.value=null,I.value=null,h.value=!1,b.value=null,s.value=null,l.value="code-confirmation"}),B(p,d=>{d===0?(h.value=!0,b.value=null,s.value=null):h.value=!1}),B(I,async d=>{Number(d)===b.value&&(M.notify({position:"top-right",type:"positive",message:"Code Verified!"}),a.value==="phone-number"?W():a.value==="email"&&z())});const w=async()=>{n.value=!0,l.value==="code-confirmation"?(b.value=Math.floor(1e5+Math.random()*9e5),I.value=null,s.value=L().add(5,"minute").toISOString(),a.value==="phone-number"?(await me.sendMessage({data:{body:`Your Brandsafway Verification Code is: ${b.value}`,to:C.value,messagingServiceSid:"MGd0e31773980318b7cdc5d2043117e27c",direction:"outbound-api",twilioMessage:!0}}),n.value=!1,M.notify({position:"top-right",type:"info",message:"Text message sent!"}),s.value=L().add(1,"minute")):a.value==="email"&&(await O(),n.value=!1,M.notify({position:"top-right",type:"info",message:"Email sent!"}),s.value=L().add(2,"minute")),n.value=!1,N(),l.value="code-sent"):n.value=!1},N=()=>{const d=setInterval(()=>{p.value=L(s.value).valueOf()-L().valueOf(),p.value<=0&&(p.value=0,clearInterval(d))},1e3)},O=async()=>{if(!c.value||c.value==="")return!1;const d=await Q.isUserLoggedIn(),o=new Date;b.value||(b.value=Math.floor(1e5+Math.random()*9e5));const m={3:{value:c.value},26:{value:o},87:{value:o},88:{value:b.value},47:{value:!0}};try{return d?await Q.updateUserData({fields:m}):await Q.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:[m],formatObject:76})}catch(T){M.notify({position:"top-right",type:"negative",message:T.message||"Error updating Verification!"})}},W=async()=>{if(i.value=!0,!c.value||c.value==="")return i.value=!1,!1;const d=new Date,o={3:{value:c.value},26:{value:d},50:{value:!0}};try{await Q.updateUserData({fields:o}),i.value=!1,k("verified")}catch(m){i.value=!1,M.notify({position:"top-right",type:"negative",message:m.message||"Error updating Verification!"})}},z=async()=>{if(i.value=!0,!c.value||c.value==="")return i.value=!1,!1;const d=new Date,o={3:{value:c.value},26:{value:d},49:{value:!0}};try{await Q.updateUserData({fields:o}),i.value=!1,k("verified")}catch(m){i.value=!1,M.notify({position:"top-right",type:"negative",message:m.message||"Error updating Verification!"})}},$=()=>C.value.replace(/(\d{3})(\d{3})(\d{4})/,"******$3"),X=()=>(q.userLoggedIn?q.user[34]:e.value||"").replace(/(.{2})(.*)(?=@)/,function(o,m,T){for(let Y=0;Y<T.length;Y++)m+="*";return m});return B(()=>D.phoneNumber,()=>{console.log(D)}),(d,o)=>(t(),_("div",null,[y(V,{class:"text-center auth-description"},{default:g(()=>[l.value==="code-sent"&&a.value==="phone-number"?(t(),_("p",Ue,"A text message with a verification code has been sent to your phone.")):r("",!0),l.value==="code-sent"&&a.value==="email"?(t(),_("p",De,"A verification code has been sent to your email. ")):r("",!0),l.value==="code-confirmation"&&a.value==="phone-number"?(t(),_("p",Me,"Your Phone Number needs to be verified click the button below to verify.")):r("",!0),l.value==="code-confirmation"&&a.value==="email"?(t(),_("p",Ve,"Your Email needs to be verified click the button below to verify.")):r("",!0),l.value==="code-confirmation"&&a.value==="phone-number"?(t(),_("p",Pe,[Qe,ee(F($()),1)])):r("",!0),l.value==="code-confirmation"&&a.value==="email"?(t(),_("p",je,[Ae,ee(F(X()),1)])):r("",!0)]),_:1}),y(V,null,{default:g(()=>[y(ne,{class:"q-px-sm q-pt-sm",onSubmit:o[3]||(o[3]=ue(()=>{},["prevent"])),onKeyup:re(w,["enter"])},{default:g(()=>[l.value==="code-sent"?(t(),R(se,{key:0,class:"col-xs-12 col-sm-6 q-pb-md",clearable:!i.value,outlined:"",disable:h.value,loading:i.value,modelValue:f(I),"onUpdate:modelValue":o[0]||(o[0]=m=>ae(I)?I.value=m:null),type:"text",autocomplete:"one-time-code",inputmode:"numeric",pattern:"[0-9]*",label:"Code",tabindex:"1",maxlength:"6",minlength:"6",name:"codeConfirmation",error:!!te.value,"error-message":"Code does not match!"},{append:g(()=>[ee(F(K(p.value))+"\xA0 ",1)]),_:1},8,["clearable","disable","loading","modelValue","error"])):r("",!0),l.value==="code-confirmation"?(t(),R(ie,{key:1,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:"Send Code",tabindex:"1",loading:n.value,onClick:w},null,8,["loading"])):r("",!0),a.value==="phone-number"&&e.value!==""?(t(),_("p",Oe,[U("a",{href:"javascript:void(0);",onClick:o[1]||(o[1]=m=>a.value="email")},"Use Email")])):r("",!0),a.value==="email"&&C.value!==""?(t(),_("p",Te,[U("a",{href:"javascript:void(0);",onClick:o[2]||(o[2]=m=>a.value="phone-number")},"Use Phone Number")])):r("",!0),l.value==="code-sent"?(t(),R(V,{key:4,class:"q-py-none row justify-center"},{default:g(()=>[p.value===0?(t(),_("a",{key:0,onClick:w,class:"text-grey-6",href:"javascript:void(0);",tabindex:"2"},"Resend Code")):r("",!0)]),_:1})):r("",!0)]),_:1},8,["onKeyup"])]),_:1})]))}};var Be=le(Le,[["__scopeId","data-v-6bed7e94"]]);const Fe={key:0,class:"col-md-7 col-lg-8 col-lx-8"},Ke={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},ze={class:"text-dark"},Xe={key:0,class:"row q-col-gutter-xs"},Ye={key:1,class:"row q-col-gutter-xs"},He={class:"text-grey-6"},Je={class:"row justify-center"},Ge={__name:"updateInfo",setup(j){const k=de(),D=ce(),{currentUserType:M}=Ie(),q=ye(),C=_e(),{t:e}=Ce(),a=v(!1),l=v("update-information"),b=v(10),s=v(!1),h=v(!1),i=v(null),n=v(null),p=v(!1),c=v(!1),I=oe(()=>{const u=new RegExp("^[0-9]{"+b.value+"}","g");return h.value&&s.value?J({email:E().email(`${e("validEmailIsRequired")}`).required().label(`${e("email")}`),phoneNumber:E().matches(u,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).required().label(`${e("phoneNumber")}`)}):h.value&&!s.value?J({email:E().email(`${e("validEmailIsRequired")}`).required().label(`${e("email")}`),phoneNumber:E().matches(u,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).label(`${e("phoneNumber")}`)}):!h.value&&s.value?J({email:E().email(`${e("validEmailIsRequired")}`).label(`${e("email")}`),phoneNumber:E().matches(u,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).required().label(`${e("phoneNumber")}`)}):J({email:E().email(`${e("validEmailIsRequired")}`).required().label(`${e("email")}`),phoneNumber:E().matches(u,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).required().label(`${e("phoneNumber")}`)})}),{errors:te,meta:K}=ke({validationSchema:I,initialValues:{phoneNumber:"",email:""}}),{value:w}=G("userRID"),{value:N,errorMessage:O,setErrors:W,meta:z}=G("phoneNumber"),{value:$,errorMessage:X,setErrors:d,meta:o}=G("email");v(!0),q.query.rid?(w.value=q.query.rid,q.query.emailRequired&&(h.value=!0),q.query.phoneNumberRequired&&(s.value=!0),C.replace({query:{}})):C.push("/"),B(()=>q.query,()=>{q.query.rid&&(w.value=q.query.rid,q.query.emailRequired&&(h.value=!0),q.query.phoneNumberRequired&&(s.value=!0),C.replace({query:{}}))});const m=u=>{b.value=u},T=u=>{i.value=u},Y=()=>{D.logout().then(()=>{C.replace({name:"login"})})},Z=async()=>{if(a.value=!0,!K.value.valid)return a.value=!1,!1;if(!w.value||w.value==="")return a.value=!0,!1;const u=new Date;let x={phoneNumber:"N/A",name:"United States",iso2:"US",dialCode:"1",iso2sm:"us",callerName:null,countryCode:"US",nationalFormat:"N/A",carrier:null,validPhoneNumber:!1};if(s.value){const A={data:{phoneNumber:N.value,type:"phoneNumber"}},S=await me.createContact(A);if(S.data&&(n.value=S.data.validation,S.data.valid===!0?(N.e164=S.data.phoneNumber,n.value.validPhoneNumber=!0,delete n.value.url,delete n.value.price,delete n.value.phoneNumber,delete n.value.addOns):n.value.validPhoneNumber=!1),n.value&&n.value.validPhoneNumber===!1)return W(`${e("validPhoneIsRequired")}`),k.notify({type:"negative",message:`${e("validPhoneIsRequired")}`,timeout:7e3,position:k.screen.lt.md?"top":"top-right"}),a.value=!1,null;x=Object.assign({phoneNumber:N.value},i.value,n.value||{})}if(h.value&&$.value===""&&n.value&&n.value.validPhoneNumber===!1)return d(`${e("validEmailIsRequired")}`),k.notify({type:"negative",message:`${e("validEmailIsRequired")}`,timeout:7e3,position:k.screen.lt.md?"top":"top-right"}),a.value=!1,null;const P={...s.value&&{8:{value:`+${i.value?i.value.dialCode:"1"}${N.value}`}},...s.value&&{9:{value:JSON.stringify(x)}},...s.value&&{111:{value:!1}},...h.value&&{6:{value:$.value}},...h.value&&{112:{value:!1}},26:{value:u}};try{await Q.updateUserData({fields:P}),a.value=!1,C.push({path:"/",query:{rid:w.value,...s.value&&{phoneNumber:`+${i.value?i.value.dialCode:"1"}${N.value}`},...h.value&&{email:$.value}}})}catch(A){c.value=!1,p.value=!1,A.lineErrors&&A.lineErrors.forEach(S=>{S.includes('is not unique for unique formula field with ID "27"')&&(c.value=!0),S.includes('The field named "uniqueEmail" with field id 27 requires a unique value.')&&(c.value=!0),S.includes('is not unique for unique formula field with ID "28"')&&(p.value=!0),S.includes('The field named "uniquePhoneNumber" with field id 28 requires a unique value.')&&(p.value=!0)}),p.value||c.value?l.value="code-confirmation":k.notify({position:"top-right",type:"negative",message:A.message||"Error updating Information!"})}},pe=async()=>{try{const u=new Date,x={phoneNumber:"N/A",name:"United States",iso2:"US",dialCode:"1",iso2sm:"us",callerName:null,countryCode:"US",nationalFormat:"N/A",carrier:null,validPhoneNumber:!1},P=[{...p.value&&{8:{value:""}},...p.value&&{9:{value:JSON.stringify(x)}},...p.value&&{50:{value:!1}},...p.value&&{111:{value:!0}},26:{value:u},...c.value&&{6:{value:""}},...c.value&&{49:{value:!1}},...c.value&&{112:{value:!0}}}];return await Q.findAndUpdateUser({...p.value&&{phoneNumber:`+${i.value?i.value.dialCode:"1"}${N.value}`},...c.value&&{email:$.value},userType:M,fields:P})}catch(u){console.log(u)}},fe=async()=>{l.value="update-information",await pe(),await Z()};return(u,x)=>(t(),R($e,{class:"window-height window-width row"},{default:g(()=>[f(k).screen.lt.md?r("",!0):(t(),_("div",Fe,[y(Re)])),U("div",Ke,[y(qe,{class:"auth-card",flat:""},{default:g(()=>[y(V,{style:{"padding-left":"30px","padding-right":"30px"}},{default:g(()=>[y(he,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),l.value==="update-information"?(t(),R(V,{key:0,class:"text-center auth-description"},{default:g(()=>[U("p",ze,F(u.$t("pleaseUpdateInformation")),1)]),_:1})):r("",!0),l.value==="update-information"?(t(),R(V,{key:1},{default:g(()=>[y(ne,{class:"q-px-sm q-pt-sm",onSubmit:x[2]||(x[2]=ue(()=>{},["prevent"])),onKeyup:re(Z,["enter"])},{default:g(()=>[s.value?(t(),_("div",Xe,[y(Ee,{name:"phoneNumber",class:Ne(["col-xs-12 col-sm-12",{"q-pb-lg":f(O)&&f(z).validated}]),outlined:"",modelValue:f(N),"onUpdate:modelValue":x[0]||(x[0]=P=>ae(N)?N.value=P:null),label:u.$t("phoneNumber"),tabindex:"3",onMaxLengthChanged:m,error:!!(f(O)&&f(z).validated),"error-message":f(O),onCountryChanged:T},null,8,["class","modelValue","label","error","error-message"])])):r("",!0),h.value?(t(),_("div",Ye,[y(se,{class:"col-xs-12 col-sm-12 q-pb-lg",clearable:"",outlined:"",modelValue:f($),"onUpdate:modelValue":x[1]||(x[1]=P=>ae($)?$.value=P:null),type:"email",autocomplete:"email",label:u.$t("email"),tabindex:"4",name:"email",error:!!(f(X)&&f(o).validated),"error-message":f(X)},{prepend:g(()=>[y(xe,{name:"email"})]),_:1},8,["modelValue","label","error","error-message"])])):r("",!0)]),_:1},8,["onKeyup"])]),_:1})):r("",!0),l.value==="code-confirmation"?(t(),R(Be,{key:2,onVerified:fe,phoneNumber:f(N),email:f($),type:s.value?"phone-number":"email",rid:f(w)},null,8,["phoneNumber","email","type","rid"])):r("",!0),l.value==="update-information"?(t(),R(we,{key:3,class:"q-px-lg"},{default:g(()=>[l.value==="update-information"?(t(),R(ie,{key:0,ref:"confirm",loading:a.value,disable:!f(K).valid,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:u.$t("confirm"),tabindex:"3",onClick:Z},null,8,["loading","disable","label"])):r("",!0)]),_:1})):r("",!0),y(V,{class:"text-center q-pa-sm"},{default:g(()=>[U("p",He,[U("a",{onClick:Y,class:"text-grey-6",href:"javascript:void(0);",tabindex:"4"},F(u.$t("logout")),1)])]),_:1}),y(V,{class:"q-pl-lg q-pa-sm"},{default:g(()=>[U("div",Je,[y(Se,{dense:"",borderless:""})])]),_:1})]),_:1})])]),_:1}))}};var wa=le(Ge,[["__scopeId","data-v-05f233d3"]]);export{wa as default};
