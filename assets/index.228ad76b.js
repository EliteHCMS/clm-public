import{Q as G,a as _e,b as J}from"./QTabPanels.f08604ff.js";import{Q as he}from"./QTabs.c48e8512.js";import{Q as De}from"./QToolbar.7df6568a.js";import{Q as qe}from"./QPage.eef4aa2f.js";import{bT as L,bS as ne,r as v,bU as ee,c as w,w as Z,y as A,z as C,d as l,bq as i,cU as F,B as u,a7 as X,aq as O,cV as z,cT as ae,o as Ve,bP as ce,ab as re,bV as me,v as Pe,aw as je,ap as K}from"./index.48ce5b72.js";import{a as pe}from"./QSelect.06d0b9ce.js";import{u as te}from"./use-quasar.468e1258.js";import{u as ie}from"./dataStore.e8d02f93.js";import{u as ue}from"./dataStore.dbb6cf0f.js";import{g as le,q as ve,u as Ae,i as fe}from"./app.5e67c239.js";import{dayjs as V}from"./dayjs.9bb68654.js";import{u as be}from"./useQuerySaver.d29ff9ee.js";import{R as ge,g as xe}from"./quickbaseDataHelpers.3b3672f1.js";import{_ as se}from"./projectSelector.c3a9b73c.js";import{Q as Se}from"./QTd.3c8ae2d8.js";import{Q as Ye}from"./QInnerLoading.bb9bb1a9.js";import{Q as Re}from"./QTable.68f70e77.js";import{e as ke}from"./export-file.dc78ba05.js";import{P as Qe}from"./projectPipeline.6ffa13ce.js";import"./use-panel.a2490dda.js";import"./touch.3df10340.js";import"./selection.e8d17b8a.js";import"./QResizeObserver.903c6b28.js";import"./rtl.b51694b1.js";import"./QChip.d193a000.js";import"./QMenu.62e1eee7.js";import"./position-engine.a6f346a0.js";import"./localForage.a179cfc1.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.04bc0a32.js";import"./i18n.0c36ad49.js";import"./QTr.9c84673a.js";import"./index.207f79eb.js";import"./arrivalDate.4ca1de77.js";import"./QTooltip.f21cfa79.js";import"./QForm.bcdbd200.js";import"./vee-validate.esm.51002094.js";import"./array.164cfe36.js";import"./QList.1735c3ac.js";import"./QMarkupTable.5a189cd0.js";import"./use-fullscreen.735db5b1.js";const Ie={class:"row items-center"},Me={key:0,class:"col-12 col-md-3"},Ne={class:"col-12 col-md-3 q-px-sm"},Ce={class:"col-12 col-md-3 q-px-sm"},Te={class:"col-12 col-md-3 q-px-sm"},Ue={__name:"roster",setup(H){const b=te(),r=L(),m=ne(),h=le(),f=v(""),D=v(null),q=v(null),{getSelectedProject:_}=ee(h),{getAssignments:x,fetchAllAssignments:M,fetchAssignments:N}=ie(),{getManpowerData:Y,setRosters:T}=ue(),n=w(()=>r.params.id?r.params.id:null),g=w(()=>_.value?_.value[3]:null);if(r.query){const t=Object.assign({},r.query);delete t.tab,m.replace({query:t})}const P=w(()=>{let t;return n.value?t=(Y({dataset:"rosters",id:n.value})||[]).sort((s,Q)=>s[1].$d<Q[1].$d?1:-1):t=x(g.value).sort((a,s)=>a[1].$d<s[1].$d?1:-1),t.filter(a=>!a[112]&&a.latest&&a[102]==="Active")}),S=w(()=>{let t=P.value;return t=D.value?t.filter(a=>V(a[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===V(D.value).tz("America/Chicago").format("MM/DD/YYYY")):t,t=q.value?t.filter(a=>a[68]===q.value):t,t.sort((a,s)=>a.employee[22]>s.employee[22]?1:-1)}),R=w(()=>[...new Map(P.value.map(t=>[t[68],t[68]])).values()]),d=async t=>{b.loading.show(),r.query&&r.query.refresh&&(t=!0,m.push({query:{}})),n.value?(t||!Y({dataset:"rosters",id:n.value}))&&await k():g.value?await N({projectId:g.value,refresh:t}):await M({refresh:t}),b.loading.hide()},k=async()=>{const t=`{'173'.EX.'${n.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:a}=await ve.fetchFromHiringApp({fields:[be({type:"assignments",query:t})]});T({id:n.value,data:a})};return Z(g,()=>{d()}),d(),(t,a)=>(A(),C("div",null,[l(ae,{flat:""},{default:i(()=>[l(F,null,{default:i(()=>[u("div",Ie,[X(r).params.id?O("",!0):(A(),C("div",Me,[l(se,{dense:""})])),u("div",Ne,[l(z,{dense:"",modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=s=>f.value=s),label:"Search"},null,8,["modelValue"])]),u("div",Ce,[l(z,{dense:"",modelValue:D.value,"onUpdate:modelValue":a[1]||(a[1]=s=>D.value=s),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),u("div",Te,[l(pe,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:q.value,"onUpdate:modelValue":a[2]||(a[2]=s=>q.value=s),options:R.value,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),l(ge,{rows:S.value,onRefreshData:a[3]||(a[3]=s=>d(!0)),filter:f.value,title:"Active Roster"},null,8,["rows","filter"])]))}},Oe={class:"row items-center"},ze={key:0,class:"col-12 col-md-3"},Be={class:"col-12 col-md-3 q-px-sm"},Ee={class:"col-12 col-md-3 q-px-sm"},Fe={class:"col-12 col-md-3 q-px-sm"},Xe={__name:"newArrivals",setup(H){const b=te(),r=ne(),m=L(),h=le(),f=v(""),D=v(null),q=v(null),{getSelectedProject:_}=ee(h),{getAssignments:x,fetchAllAssignments:M,fetchAssignments:N}=ie(),{getManpowerData:Y,setRosters:T}=ue(),n=w(()=>m.params.id?m.params.id:null),g=w(()=>_.value?_.value[3]:null);if(m.query){const t=Object.assign({},m.query);t.tab="newArrivals",r.replace({query:t})}const P=w(()=>{let t;const a=V().subtract(14,"day");return n.value?t=(Y({dataset:"rosters",id:n.value})||[]).sort((Q,B)=>Q[1].$d<B[1].$d?1:-1):t=x(g.value).sort((s,Q)=>s[1].$d<Q[1].$d?1:-1),t.filter(s=>!s[112]&&s.latest&&s[102]==="Active"&&V(s[1].$d).isSameOrAfter(a)&&V(s[1].$d).isSameOrBefore(V()))}),S=w(()=>{let t=P.value;return t=D.value?t.filter(a=>V(a[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===V(D.value).tz("America/Chicago").format("MM/DD/YYYY")):t,t=q.value?t.filter(a=>a[68]===q.value):t,t.sort((a,s)=>a.employee[22]>s.employee[22]?1:-1)}),R=w(()=>[...new Map(P.value.map(t=>[t[68],t[68]])).values()]),d=async t=>{b.loading.show(),n.value?(t||!Y({dataset:"rosters",id:n.value}))&&await k():g.value?await N({projectId:g.value,refresh:t}):await M({refresh:t}),b.loading.hide()},k=async()=>{const t=`{'173'.EX.'${n.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:a}=await ve.fetchFromProjectsApp({fields:[be({type:"assignments",query:t})]});T({id:n.value,data:a})};return(t,a)=>(A(),C("div",null,[l(ae,{flat:""},{default:i(()=>[l(F,null,{default:i(()=>[u("div",Oe,[X(m).params.id?O("",!0):(A(),C("div",ze,[l(se,{dense:""})])),u("div",Be,[l(z,{dense:"",modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=s=>f.value=s),label:"Search"},null,8,["modelValue"])]),u("div",Ee,[l(z,{dense:"",modelValue:D.value,"onUpdate:modelValue":a[1]||(a[1]=s=>D.value=s),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),u("div",Fe,[l(pe,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:q.value,"onUpdate:modelValue":a[2]||(a[2]=s=>q.value=s),options:R.value,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),l(ge,{rows:S.value,onRefreshData:a[3]||(a[3]=s=>d(!0)),title:"New Arrivals",filter:f.value},null,8,["rows","filter"])]))}},Le={class:"row items-center"},He={key:0,class:"col-12 col-md-3"},We={class:"col-12 col-md-3 q-px-sm"},Ge={class:"col-12 col-md-3 q-px-sm"},Je=u("div",{class:"col-12 col-md-3 q-px-sm"},null,-1),Ke={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},Ze={class:"text-dark text-caption text-italic"},ea={__name:"releases",setup(H){const b=ne(),r=L(),m=te(),h=le(),{getUserType:f,getUser:D}=Ae(),{getProjects:q,getSelectedProject:_,getSelectedOffice:x}=ee(h),{capitalize:M}=Pe,N=v(x.value?x.value[8]:null),Y=v(_.value?_.value[3]:null),T=v(f==="Project User"?D[3]:N),n=v(),g=v([]),P=v(""),S=v(""),R=v(!1),d=v({sortBy:"effectiveDate",descending:!0,page:1,rowsPerPage:25,rowsNumber:0});if(r.query){const e=Object.assign({},r.query);e.tab="releases",b.replace({query:e})}f==="QuickBase User"&&Z(x,()=>{N.value=x.value?x.value[8]:null,B()}),f==="Project User"&&Z(_,()=>{Y.value=_.value?_.value[3]:null,B()}),Z(S,()=>{B()});const k=v([{name:"action",label:"",align:"left",field:e=>e[1],sortable:!1},{name:1,label:"Name",align:"left",field:e=>e[49],format:e=>`${a(e)}`,sortable:!1,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:e=>e[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[50],format:e=>`${e}`,sortable:!1,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[51],format:e=>e===""?"not available":e,sortable:!1},{name:4,label:"Classification",align:"left",field:e=>e[82],format:e=>`${!e||e===""?"Not Assigned":e.replace("&amp;","&")}`,sortable:!1},{name:7,label:"Term Reason",align:"left",field:e=>e[32],format:e=>`${e}`,sortable:!1},{name:"effectiveDate",label:"Release Date",align:"left",field:e=>e[36].$d,format:e=>`${V(e).format("MM/DD/YYYY")}`,sortable:!0},{name:"releaseDateCreated",label:"Date Submitted",align:"left",field:e=>e[1].$d,format:e=>`${V(e).format("MM/DD/YYYY")}`,sortable:!0},{name:42,label:"Status",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1,sortOrder:"ad"}]),t=v([{name:"action",label:"",align:"left",field:e=>e[1],sortable:!1},{name:1,label:"Name",align:"left",field:e=>e[49],format:e=>`${a(e)}`,sortable:!1,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:e=>e[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[50],format:e=>`${e}`,sortable:!1,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[51],format:e=>e===""?"not available":e,sortable:!1},{name:4,label:"Classification",align:"left",field:e=>e[82],format:e=>`${!e||e===""?"Not Assigned":e.replace("&amp;","&")}`,sortable:!1},{name:5,label:"Job #",align:"left",field:e=>e[81],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!1},{name:7,label:"Term Reason",align:"left",field:e=>e[32],format:e=>`${e}`,sortable:!1},{name:"effectiveDate",label:"Release Date",align:"left",field:e=>e[36].$d,format:e=>`${V(e).format("MM/DD/YYYY")}`,sortable:!0},{name:"releaseDateCreated",label:"Date Submitted",align:"left",field:e=>e[1].$d,format:e=>`${V(e).format("MM/DD/YYYY")}`,sortable:!0},{name:42,label:"Status",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1,sortOrder:"ad"}]),a=e=>{const y=e.split(" ");let o="";return y.forEach((c,I)=>{o+=I>0?` ${M(c.toLowerCase())}`:M(c.toLowerCase())}),o},s=({page:e,pageSize:y,descending:o,filter:c,sortBy:I})=>{try{let j="";c&&(j=c.trim());let U=null;_.value?U=_.value[3]:(U=[],q.value({userType:f,selectedId:T.value,can:"read"}).forEach(p=>{U.push(p[3])}));const $={...c&&{$or:[{fullName:{$containsi:`${j}`}},{classification:{$containsi:`${j}`}},{jobNumber:{$containsi:`${j}`}},{workdayId:{$containsi:`${j}`}},{phoneNumber:{$containsi:`${j}`}},{payrollId:{$containsi:`${j}`}}]},...S.value&&{effectiveDate:{$eq:S.value}},projectRID:{$eq:U}};return fe.getReleases({pagination:{page:e,pageSize:y},sort:`${I||"releaseDateCreated"}:${o?"desc":"asc"}`,filters:$}).then(p=>{const{data:E,meta:we}=p,de=[];return E.forEach(oe=>{oe.syncObject[48]=oe.syncObject[48].replace("&amp;","&"),de.push(fe.formatObject(oe.syncObject))}),R.value=!1,{data:de,meta:we}})}catch{R.value=!1}},Q=async e=>{const{page:y,rowsPerPage:o,sortBy:c,descending:I}=e.pagination,j=e.filter,U=o===0?d.value.rowsNumber:o;R.value=!0;const $=await s({page:y,sortBy:c,descending:I,pageSize:U,filter:j});if(R.value=!1,$){const{data:p,meta:E}=$;g.value.splice(0,g.value.length,...p),d.value.page=E.pagination.page,d.value.sortBy=c,d.value.descending=I,d.value.rowsPerPage=E.pagination.pageSize,d.value.rowsPerPage=E.pagination.pageSize,d.value.rowsNumber=E.pagination.total}};Ve(()=>{n.value.requestServerInteraction()});const B=()=>{n.value.requestServerInteraction()};function W(e,y,o){let c=y!==void 0?y(e,o):e;return c=c==null?"":String(c),c=c.split('"').join('""'),`"${c}"`}const ye=async()=>{const{page:e,rowsNumber:y,sortBy:o,descending:c}=d.value,I=await s({page:e,sortBy:o,descending:c,pageSize:y,filter:P.value});let j=[k.value.map($=>W($.label))].concat(g.value.map($=>k.value.map(p=>W(typeof p.field=="function"?p.field($):$[p.field===void 0?p.name:p.field],p.format,$)).join(","))).join(`\r
`);I&&I.data&&(j=[t.value.map($=>W($.label))].concat(I.data.map($=>t.value.map(p=>W(typeof p.field=="function"?p.field($):$[p.field===void 0?p.name:p.field],p.format,$)).join(","))).join(`\r
`)),ke(`${V().format("MM.DD.YYYY")} Releases-Export.csv`,j,"text/csv")!==!0&&m.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})};function $e(e){b.push({name:"view-release",params:{release:e[3]}})}return(e,y)=>(A(),C("div",null,[l(ae,{flat:""},{default:i(()=>[l(F,null,{default:i(()=>[u("div",Le,[e.$route.params.id?O("",!0):(A(),C("div",He,[l(se,{debounce:"300",dense:""})])),u("div",We,[l(z,{dense:"",debounce:"300",modelValue:P.value,"onUpdate:modelValue":y[0]||(y[0]=o=>P.value=o),label:"Search"},null,8,["modelValue"])]),u("div",Ge,[l(z,{dense:"",debounce:"300",modelValue:S.value,"onUpdate:modelValue":y[1]||(y[1]=o=>S.value=o),label:"Release Date",type:"date","stack-label":""},null,8,["modelValue"])]),Je])]),_:1})]),_:1}),u("div",null,[l(Re,{title:"Releases","title-class":"text-h5 text-primary",ref_key:"tableRef",ref:n,columns:k.value,rows:g.value,"row-key":o=>o[3],class:"q-pa-sm",pagination:d.value,"onUpdate:pagination":y[2]||(y[2]=o=>d.value=o),"table-header-class":"bg-dark text-white","no-data-label":"There are no releases",dense:"","binary-state-sort":"",filter:P.value,onRequest:Q},{"body-cell-action":i(o=>[l(Se,{props:o},{default:i(()=>[l(ce,{class:"cursor-pointer",size:X(m).screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:c=>$e(o.row),name:o.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1032,["props"])]),"no-data":i(({message:o})=>[u("div",Ke,[l(ce,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),u("span",null,re(o),1)])]),"top-right":i(()=>[u("div",Ze,"(Total: "+re(d.value.rowsNumber)+" releases)",1),l(me,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:B}),l(me,{dense:X(m).screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:ye,disable:d.value.rowsNumber<1},null,8,["dense","disable"])]),loading:i(()=>[l(Ye,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key","pagination","filter"])])]))}},aa={class:"text-h5 text-dark"},ta={class:"text-body2 text-italic q-ml-sm"},la=u("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for your job site(s).",-1),sa={class:"row items-center"},oa={key:0,class:"col-12 col-md-3 q-px-sm"},ra={class:"col-12 col-md-3 q-px-sm"},na={__name:"pipeline",setup(H){const b=te(),r=L(),m=le(),h=v(""),{getSelectedProject:f}=ee(m),{fetchAllDeployments:D,fetchAllInProcess:q,fetchAllPending:_,getDeployments:x,getInProcess:M,getPending:N}=ie(),{getManpowerData:Y,setPipelines:T}=ue(),n=w(()=>r.params.id?r.params.id:null),g=w(()=>f.value?f.value[3]:null),P=w(()=>x(g.value)),S=w(()=>N(g.value)),R=w(()=>M(g.value)),d=w(()=>{let a;return n.value?a=Y({dataset:"pipelines",id:n.value})||[]:a=R.value.concat(S.value.concat(P.value)),a}),k=async a=>{b.loading.show(),n.value?(a||!Y({dataset:"pipelines",id:n.value}))&&await t():(await D(a),await q(a),await _(a)),b.loading.hide()},t=async()=>{const a=await xe(n.value);T({id:n.value,data:a})};return k(),(a,s)=>(A(),C("div",null,[l(ae,{flat:""},{default:i(()=>[l(F,{class:"q-pb-none"},{default:i(()=>[u("div",aa,[je(" Staffing Pipeline "),u("span",ta,"("+re(d.value.length)+" total)",1)]),la]),_:1}),l(F,null,{default:i(()=>[u("div",sa,[X(r).params.id?O("",!0):(A(),C("div",oa,[l(se,{dense:""})])),u("div",ra,[l(z,{dense:"",modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=Q=>h.value=Q),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),l(Qe,{rows:d.value,onRefresh:s[1]||(s[1]=Q=>k(!0)),filter:h.value},null,8,["rows","filter"])]))}},ia={class:"q-pa-md"},Ga={__name:"index",setup(H){const b=L(),r=v(null);return b.query&&b.query.tab?b.query.tab==="releases"||b.query.tab==="release"?r.value=2:(b.query.tab==="newArrivals"||b.query.tab==="new-arrivals")&&(r.value=1):r.value=0,(m,h)=>(A(),K(qe,{style:{"max-width":"100vw"}},{default:i(()=>[u("div",ia,[l(De,{class:"bg-info text-white shadow-2 rounded-borders"},{default:i(()=>[l(he,{modelValue:r.value,"onUpdate:modelValue":h[0]||(h[0]=f=>r.value=f),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:i(()=>[l(G,{name:0,label:m.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"]),l(G,{name:1,label:"New Arrivals"}),m.$route.name==="project-manpower"?(A(),K(G,{key:0,name:3,label:"Pipeline"})):O("",!0),m.$can("read","releases")?(A(),K(G,{key:1,name:2,label:"Releases"})):O("",!0)]),_:1},8,["modelValue"])]),_:1}),l(_e,{modelValue:r.value,"onUpdate:modelValue":h[1]||(h[1]=f=>r.value=f),animated:""},{default:i(()=>[l(J,{name:0},{default:i(()=>[l(Ue)]),_:1}),l(J,{name:1},{default:i(()=>[l(Xe)]),_:1}),l(J,{name:3},{default:i(()=>[l(na)]),_:1}),m.$can("read","releases")?(A(),K(J,{key:0,name:2},{default:i(()=>[l(ea)]),_:1})):O("",!0)]),_:1},8,["modelValue"])])]),_:1}))}};export{Ga as default};
